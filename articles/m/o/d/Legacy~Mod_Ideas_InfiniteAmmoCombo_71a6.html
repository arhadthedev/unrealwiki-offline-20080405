<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<!-- headlinks removed -->
	<link rel="shortcut icon" href="../../../../misc/uewiki-favicon.png"/>
    <title>Legacy:Mod Ideas/InfiniteAmmoCombo - Unreal Wiki</title>
    <style type="text/css">/*<![CDATA[*/ @import "../../../../skins/offline/main.css"; /*]]>*/</style>
    <link rel="stylesheet" type="text/css" media="print" href="../../../../skins/common/commonPrint.css" />
    <!--[if lt IE 5.5000]><style type="text/css">@import "../../../../skins/monobook/IE50Fixes.css";</style><![endif]-->
    <!--[if IE 5.5000]><style type="text/css">@import "../../../../skins/monobook/IE55Fixes.css";</style><![endif]-->
    <!--[if IE 6]><style type="text/css">@import "../../../../skins/monobook/IE60Fixes.css";</style><![endif]-->
    <!--[if IE]><script type="text/javascript" src="../../../../skins/common/IEFixes.js"></script>
    <meta http-equiv="imagetoolbar" content="no" /><![endif]-->
    <script type="text/javascript" src="../../../../skins/common/wikibits.js"></script>
    <script type="text/javascript" src="../../../../skins/offline/md5.js"></script>
    <script type="text/javascript" src="../../../../skins/offline/utf8.js"></script>
    <script type="text/javascript" src="../../../../skins/offline/lookup.js"></script>
    <script type="text/javascript" src="../../../../articles/-/_/_/-.html"></script>        <style type="text/css">/*<![CDATA[*/
@import "../../../../articles/c/o/m/MediaWiki%7ECommon.css_d42e.html";
@import "../../../../articles/m/o/n/MediaWiki%7EMonobook.css_fb19.html";
@import "../../../../articles/-/_/_/-.html";
/*]]>*/</style>          </head>
  <body
    class="ns-100">
    <div id="globalWrapper">
      <div id="column-content">
	<div id="content">
	  <a name="top" id="contentTop"></a>
	        <h1 class="firstHeading">Legacy:Mod Ideas/InfiniteAmmoCombo</h1>
	  <div id="bodyContent">
	    <h3 id="siteSub">From Unreal Wiki, The Unreal Engine Documentation Site</h3>
	    <div id="contentSub"><span class="subpages">&lt; <a href="../../../../articles/m/o/d/Legacy%7EMod_Ideas_bf77.html" title="Legacy:Mod Ideas">Legacy:Mod Ideas</a></span></div>
	    	    	    <!-- start content -->
	    <table id="toc" class="toc" summary="Contents">
<tr>
<td>
<div id="toctitle">
<h2>Contents</h2>
</div>
<ul>
<li class="toclevel-1"><a href="#Infinite_Ammo_Combo"><span class="tocnumber">1</span> <span class="toctext">Infinite Ammo Combo</span></a>
<ul>
<li class="toclevel-2"><a href="#The_Idea"><span class="tocnumber">1.1</span> <span class="toctext">The Idea</span></a></li>
<li class="toclevel-2"><a href="#The_Problem"><span class="tocnumber">1.2</span> <span class="toctext">The Problem</span></a></li>
<li class="toclevel-2"><a href="#Comments"><span class="tocnumber">1.3</span> <span class="toctext">Comments</span></a></li>
</ul>
</li>
</ul>
</td>
</tr>
</table>
<script type="text/javascript">
//<![CDATA[
 if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } 
//]]>
</script>
<p><a name="Infinite_Ammo_Combo" id="Infinite_Ammo_Combo"></a></p>
<h3><span class="mw-headline">Infinite Ammo Combo</span></h3>
<p><a name="The_Idea" id="The_Idea"></a></p>
<h4><span class="mw-headline">The Idea</span></h4>
<p>I am trying to make an adrenaline combo for the rapidly dying UT2003. When activated, it will either return any ammo used instantly or stop ammo from being used in firing.</p>
<p>I have tried some thing out but I can't get it to work:</p>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw5">class</span> InfinAmmoCombo <span class="kw5">extends</span> Combo;
 
<span class="kw5">var</span> xEmitter Effect;
<span class="kw5">var</span> xEmitter Effect2;
<span class="kw5">var</span> Ammunition LastAmmo;
 
 
<span class="kw5">function</span> StartEffect<span class="br0">(</span>xPawn P<span class="br0">)</span>
<span class="br0">{</span>
    <span class="kw1">if</span> <span class="br0">(</span>P.<span class="kw8">Role</span> == <span class="kw9">ROLE_Authority</span><span class="br0">)</span>
    <span class="br0">{</span>
        Effect = Spawn<span class="br0">(</span><span class="kw5">class</span><span class="st0">'OffensiveEffect'</span>, P,, P.<span class="me1">Location</span>, P.<span class="me1">Rotation</span><span class="br0">)</span>;
        Effect2 = Spawn<span class="br0">(</span><span class="kw5">class</span><span class="st0">'RegenCrosses'</span>, P,, P.<span class="me1">Location</span>, P.<span class="me1">Rotation</span><span class="br0">)</span>;
    <span class="br0">}</span>
    LastAmmo = <a href="/Pawn"><span class="kw10">Pawn</span></a><span class="br0">(</span>Owner<span class="br0">)</span>.<span class="me1">Weapon</span>.<span class="me1">Ammo</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>;
<span class="co1">//    AmmoHeal(P);</span>
    SetTimer<span class="br0">(</span><span class="nu0">0.01</span>, <span class="kw9">true</span><span class="br0">)</span>;
    Timer<span class="br0">(</span><span class="br0">)</span>;
<span class="br0">}</span>
 
 
<span class="co1">//function AmmoHeal(xPawn P)</span>
<span class="kw5">function</span> Timer<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
    <span class="kw5">local</span> Inventory Inv;
 
    <span class="kw1">if</span> <span class="br0">(</span><a href="/Pawn"><span class="kw10">Pawn</span></a><span class="br0">(</span>Owner<span class="br0">)</span>.<span class="kw8">Role</span> == <span class="kw9">ROLE_Authority</span><span class="br0">)</span>
    <span class="br0">{</span>
        <span class="kw1">if</span><span class="br0">(</span> inv.<span class="kw7">IsA</span><span class="br0">(</span><span class="st0">'Weapon'</span><span class="br0">)</span> &amp;&amp; <span class="br0">(</span>!inv.<span class="kw7">IsA</span><span class="br0">(</span><span class="st0">'TransLauncher'</span><span class="br0">)</span><span class="br0">)</span> &amp;&amp; <span class="br0">(</span>!inv.<span class="kw7">IsA</span><span class="br0">(</span><span class="st0">'ShieldGun'</span><span class="br0">)</span><span class="br0">)</span> &amp;&amp; <span class="br0">(</span>!inv.<span class="kw7">IsA</span><span class="br0">(</span><span class="st0">'ShieldGun'</span><span class="br0">)</span><span class="br0">)</span> &amp;&amp; <span class="br0">(</span>!inv.<span class="kw7">IsA</span><span class="br0">(</span><span class="st0">'ShieldGun'</span><span class="br0">)</span><span class="br0">)</span> <span class="br0">)</span>
        <span class="br0">{</span>
            <span class="kw1">if</span> <span class="br0">(</span>LastAmmo != <a href="/Pawn"><span class="kw10">Pawn</span></a><span class="br0">(</span>Owner<span class="br0">)</span>.<span class="me1">Weapon</span>.<span class="me1">Ammo</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span><span class="br0">)</span>
            <span class="br0">{</span>
               <a href="/Pawn"><span class="kw10">Pawn</span></a><span class="br0">(</span>Owner<span class="br0">)</span>.<span class="me1">Weapon</span>.<span class="me1">Ammo</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> = LastAmmo;
               <span class="kw7">Log</span><span class="br0">(</span><span class="st0">"Ammo is good"</span><span class="br0">)</span>;
            <span class="br0">}</span>
           LastAmmo = <a href="/Pawn"><span class="kw10">Pawn</span></a><span class="br0">(</span>Owner<span class="br0">)</span>.<span class="me1">Inventory</span>.<span class="me1">Ammo</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>;
        <span class="br0">}</span>
    <span class="br0">}</span>
<span class="br0">}</span>
 
<span class="kw5">function</span> StopEffect<span class="br0">(</span>xPawn P<span class="br0">)</span>
<span class="br0">{</span>
    <span class="kw1">if</span> <span class="br0">(</span> Effect != <span class="kw9">None</span> <span class="br0">)</span>
        Effect.<span class="me1">Destroy</span><span class="br0">(</span><span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="kw1">defaultproperties</span>
<span class="br0">{</span>
    ExecMessage=<span class="st0">"Infinite Ammo! Go Berserk!!"</span>
        ComboAnnouncement=<a href="/sound"><span class="kw10">sound</span></a><span class="st0">'AnnouncerMain.Berzerk'</span>
    keys<span class="br0">(</span><span class="nu0">0</span><span class="br0">)</span>=<span class="nu0">1</span>
    keys<span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span>=<span class="nu0">1</span>
    keys<span class="br0">(</span><span class="nu0">2</span><span class="br0">)</span>=<span class="nu0">2</span>
    keys<span class="br0">(</span><span class="nu0">3</span><span class="br0">)</span>=<span class="nu0">2</span>
<span class="br0">}</span>
</pre></div>
<p><a name="The_Problem" id="The_Problem"></a></p>
<h4><span class="mw-headline">The Problem</span></h4>
<p>I'm not too good with UnrealScript and would like some advice on this matter. I have tried looking at mods and mutators which regenerate ammo but they work on all ammo. I just want it on the current weapon. If it does compile, nothing happens. Any ideas?</p>
<p><a name="Comments" id="Comments"></a></p>
<h4><span class="mw-headline">Comments</span></h4>
<p><b>T1:</b> First of all, could you provide some of the errors UCC gives you? And why do you check the shieldgun thrice? And Maybe a Shieldgun(Inv)&#160;!= none would be faster (not sure about this, some of the other wiki people would have to confirm this).</p>
<p>Oh wait, I think I just found your problem. Inv isn't being given any values. You have to say somewhere Inv=Pawn(Owner).Inventory; or something like that. I'll go check in the wiki.</p>
<p><b>ShadowRaven:</b> I got rid of the multiple Shield Gun calls, I was going to replace them with redeemer and ion painer ammo after I got the ammo system working itself. Common errors are (aside from syntax) Unrecognized member "Ammo" in "Inventory and Unrecognized member "AmmoAmount" in Weapon" (AmmoAmount worked in the StartEffect function, variable scope is stoppping me from using it in Timer().</p>
<p>I know Ammo[0] isn't it as the array indicates number of fire modes.</p>
<p>I'm thinking to have to call each weapon seperately however that loses the mod compatability.</p>
<p><b>porkmanii:</b> Ammunition objects (as in Weapon.Ammo[]) store the amount of ammo, and usually don't change throughout the lifetime of a weapon. I'm not sure about UT2003, but in UT2004 Ammunition generally isn't used. Weapons have a property called "bNoAmmoInstances" which, if true (the default value), disables Ammunition and uses AmmoCharge (var int AmmoCharge[2]) instead. If you want the amount of ammo to remain constant, you may have to record the value returned by Weapon.AmmoAmount(mode), and add back some amount to keep it at that level every time it changes.</p>
<p>One other problem I can see is that if the player changes weapons, your code assigns the Ammunition from the previous weapon. If you implement this as an Inventory item, you could detect when the player changes weapons - an OwnerEvent() call where EventName == 'ChangedWeapon'. Alternatively you could watch the weapon's ammo class, resetting the "LastAmmo" every time the class changes. This would also allow compatibility with weapons with multiple ammo types, like ChaosUT's Crossbow.</p>
<p>Pawn.Inventory refers to the first Inventory item in the Pawn's inventory chain. Even if Ammo[] was declared in Inventory and not Weapon, why would you want to use Pawn.Inventory's Ammo[] property?</p>
<p><b>Mad:</b> I managed to get this combo working the way you intended to, where the current weapon the player is holding is the only weapon with infinite ammo. The problem is, I managed to get this working in UT2004, so I don't know of any differences within the code between 2003 and 2004.</p>
<p>The xPawn class has access to the current weapon being used by calling xPawn.Weapon. Within the weapon class contains an array of WeaponFire classes called FireModeClasses. The WeaponFire classes handle the amount of ammo being used for a particular weapon. Use the function GetFireMode to obtain access to the specific Weapon's WeaponFire and adjust the AmmoPerFire accordingly. Here is the code that I used to make this work.</p>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw5">class</span> ComboUnlimitedAmmo <span class="kw5">extends</span> Combo;
 
<span class="kw5">var</span> <span class="kw4">int</span> nAmmoPerFireOne;         <span class="co1">//For primary ammo</span>
<span class="kw5">var</span> <span class="kw4">int</span> nAmmoPerFireTwo;         <span class="co1">//For seondary ammo</span>
 
<span class="coMULTI">/*
This function will get called when right combination is entered.
*/</span>
<span class="kw5">function</span> StartEffect<span class="br0">(</span>xPawn P<span class="br0">)</span>
<span class="br0">{</span>
     nAmmoPerFireOne = P.<span class="me1">Weapon</span>.<span class="me1">GetFireMode</span><span class="br0">(</span><span class="nu0">0</span><span class="br0">)</span>.<span class="me1">AmmoPerFire</span>;
     nAmmoPerFireTwo = P.<span class="me1">Weapon</span>.<span class="me1">GetFireMode</span><span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span>.<span class="me1">AmmoPerFire</span>;
     P.<span class="me1">Weapon</span>.<span class="me1">GetFireMode</span><span class="br0">(</span><span class="nu0">0</span><span class="br0">)</span>.<span class="me1">AmmoPerFire</span> = <span class="nu0">0</span>;
     P.<span class="me1">Weapon</span>.<span class="me1">GetFireMode</span><span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span>.<span class="me1">AmmoPerFire</span> = <span class="nu0">0</span>;
<span class="br0">}</span>
 
 
<span class="coMULTI">/*
This function gets called when adrenaline is all gone.
*/</span>
<span class="kw5">function</span> StopEffect<span class="br0">(</span>xPawn P<span class="br0">)</span>
<span class="br0">{</span>
     P.<span class="me1">Weapon</span>.<span class="me1">GetFireMode</span><span class="br0">(</span><span class="nu0">0</span><span class="br0">)</span>.<span class="me1">AmmoPerFire</span> = nAmmoPerFireOne;
     P.<span class="me1">Weapon</span>.<span class="me1">GetFireMode</span><span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span>.<span class="me1">AmmoPerFire</span> = nAmmoPerFireTwo;
<span class="br0">}</span>
 
<span class="kw1">defaultproperties</span>
<span class="br0">{</span>
     nAmmoPerFireOne = <span class="nu0">1</span>;
     nAmmoPerFireTwo = <span class="nu0">1</span>;
     Duration = <span class="nu0">20</span>;
     ExecMessage = <span class="st0">"Unlimited Ammo!"</span>
     keys<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> = <span class="nu0">4</span>;<span class="co1">//CK_LEFT;</span>
     keys<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> = <span class="nu0">8</span>;<span class="co1">//CK_RIGHT;</span>
     keys<span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span> = <span class="nu0">4</span>;<span class="co1">//CK_LEFT;</span>
     keys<span class="br0">[</span><span class="nu0">3</span><span class="br0">]</span> = <span class="nu0">8</span>;<span class="co1">//CK_RIGHT;</span>
<span class="br0">}</span>
</pre></div>
<p>The problem with the code is, once the combo is initiated, the current gun the player is holding will only have unlimited ammo. Also, the ammo count will decrement by one before going to "infinite" mode. These are both an easy fix, and I will update the code once I figure out how. I hope this helps anyone out.</p>
<p><b>Eliot:</b> ForEach maybe can fix this i havent tested it though&#160;:p, anyway this will work for everybody ingame:/ anyway its good for a mutator then.</p>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw5">function</span> StartEffect<span class="br0">(</span>xPawn P<span class="br0">)</span>
<span class="br0">{</span>
    <span class="kw5">local</span> Weapon W;
 
    <span class="kw1">ForEach</span> DynamicActors<span class="br0">(</span> <span class="kw5">Class</span><span class="st0">'Weapon'</span>, W <span class="br0">)</span>
    <span class="br0">{</span>
      <span class="co1">//nAmmoPerFireOne = W.GetFireMode(0).AmmoPerFire;</span>
      <span class="co1">//nAmmoPerFireTwo = W.GetFireMode(1).AmmoPerFire;</span>
        W.<span class="me1">GetFireMode</span><span class="br0">(</span><span class="nu0">0</span><span class="br0">)</span>.<span class="me1">AmmoPerFire</span> = <span class="nu0">0</span>;
        W.<span class="me1">GetFireMode</span><span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span>.<span class="me1">AmmoPerFire</span> = <span class="nu0">0</span>;
    <span class="br0">}</span>
<span class="br0">}</span>
 
<span class="kw5">function</span> StopEffect<span class="br0">(</span>xPawn P<span class="br0">)</span>
<span class="br0">{</span>
    <span class="kw5">local</span> Weapon W;
 
    <span class="kw1">ForEach</span> DynamicActors<span class="br0">(</span> <span class="kw5">Class</span><span class="st0">'Weapon'</span>, W <span class="br0">)</span>
    <span class="br0">{</span>
        W.<span class="me1">GetFireMode</span><span class="br0">(</span><span class="nu0">0</span><span class="br0">)</span>.<span class="me1">AmmoPerFire</span> = W.<span class="me1">GetFireMode</span><span class="br0">(</span><span class="nu0">0</span><span class="br0">)</span>.<span class="kw1">Default</span>.<span class="me1">AmmoPerFire</span>;
        W.<span class="me1">GetFireMode</span><span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span>.<span class="me1">AmmoPerFire</span> = W.<span class="me1">GetFireMode</span><span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span>.<span class="kw1">Default</span>.<span class="me1">AmmoPerFire</span>;
    <span class="br0">}</span>
<span class="br0">}</span>
 
<span class="kw1">defaultproperties</span>
<span class="br0">{</span>
    Duration = <span class="nu0">20</span>;
    ExecMessage = <span class="st0">"Unlimited Ammo!"</span>
    keys<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> = <span class="nu0">4</span>;<span class="co1">//CK_LEFT;</span>
    keys<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> = <span class="nu0">8</span>;<span class="co1">//CK_RIGHT;</span>
    keys<span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span> = <span class="nu0">4</span>;<span class="co1">//CK_LEFT;</span>
    keys<span class="br0">[</span><span class="nu0">3</span><span class="br0">]</span> = <span class="nu0">8</span>;<span class="co1">//CK_RIGHT;</span>
<span class="br0">}</span>
</pre></div>

<!-- 
NewPP limit report
Preprocessor node count: 15/1000000
Post-expand include size: 27/2097152 bytes
Template argument size: 0/2097152 bytes
#ifexist count: 0/100
-->
<div class="printfooter">
</div>
	    <div id="catlinks"><p class='catlinks'><a href="../../../../articles/c/a/t/Special%7ECategories_101d.html" title="Special:Categories">Category</a>: <span dir='ltr'><a href="../../../../articles/l/e/g/Category%7ELegacy_Journal_a8a9.html" title="Category:Legacy Journal">Legacy Journal</a></span></p></div>	    <!-- end content -->
	    <div class="visualClear"></div>
	  </div>
	</div>
      </div>
      <div id="column-one">
	<div id="p-cactions" class="portlet">
	  <h5>Views</h5>
	  <ul>
	    <li id="ca-nstab-legacy"
	       class="selected"	       ><a href="../../../../articles/m/o/d/Legacy%7EMod_Ideas_InfiniteAmmoCombo_71a6.html">Legacy</a></li><li id="ca-talk"
	       class="new"	       ><a href="../../../../articles/m/o/d/Legacy_talk%7EMod_Ideas_InfiniteAmmoCombo_78bc.html">Discussion</a></li><li id="ca-current"
	       	       ><a href="http://wiki.beyondunreal.com/Legacy:Mod_Ideas/InfiniteAmmoCombo">Current revision</a></li>	  </ul>
	</div>
	<div class="portlet" id="p-logo">
	  <a style="background-image: url(../../../../misc/uewiki.png);"
	    href="../../../../index.html"
	    title="Main Page"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
		<div class='portlet' id='p-navigation'>
	  <h5>Navigation</h5>
	  <div class='pBody'>
	    <ul>
	    	      <li id="n-mainpage"><a href="../../../../index.html">Main Page</a></li>
	     	      <li id="n-portal"><a href="../../../../articles/c/o/m/Unreal_Wiki%7ECommunity_Portal_3311.html">Community portal</a></li>
	     	      <li id="n-help"><a href="../../../../articles/c/o/n/Help%7EContents_22de.html">Help</a></li>
	     	    </ul>
	  </div>
	</div>
		<div id="p-search" class="portlet">
	  <h5><label for="searchInput">Search</label></h5>
	  <div id="searchBody" class="pBody">
	    <form action="javascript:goToStatic(3)" id="searchform"><div>
	      <input id="searchInput" name="search" type="text"
	        accesskey="f" value="" />
	      <input type='submit' name="go" class="searchButton" id="searchGoButton"
	        value="Go" />
	    </div></form>
	  </div>
	</div>
	      </div><!-- end of the left (by default at least) column -->
      <div class="visualClear"></div>
      <div id="footer">
    <div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="../../../../skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" /></a></div>	<div id="f-copyrightico"><a href="../../../../../COPYING.html"><img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" alt='Attribution-Noncommercial-Share Alike 3.0' /></a></div>	<ul id="f-list">
	  	  	  <li id="f-credits">This page was last modified 16:48, 19 November 2007 by Anonymous user(s) of Unreal Wiki. </li>	  <li id="f-copyright">Licensed as <a href="../../../../articles/c/o/p/Unreal_Wiki%7ECopyrights_e561.html" title="Unreal Wiki:Copyrights">Attribution-Noncommercial-Share Alike 3.0</a>.</li>	  <li id="f-about"><a href="../../../../articles/a/b/o/Unreal_Wiki%7EAbout_9ce6.html" title="Unreal Wiki:About">About Unreal Wiki</a></li>	  <li id="f-disclaimer"><a href="../../../../articles/g/e/n/Unreal_Wiki%7EGeneral_disclaimer_a0a2.html" title="Unreal Wiki:General disclaimer">Disclaimers</a></li>	  	</ul>
      </div>
    </div>
  </body>
</html>
