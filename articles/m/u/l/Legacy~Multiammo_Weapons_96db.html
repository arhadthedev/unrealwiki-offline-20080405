<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<!-- headlinks removed -->
	<link rel="shortcut icon" href="../../../../misc/uewiki-favicon.png"/>
    <title>Legacy:Multiammo Weapons - Unreal Wiki</title>
    <style type="text/css">/*<![CDATA[*/ @import "../../../../skins/offline/main.css"; /*]]>*/</style>
    <link rel="stylesheet" type="text/css" media="print" href="../../../../skins/common/commonPrint.css" />
    <!--[if lt IE 5.5000]><style type="text/css">@import "../../../../skins/monobook/IE50Fixes.css";</style><![endif]-->
    <!--[if IE 5.5000]><style type="text/css">@import "../../../../skins/monobook/IE55Fixes.css";</style><![endif]-->
    <!--[if IE 6]><style type="text/css">@import "../../../../skins/monobook/IE60Fixes.css";</style><![endif]-->
    <!--[if IE]><script type="text/javascript" src="../../../../skins/common/IEFixes.js"></script>
    <meta http-equiv="imagetoolbar" content="no" /><![endif]-->
    <script type="text/javascript" src="../../../../skins/common/wikibits.js"></script>
    <script type="text/javascript" src="../../../../skins/offline/md5.js"></script>
    <script type="text/javascript" src="../../../../skins/offline/utf8.js"></script>
    <script type="text/javascript" src="../../../../skins/offline/lookup.js"></script>
    <script type="text/javascript" src="../../../../articles/-/_/_/-.html"></script>        <style type="text/css">/*<![CDATA[*/
@import "../../../../articles/c/o/m/MediaWiki%7ECommon.css_d42e.html";
@import "../../../../articles/m/o/n/MediaWiki%7EMonobook.css_fb19.html";
@import "../../../../articles/-/_/_/-.html";
/*]]>*/</style>          </head>
  <body
    class="ns-100">
    <div id="globalWrapper">
      <div id="column-content">
	<div id="content">
	  <a name="top" id="contentTop"></a>
	        <h1 class="firstHeading">Legacy:Multiammo Weapons</h1>
	  <div id="bodyContent">
	    <h3 id="siteSub">From Unreal Wiki, The Unreal Engine Documentation Site</h3>
	    <div id="contentSub"></div>
	    	    	    <!-- start content -->
	    <p>The last two versions of the ChaosUT mods have made use of weapons that have multiple types of ammo. In the UT version we made a new weapon for each ammo type. Then when you picked up one of these weapons, we gave the user all of the other weapons based on the ammo types just with out any ammo. Once a user found a different ammo type in a map, that version of the weapon now had ammo which the user now could use. This help to create the illusion of one weapon that can fire different ammo types. However this method was not fool proof. For example if you dropped the weapon or die with these weapons then only the standard weapon ammo type could be picked up.</p>
<p>UT2003 provided us with a way to correct the issues and truly make one weapon that can support more than 2 ammo types. I will attempt to walk you through how we did it for a Grenade Launcher. Keep in mind that this code is what worked. Its not the best code and I am sure there are other ways that are more elegant in handling this task. This is my first tut so forgive a few mistakes as I try to learn how to write these better. I will to post at first the key functions then the complete source at the end. But with that out of the way lets start.</p>
<p><a name="Requirements_of_Grenade_Launcher" id="Requirements_of_Grenade_Launcher"></a></p>
<h2><span class="mw-headline">Requirements of Grenade Launcher</span></h2>
<p>Here is a list of what we want our Grenade Launcher to do:</p>
<ul>
<li>The Grenade Launcher must support at least four types of Grenades. Standard, Poison, Napalm and Flash.</li>
<li>The user can switch ammo any time they have another ammo type to use in the Grenade Launcher</li>
<li>The Grenade Launcher should have a timed Grenade as one fire type and an instant hit/explosion as the other fire type for each style of grenade</li>
<li>The Grenade Launcher should have an visible indicator (new skin on weapon mesh) on which ammo type you have loaded other than the Ammo Counter</li>
</ul>
<p>Now that we have a design goal lets see how this can be done.</p>
<p>The basic plan of attack is like so:</p>
<ul>
<li>We will add new fire mode(s) to handle the new each of the new ammo types</li>
<li>Each ammo will have two fire modes one for the timed grenade another for the instant grenade</li>
<li>We will reset the attachment and pickup classes to the players viewing this weapon (or if it was dropped) so anyone can see what ammo is currently loaded into the weapon</li>
<li>We will use an EXEC in the weapon class to do the ammo changing</li>
<li>We will need a separate weapon pickup and attachment class for each ammo type</li>
</ul>
<p><a name="Needed_Functions" id="Needed_Functions"></a></p>
<h2><span class="mw-headline">Needed Functions</span></h2>
<p>The main part we need is to do the actual swapping of the ammo types. We should use a variable to store which ammo is currently loaded (we will use var int Count for that). This should be a global and not a local function for reasons we will get to later. The basics are first we check to see if we have any ammo. Then we should not allow an ammo change if we are firing the weapon. We start at our current count and then look at the next available ammo type. If we have ammo of that type we will try to change to it. We do this by removing the current fire class. Spawning a new fire class for the new ammo type. We then change the ammo to that type. We repeat this process so we change both the current firing modes. Then we remove the current attachment and pickup classes and replace them with correct ones. We do this so that the 3rd player views and the dropped pickups will have the right skin and ammo types</p>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="co1">// manual key function to swich ammo out</span>
<span class="kw6">exec</span> <span class="kw5">function</span> ChangeAmmo<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
    <span class="kw5">local</span> Inventory Inv;
 
    <span class="co1">// Check to see if they even have ammo to switch</span>
    <span class="kw1">if</span> <span class="br0">(</span>!HasAmmo<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>
      <span class="kw1">return</span>;
 
    <span class="co1">// dont let them chang ammo if they are firing</span>
    <span class="kw1">if</span> <span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">bIsFiring</span> || FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">bIsFiring</span><span class="br0">)</span>
       <span class="kw1">return</span>;
 
    <span class="kw1">while</span> <span class="br0">(</span>!bChangedAmmo<span class="br0">)</span>
    <span class="br0">{</span>
 
      <span class="kw1">if</span> <span class="br0">(</span>Count == <span class="nu0">0</span><span class="br0">)</span>
      <span class="br0">{</span>
         Count += <span class="nu0">1</span>;
 
         Inv = <a href="/Pawn"><span class="kw10">Pawn</span></a><span class="br0">(</span>Owner<span class="br0">)</span>.<span class="me1">FindInventoryType</span><span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeAmmoNapalm'</span><span class="br0">)</span>;
         <span class="kw1">if</span> <span class="br0">(</span>Inv  != <span class="kw9">none</span>  &amp;&amp; Ammunition<span class="br0">(</span>inv<span class="br0">)</span>.<span class="me1">HasAmmo</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>
         <span class="br0">{</span>
             bChangedAmmo=<span class="kw9">true</span>;
             <span class="co1">// Remove old fire mode 0</span>
             <span class="kw1">if</span> <span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> != <span class="kw9">none</span><span class="br0">)</span>
                 FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">Destroy</span><span class="br0">(</span><span class="br0">)</span>;
             <span class="co1">// primary fire</span>
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> = Spawn<span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeLauncher_Primary_napalm'</span>, <span class="kw8">self</span><span class="br0">)</span>;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">ThisModeNum</span> = <span class="nu0">0</span>;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">Weapon</span> = <span class="kw8">self</span>;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">Instigator</span> = Instigator;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">AmmoClass</span> =<span class="kw5">class</span><span class="st0">'GrenadeAmmoNapalm'</span>;    <span class="co1">// need these two to change the ammo</span>
             Ammo<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> = Ammunition<span class="br0">(</span>Instigator.<span class="me1">FindInventoryType</span><span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">AmmoClass</span><span class="br0">)</span><span class="br0">)</span>;
             <span class="co1">// Remove old fire mode 1</span>
             <span class="kw1">if</span> <span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> != <span class="kw9">none</span><span class="br0">)</span>
                 FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">Destroy</span><span class="br0">(</span><span class="br0">)</span>;
             <span class="co1">// secondary fire</span>
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> = Spawn<span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeLauncher_Secondary_napalm'</span>, <span class="kw8">self</span><span class="br0">)</span>;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">ThisModeNum</span> = <span class="nu0">1</span>;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">Weapon</span> = <span class="kw8">self</span>;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">Instigator</span> = Instigator;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">AmmoClass</span> = <span class="kw5">class</span><span class="st0">'GrenadeAmmonapalm'</span>;
             Ammo<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> = Ammunition<span class="br0">(</span>Instigator.<span class="me1">FindInventoryType</span><span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">AmmoClass</span><span class="br0">)</span><span class="br0">)</span>;
 
             <span class="co1">// Remove old Attchment and spawn new one with correct skin</span>
             <span class="kw1">if</span> <span class="br0">(</span> AttachmentClass != <span class="kw9">none</span><span class="br0">)</span>
               DetachFromPawn<span class="br0">(</span>instigator<span class="br0">)</span>;
             AttachmentClass=<span class="kw5">class</span><span class="st0">'GrenadeLauncher_NapalmAttachment'</span>;
             AttachToPawn<span class="br0">(</span>Instigator<span class="br0">)</span>;
             PickupClass=<span class="kw5">class</span><span class="st0">'GrenadeLauncher_NapalmPickup'</span>;
             <span class="kw1">Break</span>;
         <span class="br0">}</span>
      <span class="br0">}</span>
      <span class="kw1">if</span> <span class="br0">(</span>Count == <span class="nu0">1</span><span class="br0">)</span>
      <span class="br0">{</span>
         Count += <span class="nu0">1</span>;
         Inv = <a href="/Pawn"><span class="kw10">Pawn</span></a><span class="br0">(</span>Owner<span class="br0">)</span>.<span class="me1">FindInventoryType</span><span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeAmmoFlash'</span><span class="br0">)</span>;
         <span class="kw1">if</span> <span class="br0">(</span>Inv  != <span class="kw9">none</span>  &amp;&amp; Ammunition<span class="br0">(</span>inv<span class="br0">)</span>.<span class="me1">HasAmmo</span><span class="br0">(</span><span class="br0">)</span> <span class="br0">)</span>
         <span class="br0">{</span>
             bChangedAmmo=<span class="kw9">true</span>;
             <span class="co1">// Remove old fire mode 0</span>
             <span class="kw1">if</span> <span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> != <span class="kw9">none</span><span class="br0">)</span>
                 FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">Destroy</span><span class="br0">(</span><span class="br0">)</span>;
             <span class="co1">// primary fire</span>
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> = Spawn<span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeLauncher_Primary_flash'</span>, <span class="kw8">self</span><span class="br0">)</span>;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">ThisModeNum</span> = <span class="nu0">0</span>;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">Weapon</span> = <span class="kw8">self</span>;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">Instigator</span> = Instigator;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">AmmoClass</span>=<span class="kw5">class</span><span class="st0">'GrenadeAmmoFlash'</span>;    <span class="co1">// need these two to change the ammo</span>
             Ammo<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> = Ammunition<span class="br0">(</span>Instigator.<span class="me1">FindInventoryType</span><span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">AmmoClass</span><span class="br0">)</span><span class="br0">)</span>;
             <span class="co1">// Remove old fire mode 1</span>
             <span class="kw1">if</span> <span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> != <span class="kw9">none</span><span class="br0">)</span>
                 FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">Destroy</span><span class="br0">(</span><span class="br0">)</span>;
             <span class="co1">// secondary fire</span>
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> = Spawn<span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeLauncher_Secondary_flash'</span>, <span class="kw8">self</span><span class="br0">)</span>;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">ThisModeNum</span> = <span class="nu0">1</span>;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">Weapon</span> = <span class="kw8">self</span>;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">Instigator</span> = Instigator;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">AmmoClass</span>=<span class="kw5">class</span><span class="st0">'GrenadeAmmoFlash'</span>;
             Ammo<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> = Ammunition<span class="br0">(</span>Instigator.<span class="me1">FindInventoryType</span><span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">AmmoClass</span><span class="br0">)</span><span class="br0">)</span>;
 
             <span class="co1">// Remove old Attchment and spawn new one with correct skin</span>
             <span class="kw1">if</span> <span class="br0">(</span> AttachmentClass != <span class="kw9">none</span><span class="br0">)</span>
               DetachFromPawn<span class="br0">(</span>instigator<span class="br0">)</span>;
             AttachmentClass=<span class="kw5">class</span><span class="st0">'GrenadeLauncher_FlashAttachment'</span>;
             AttachToPawn<span class="br0">(</span>Instigator<span class="br0">)</span>;
             PickupClass=<span class="kw5">class</span><span class="st0">'GrenadeLauncher_FlashPickup'</span>;
             <span class="kw1">Break</span>;
         <span class="br0">}</span>
      <span class="br0">}</span>
      <span class="kw1">if</span> <span class="br0">(</span>Count == <span class="nu0">2</span><span class="br0">)</span>
      <span class="br0">{</span>
         Count += <span class="nu0">1</span>;
         Inv = <a href="/Pawn"><span class="kw10">Pawn</span></a><span class="br0">(</span>Owner<span class="br0">)</span>.<span class="me1">FindInventoryType</span><span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeAmmoPoison'</span><span class="br0">)</span>;
         <span class="kw1">if</span> <span class="br0">(</span>Inv  != <span class="kw9">none</span>  &amp;&amp; Ammunition<span class="br0">(</span>inv<span class="br0">)</span>.<span class="me1">HasAmmo</span><span class="br0">(</span><span class="br0">)</span> <span class="br0">)</span>
         <span class="br0">{</span>
             bChangedAmmo=<span class="kw9">true</span>;
             <span class="co1">// Remove old fire mode 0</span>
             <span class="kw1">if</span> <span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> != <span class="kw9">none</span><span class="br0">)</span>
                 FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">Destroy</span><span class="br0">(</span><span class="br0">)</span>;
             <span class="co1">// primary fire</span>
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> = Spawn<span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeLauncher_Primary_poison'</span>, <span class="kw8">self</span><span class="br0">)</span>;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">ThisModeNum</span> = <span class="nu0">0</span>;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">Weapon</span> = <span class="kw8">self</span>;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">Instigator</span> = Instigator;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">AmmoClass</span>=<span class="kw5">class</span><span class="st0">'GrenadeAmmoPoison'</span>;    <span class="co1">// need these two to change the ammo</span>
             Ammo<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> = Ammunition<span class="br0">(</span>Instigator.<span class="me1">FindInventoryType</span><span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">AmmoClass</span><span class="br0">)</span><span class="br0">)</span>;
             <span class="co1">// Remove old fire mode 1</span>
             <span class="kw1">if</span> <span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> != <span class="kw9">none</span><span class="br0">)</span>
                 FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">Destroy</span><span class="br0">(</span><span class="br0">)</span>;
             <span class="co1">// secondary fire</span>
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> = Spawn<span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeLauncher_Secondary_poison'</span>, <span class="kw8">self</span><span class="br0">)</span>;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">ThisModeNum</span> = <span class="nu0">1</span>;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">Weapon</span> = <span class="kw8">self</span>;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">Instigator</span> = Instigator;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">AmmoClass</span>=<span class="kw5">class</span><span class="st0">'GrenadeAmmopoison'</span>;
             Ammo<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> = Ammunition<span class="br0">(</span>Instigator.<span class="me1">FindInventoryType</span><span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">AmmoClass</span><span class="br0">)</span><span class="br0">)</span>;
 
             <span class="co1">// Remove old Attchment and spawn new one with correct skin</span>
             <span class="kw1">if</span> <span class="br0">(</span> AttachmentClass != <span class="kw9">none</span><span class="br0">)</span>
               DetachFromPawn<span class="br0">(</span>instigator<span class="br0">)</span>;
             AttachmentClass=<span class="kw5">class</span><span class="st0">'GrenadeLauncher_PoisonAttachment'</span>;
             AttachToPawn<span class="br0">(</span>Instigator<span class="br0">)</span>;
             PickupClass=<span class="kw5">class</span><span class="st0">'GrenadeLauncher_PoisonPickup'</span>;
             <span class="kw1">Break</span>;
         <span class="br0">}</span>
      <span class="br0">}</span>
      <span class="kw1">if</span> <span class="br0">(</span>Count == <span class="nu0">3</span><span class="br0">)</span>
      <span class="br0">{</span>
         count = <span class="nu0">0</span>;  <span class="co1">// reset counter on last type of ammo</span>
         Inv = <a href="/Pawn"><span class="kw10">Pawn</span></a><span class="br0">(</span>Owner<span class="br0">)</span>.<span class="me1">FindInventoryType</span><span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeAmmoStandard'</span><span class="br0">)</span>;
         <span class="kw1">if</span> <span class="br0">(</span>Inv  != <span class="kw9">none</span>  &amp;&amp; Ammunition<span class="br0">(</span>inv<span class="br0">)</span>.<span class="me1">HasAmmo</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>
         <span class="br0">{</span>
             bChangedAmmo=<span class="kw9">true</span>;
             <span class="co1">// Remove old fire mode 0</span>
             <span class="kw1">if</span> <span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> != <span class="kw9">none</span><span class="br0">)</span>
                 FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">Destroy</span><span class="br0">(</span><span class="br0">)</span>;
             <span class="co1">// primary fire</span>
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> = Spawn<span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeLauncher_Primary'</span>, <span class="kw8">self</span><span class="br0">)</span>;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">ThisModeNum</span> = <span class="nu0">0</span>;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">Weapon</span> = <span class="kw8">self</span>;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">Instigator</span> = Instigator;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">AmmoClass</span>=<span class="kw5">class</span><span class="st0">'GrenadeAmmoStandard'</span>;
             Ammo<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> = Ammunition<span class="br0">(</span>Instigator.<span class="me1">FindInventoryType</span><span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">AmmoClass</span><span class="br0">)</span><span class="br0">)</span>;
             <span class="co1">// Remove old fire mode 1</span>
             <span class="kw1">if</span> <span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> != <span class="kw9">none</span><span class="br0">)</span>
                 FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">Destroy</span><span class="br0">(</span><span class="br0">)</span>;
             <span class="co1">// secondary fire</span>
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> = Spawn<span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeLauncher_Secondary'</span>, <span class="kw8">self</span><span class="br0">)</span>;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">ThisModeNum</span> = <span class="nu0">1</span>;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">Weapon</span> = <span class="kw8">self</span>;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">Instigator</span> = Instigator;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">AmmoClass</span>=<span class="kw5">class</span><span class="st0">'GrenadeAmmoStandard'</span>;
             Ammo<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> = Ammunition<span class="br0">(</span>Instigator.<span class="me1">FindInventoryType</span><span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">AmmoClass</span><span class="br0">)</span><span class="br0">)</span>;
 
             <span class="co1">// Remove old Attchment and spawn new one with correct skin</span>
             <span class="kw1">if</span> <span class="br0">(</span> AttachmentClass != <span class="kw9">none</span><span class="br0">)</span>
                 DetachFromPawn<span class="br0">(</span>instigator<span class="br0">)</span>;
             AttachmentClass=<span class="kw5">class</span><span class="st0">'GrenadeLauncher_Attachment'</span>;
             AttachToPawn<span class="br0">(</span>Instigator<span class="br0">)</span>;
             PickupClass=<span class="kw5">class</span><span class="st0">'GrenadeLauncher_Pickup'</span>;
             <span class="kw1">Break</span>;
         <span class="br0">}</span>
      <span class="br0">}</span>
    <span class="br0">}</span>
    bChangedAmmo=<span class="kw9">false</span>; <span class="co1">// set to flase as we have changed ammo at this point and need to reset the flag</span>
<span class="br0">}</span>
</pre></div>
<p>The next key function is the ammo check. The default HasAmmo only looks at the current fire types. With a weapon that has more than one, this is no good. We changed ours to look for the inventory types of each possible ammo type:</p>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="co1">// needed to overide the weapons call as we have a multi-ammo weapon</span>
<span class="kw6">simulated</span> <span class="kw5">function</span> <span class="kw4">bool</span> HasAmmo<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
       <span class="kw5">local</span> Inventory Inv;
 
       inv = <a href="/Pawn"><span class="kw10">Pawn</span></a><span class="br0">(</span>Owner<span class="br0">)</span>.<span class="me1">FindInventoryType</span><span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeAmmoNapalm'</span><span class="br0">)</span>;
       <span class="kw1">if</span> <span class="br0">(</span>inv != <span class="kw9">none</span>  &amp;&amp; Ammunition<span class="br0">(</span>inv<span class="br0">)</span>.<span class="me1">HasAmmo</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>
         <span class="kw1">return</span> <span class="kw9">true</span>;
       inv = <a href="/Pawn"><span class="kw10">Pawn</span></a><span class="br0">(</span>Owner<span class="br0">)</span>.<span class="me1">FindInventoryType</span><span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeAmmoFlash'</span><span class="br0">)</span>;
       <span class="kw1">if</span> <span class="br0">(</span>inv != <span class="kw9">none</span>  &amp;&amp; Ammunition<span class="br0">(</span>inv<span class="br0">)</span>.<span class="me1">HasAmmo</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>
         <span class="kw1">return</span> <span class="kw9">true</span>;
       inv = <a href="/Pawn"><span class="kw10">Pawn</span></a><span class="br0">(</span>Owner<span class="br0">)</span>.<span class="me1">FindInventoryType</span><span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeAmmoPoison'</span><span class="br0">)</span>;
       <span class="kw1">if</span> <span class="br0">(</span>inv != <span class="kw9">none</span>  &amp;&amp; Ammunition<span class="br0">(</span>inv<span class="br0">)</span>.<span class="me1">HasAmmo</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>
         <span class="kw1">return</span> <span class="kw9">true</span>;
       inv = <a href="/Pawn"><span class="kw10">Pawn</span></a><span class="br0">(</span>Owner<span class="br0">)</span>.<span class="me1">FindInventoryType</span><span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeAmmoStandard'</span><span class="br0">)</span>;
       <span class="kw1">if</span> <span class="br0">(</span>inv != <span class="kw9">none</span>  &amp;&amp; Ammunition<span class="br0">(</span>inv<span class="br0">)</span>.<span class="me1">HasAmmo</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>
         <span class="kw1">return</span> <span class="kw9">true</span>;
       <span class="kw1">return</span> <span class="kw9">false</span>; <span class="co1">// if we got this far no ammo for nade launcher</span>
<span class="br0">}</span>
</pre></div>
<p>The next function we needed to change was the Outofammo(). The reason for this change is that the standard Outofammo function is not aware that you have more than one ammo type. So it should check to see if you have any of the other ammotypes in your current inventory. If it does not find any you are truly out of ammo. If it does, then you should change ammo types:</p>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="co1">// needed to add this check for a multi-ammo weapon</span>
<span class="kw6">simulated</span> <span class="kw5">function</span> OutOfAmmo<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
 
   <span class="kw1">if</span> <span class="br0">(</span><span class="kw8">Level</span>.<span class="kw8">NetMode</span> == <span class="kw9">NM_Standalone</span> &amp;&amp; !Instigator.<span class="me1">IsLocallyControlled</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>
      <span class="kw1">return</span>;
 
    <span class="kw1">if</span> <span class="br0">(</span><span class="br0">(</span>Ammo<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> != <span class="kw9">None</span> &amp;&amp; FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> != <span class="kw9">None</span> &amp;&amp; Ammo<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">AmmoAmount</span> &gt;= FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">AmmoPerFire</span><span class="br0">)</span> || <span class="br0">(</span>Ammo<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> != <span class="kw9">none</span> &amp;&amp; FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> != <span class="kw9">none</span> &amp;&amp; Ammo<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">AmmoAmount</span> &gt;= FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">AmmoPerFire</span><span class="br0">)</span> <span class="br0">)</span>
    <span class="br0">{</span>
        <span class="kw1">return</span>; <span class="co1">// we have ammo return</span>
    <span class="br0">}</span>
    <span class="kw1">else</span>
    <span class="br0">{</span>
        <span class="kw1">if</span> <span class="br0">(</span>HasAmmo<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>
        <span class="br0">{</span>
            ChangeAmmo<span class="br0">(</span><span class="br0">)</span>; <span class="co1">// meaning we have some type of nade ammo change to it</span>
        <span class="br0">}</span>
        <span class="kw1">else</span>
        <span class="br0">{</span>
            <span class="co1">//if we have gotten to this point we are really out of ammo...better swich weapons</span>
            DoAutoSwitch<span class="br0">(</span><span class="br0">)</span>;
        <span class="br0">}</span>
     <span class="br0">}</span>
<span class="br0">}</span>
</pre></div>
<p>That is the basics you will need. What if your new ammo type required a 1st person view mesh change? If you pickup up a dropped version what skin/mesh will be displayed on your screen? What about network replications? How does the animations play? What happens when a users tries to fire during an ammo change? What happens if you run out of ammo while your firing? This is where we have to get a bit ugly as the code above will have all of these are issues.</p>
<p><a name="Complete_Code" id="Complete_Code"></a></p>
<h2><span class="mw-headline">Complete Code</span></h2>
<p>Since we have more than one weapon that supports multi-ammo types we decided to use a parent class and place in some specific code to help with network replication, changing of the mesh/skins and animations.</p>
<p>The parent class of the weapon is this:</p>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="co1">//=============================================================================</span>
<span class="co1">// ChaosWeapon</span>
<span class="co1">//=============================================================================</span>
<span class="kw5">class</span> ChaosWeapon <span class="kw5">extends</span> Weapon <span class="kw6">abstract</span>;
 
<span class="kw5">var</span> <span class="kw4">int</span> count;                        <span class="co1">// use this to keep track of the current selected ammo and replicate this to clients</span>
<span class="kw5">var</span> <span class="kw4">bool</span> bChangedAmmo;      <span class="co1">// use this flag to break out of loop  in change ammo functions and replicate this to clients</span>
<span class="kw5">var</span> <span class="kw4">Int</span> OldCount;                   <span class="co1">// used to tell us when to play the "changeammo" function and do not replicate this to clients</span>
<span class="kw5">var</span> <span class="kw4">bool</span> bPlayChangeAmmo; <span class="co1">// used by the Animnotify to tell use when to change mesh/skins and do not replicate this to clients</span>
 
<span class="kw1">replication</span>
<span class="br0">{</span>
    <span class="co1">// Things the server should send to the client.</span>
    <span class="kw6">reliable</span> <span class="kw1">if</span><span class="br0">(</span> <span class="kw8">Role</span>==<span class="kw9">ROLE_Authority</span> <span class="br0">)</span>
        count, bChangedAmmo;
 
    <span class="co1">// functions called by client on server</span>
    <span class="kw6">reliable</span> <span class="kw1">if</span><span class="br0">(</span> Role&lt;ROLE_Authority <span class="br0">)</span>
        ChangeAmmo;
<span class="br0">}</span>
 
<span class="co1">//---</span>
<span class="co1">// ChangeAmmo</span>
<span class="co1">//   *Switches ammo types.</span>
<span class="co1">//   *Implemented in subclasses.</span>
<span class="co1">// ---</span>
<span class="kw6">exec</span> <span class="kw5">function</span> ChangeAmmo<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
<span class="br0">}</span>
 
<span class="co1">//---</span>
<span class="co1">// Timer</span>
<span class="co1">//   * This is needed to help us prevent playing animations client side during a relaod.</span>
<span class="co1">// ---</span>
<span class="kw6">Simulated</span> <span class="kw5">function</span> Timer <span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
   <span class="kw6">super</span>.<span class="me1">Timer</span><span class="br0">(</span><span class="br0">)</span>;          <span class="co1">// call to super</span>
   <span class="kw1">if</span> <span class="br0">(</span>bPlayChangeAmmo<span class="br0">)</span>    <span class="co1">// dont play the animtions if we are reloading</span>
     bPlayChangeAmmo=<span class="kw9">false</span>;
 
<span class="br0">}</span>
 
 
<span class="co1">//---</span>
<span class="co1">// PutDown()</span>
<span class="co1">//   * This is needed to help prevent ANs for multi-ammo weapons.</span>
<span class="co1">// ---</span>
<span class="kw6">simulated</span> <span class="kw5">function</span> <span class="kw4">bool</span> PutDown<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
    <span class="kw5">local</span> <span class="kw4">int</span> Mode;
 
    <span class="kw1">if</span> <span class="br0">(</span>ClientState == WS_BringUp || ClientState == WS_ReadyToFire<span class="br0">)</span>
    <span class="br0">{</span>
        <span class="co1">// For our multi-ammo weapons Instigator.PendingWeapon maybe none so check for that</span>
        <span class="kw1">if</span> <span class="br0">(</span>Instigator.<span class="me1">PendingWeapon</span> != <span class="kw9">None</span> &amp;&amp; !Instigator.<span class="me1">PendingWeapon</span>.<span class="me1">bForceSwitch</span><span class="br0">)</span>
        <span class="br0">{</span>
            <span class="kw1">for</span> <span class="br0">(</span>Mode = <span class="nu0">0</span>; Mode &lt; NUM_FIRE_MODES; Mode++<span class="br0">)</span>
            <span class="br0">{</span>
                <span class="kw1">if</span> <span class="br0">(</span>FireMode<span class="br0">[</span>Mode<span class="br0">]</span>.<span class="me1">bFireOnRelease</span> &amp;&amp; FireMode<span class="br0">[</span>Mode<span class="br0">]</span>.<span class="me1">bIsFiring</span><span class="br0">)</span>
                    <span class="kw1">return</span> <span class="kw9">false</span>;
            <span class="br0">}</span>
        <span class="br0">}</span>
 
        <span class="kw1">if</span> <span class="br0">(</span>Instigator.<span class="me1">IsLocallyControlled</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>
        <span class="br0">{</span>
            <span class="kw1">for</span> <span class="br0">(</span>Mode = <span class="nu0">0</span>; Mode &lt; NUM_FIRE_MODES; Mode++<span class="br0">)</span>
            <span class="br0">{</span>
                <span class="kw1">if</span> <span class="br0">(</span>FireMode<span class="br0">[</span>Mode<span class="br0">]</span>.<span class="me1">bIsFiring</span><span class="br0">)</span>
                    ClientStopFire<span class="br0">(</span>Mode<span class="br0">)</span>;
            <span class="br0">}</span>
 
            <span class="kw1">if</span> <span class="br0">(</span>ClientState != WS_BringUp &amp;&amp; HasAnim<span class="br0">(</span>PutDownAnim<span class="br0">)</span><span class="br0">)</span>
                PlayAnim<span class="br0">(</span>PutDownAnim, PutDownAnimRate, <span class="nu0">0.0</span><span class="br0">)</span>;
        <span class="br0">}</span>
        ClientState = WS_PutDown;
 
        SetTimer<span class="br0">(</span><span class="nu0">0.3</span>, <span class="kw9">false</span><span class="br0">)</span>;
    <span class="br0">}</span>
    <span class="kw1">for</span> <span class="br0">(</span>Mode = <span class="nu0">0</span>; Mode &lt; NUM_FIRE_MODES; Mode++<span class="br0">)</span>
    <span class="br0">{</span>
  FireMode<span class="br0">[</span>Mode<span class="br0">]</span>.<span class="me1">bServerDelayStartFire</span> = <span class="kw9">false</span>;
  FireMode<span class="br0">[</span>Mode<span class="br0">]</span>.<span class="me1">bServerDelayStopFire</span> = <span class="kw9">false</span>;
 <span class="br0">}</span>
    Instigator.<span class="me1">AmbientSound</span> = <span class="kw9">None</span>;
    OldWeapon = <span class="kw9">None</span>;
    <span class="kw1">return</span> <span class="kw9">true</span>; <span class="co1">// return false if preventing weapon switch</span>
<span class="br0">}</span>
 
 
<span class="co1">//---</span>
<span class="co1">// State WaitforAmmoChange</span>
<span class="co1">// This state helps to pause the guns unitl so that</span>
<span class="co1">// We can switch ammos</span>
<span class="co1">// ---</span>
<span class="kw6">Simulated</span> <span class="kw5">State</span> WaitforAmmoChange
<span class="br0">{</span>
   <span class="kw6">Ignores</span> ServerStartFire, ServerStopFire, ClientWeaponSet, Fire, ClientStopFire,ClientStartFire;
 
 
 Begin:
       <span class="co1">// put the fire modes to "sleep" while we run the ammo chaning animations</span>
       <span class="kw1">if</span> <span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> != <span class="kw9">none</span><span class="br0">)</span>
            FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="kw7">GotoState</span><span class="br0">(</span><span class="st0">'ChangeAmmo'</span><span class="br0">)</span>;
       <span class="kw1">if</span> <span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> != <span class="kw9">none</span><span class="br0">)</span>
            FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="kw7">GotoState</span><span class="br0">(</span><span class="st0">'ChangeAmmo'</span><span class="br0">)</span>;
       <span class="kw1">if</span> <span class="br0">(</span><span class="kw8">Level</span>.<span class="kw8">NetMode</span> == <span class="kw9">NM_DedicatedServer</span><span class="br0">)</span>
         Sleep<span class="br0">(</span><span class="nu0">1.75</span><span class="br0">)</span>;
       <span class="co1">// Ok back to normal</span>
       <span class="kw7">GotoState</span><span class="br0">(</span><span class="st0">''</span><span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
<p>Let me touch on a few parts of the above code. The count var became useful to replicate to the clients. We can use that to display client message when your changing ammo as well as help figure out which mesh/skin to change to. The next three, bChangedAmmo, OldCount, bPlayChangeAmmo were all used to help avoid network animation issues. Basically they help to tell the client when then need to change skins/mesh for the new ammo types as well as help syncing of animations in network play. The modify PutDown() was needed to help avoid AN in the logs. The only weirdo thing their is the WaitforAmmoChange state. We needed to disallow people from playing firing animations. In on-line games you would hit the change ammo key and as soon as the animation started to play you could spam the fire key. This would cause the fire animations to play however no new projectile would be spawned. Thus it looked like a bug. Using this we help to lock out user fire commands during the ammo switch and this allows the animations to play with out being interrupted. The Sleep(1.75) is an ugly hack but this cause the weapon to sleep during the reloading. Again maybe a cleaner way to do this. But it accomplishes the effect and disallows any firing during the ammo change.</p>
<p>You also probably saw that FireMode[0].GotoState('ChangeAmmo') command. And you should realize that that is not a standard state in the weapon fire class. You are correct. With multi ammo we have some issues to work around in the fire class. Again these basically help to avoid the user from firing during an ammo change. As well as they help to address when you the ammo changes and weapon changes happen automatically. Here is the parent class we use for all changing ammo fire modes:</p>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="co1">//==============================================================================</span>
<span class="co1">// CUT_ProjectileFire - by DJPaul</span>
<span class="co1">//   *$Id: CUT_ProjectileFire.uc,v 1.4 2003/07/01 12:32:54 Wormbo Exp $</span>
<span class="co1">//   *All variable ammo types should derive from this class.</span>
<span class="co1">//==============================================================================</span>
<span class="kw5">class</span> CUT_ProjectileFire <span class="kw5">extends</span> ProjectileFire <span class="kw6">abstract</span>;
 
<span class="co1">// This function below will handle the automatic reload of the weapon</span>
<span class="co1">// if we have another ammo type when the current one runes out</span>
<span class="kw5">function</span> StopFiring<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
     <span class="kw1">if</span> <span class="br0">(</span> Weapon.<span class="me1">Ammo</span><span class="br0">[</span>ThisModeNum<span class="br0">]</span>.<span class="me1">AmmoAmount</span> &lt;= <span class="nu0">0</span> <span class="br0">)</span>
       <span class="kw7">GotoState</span><span class="br0">(</span><span class="st0">'ChangeAmmo'</span><span class="br0">)</span>;
<span class="br0">}</span>
 
 
<span class="co1">// This function will disallow at the playing of the client side animation</span>
<span class="co1">// During a reload</span>
<span class="kw6">simulated</span> <span class="kw5">function</span> <span class="kw4">bool</span> AllowFire<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
 <span class="kw1">return</span> <span class="kw6">Super</span>.<span class="me1">AllowFire</span><span class="br0">(</span><span class="br0">)</span> &amp;&amp; !ChaosWeapon<span class="br0">(</span>Weapon<span class="br0">)</span>.<span class="me1">bPlayChangeAmmo</span>;
<span class="br0">}</span>
 
 
 
<span class="co1">// We need this state to previent the client side fire animations</span>
<span class="co1">// to play while the "reload" animations are playing</span>
<span class="kw5">State</span> ChangeAmmo
<span class="br0">{</span>
 <span class="kw6">Ignores</span> PlayFireEnd, PlayFiring, PlayStartHold, PlayPreFire;
 
 
  Begin:
     Sleep<span class="br0">(</span><span class="nu0">0.5</span><span class="br0">)</span>;         <span class="co1">// Wait for current firing animation to finnish</span>
     Weapon.<span class="me1">OutOfAmmo</span><span class="br0">(</span><span class="br0">)</span>;   <span class="co1">// change the ammo</span>
     Sleep<span class="br0">(</span><span class="nu0">1.50</span><span class="br0">)</span>;         <span class="co1">// lets the animations play before we try to fire</span>
     <span class="kw7">GotoState</span><span class="br0">(</span><span class="st0">''</span><span class="br0">)</span>;        <span class="co1">// ok ready to rock...</span>
<span class="br0">}</span>
 
<span class="kw5">function</span> StartBerserk<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
    FireRate = <span class="kw1">default</span>.<span class="me1">FireRate</span> * <span class="nu0">0.75</span>;
    FireAnimRate = <span class="kw1">default</span>.<span class="me1">FireAnimRate</span> / <span class="nu0">0.75</span>;
<span class="br0">}</span>
</pre></div>
<p>You can see now why we replicated the bPlayChangeAmmo to help avoid the issues of animations in network play.</p>
<p>Now for the complete GenadeLauncher code we used:</p>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="co1">//=============================================================================</span>
<span class="co1">// GrenadeLauncher - by DJPaul</span>
<span class="co1">// $Id: GrenadeLauncher.uc,v 1.34 2003/07/13 01:03:23 jb Exp $</span>
<span class="co1">//=============================================================================</span>
<span class="kw5">class</span> GrenadeLauncher <span class="kw5">extends</span> ChaosWeapon <span class="kw6">config</span><span class="br0">(</span>user<span class="br0">)</span>;
 
<span class="kw5">var</span> <a href="/sound"><span class="kw10">sound</span></a> Nadelauncher_select1;
 
 
<span class="co1">// AI Interface</span>
<span class="kw5">function</span> <span class="kw4">float</span> GetAIRating<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
 <span class="kw5">local</span> Bot B;
 <span class="kw5">local</span> <span class="kw4">float</span> EnemyDist;
 <span class="kw5">local</span> <span class="kw4">vector</span> EnemyDir;
 
 B = Bot<span class="br0">(</span>Instigator.<span class="me1">Controller</span><span class="br0">)</span>;
 <span class="kw1">if</span> <span class="br0">(</span> <span class="br0">(</span>B == <span class="kw9">None</span><span class="br0">)</span> || <span class="br0">(</span>B.<span class="me1">Enemy</span> == <span class="kw9">None</span><span class="br0">)</span> <span class="br0">)</span>
  <span class="kw1">return</span> AIRating;
 
 EnemyDir = B.<span class="me1">Enemy</span>.<span class="me1">Location</span> - Instigator.<span class="me1">Location</span>;
 EnemyDist = VSize<span class="br0">(</span>EnemyDir<span class="br0">)</span>;
 <span class="kw1">if</span> <span class="br0">(</span> EnemyDist &gt; <span class="nu0">750</span> <span class="br0">)</span>
 <span class="br0">{</span>
  <span class="kw1">if</span> <span class="br0">(</span> EnemyDist &gt; <span class="nu0">2000</span> <span class="br0">)</span>
  <span class="br0">{</span>
   <span class="kw1">if</span> <span class="br0">(</span> EnemyDist &gt; <span class="nu0">3500</span> <span class="br0">)</span>
    <span class="kw1">return</span> <span class="nu0">0.2</span>;
   <span class="kw1">return</span> <span class="br0">(</span>AIRating - <span class="nu0">0.3</span><span class="br0">)</span>;
  <span class="br0">}</span>
  <span class="kw1">if</span> <span class="br0">(</span> EnemyDir.<span class="me1">Z</span> &lt; <span class="nu0">-0.5</span> * EnemyDist <span class="br0">)</span>
   <span class="kw1">return</span> <span class="br0">(</span>AIRating - <span class="nu0">0.3</span><span class="br0">)</span>;
 <span class="br0">}</span>
 <span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">(</span> <span class="br0">(</span>B.<span class="me1">Enemy</span>.<span class="me1">Weapon</span> != <span class="kw9">None</span><span class="br0">)</span> &amp;&amp; B.<span class="me1">Enemy</span>.<span class="me1">Weapon</span>.<span class="me1">bMeleeWeapon</span> <span class="br0">)</span>
  <span class="kw1">return</span> <span class="br0">(</span>AIRating + <span class="nu0">0.35</span><span class="br0">)</span>;
 <span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">(</span> EnemyDist &lt; <span class="nu0">400</span> <span class="br0">)</span>
  <span class="kw1">return</span> <span class="br0">(</span>AIRating + <span class="nu0">0.2</span><span class="br0">)</span>;
 <span class="kw1">return</span> <span class="kw7">FMax</span><span class="br0">(</span>AIRating + <span class="nu0">0.2</span> - <span class="br0">(</span>EnemyDist - <span class="nu0">400</span><span class="br0">)</span> * <span class="nu0">0.0008</span>, <span class="nu0">0.2</span><span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="coMULTI">/* BestMode()
choose between regular or alt-fire
*/</span>
<span class="kw5">function</span> <span class="kw4">byte</span> BestMode<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
 <span class="kw5">local</span> <span class="kw4">vector</span> EnemyDir;
 <span class="kw5">local</span> <span class="kw4">float</span> EnemyDist;
 <span class="kw5">local</span> bot B;
 
 B = Bot<span class="br0">(</span>Instigator.<span class="me1">Controller</span><span class="br0">)</span>;
 <span class="kw1">if</span> <span class="br0">(</span> <span class="br0">(</span>B == <span class="kw9">None</span><span class="br0">)</span> || <span class="br0">(</span>B.<span class="me1">Enemy</span> == <span class="kw9">None</span><span class="br0">)</span> <span class="br0">)</span>
  <span class="kw1">return</span> <span class="nu0">0</span>;
 
 EnemyDir = B.<span class="me1">Enemy</span>.<span class="me1">Location</span> - Instigator.<span class="me1">Location</span>;
 EnemyDist = VSize<span class="br0">(</span>EnemyDir<span class="br0">)</span>;
 <span class="kw1">if</span> <span class="br0">(</span> EnemyDist &gt; <span class="nu0">700</span> <span class="br0">)</span>
   <span class="kw1">return</span> <span class="nu0">1</span>;
 <span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">(</span> <span class="br0">(</span>B.<span class="me1">Enemy</span>.<span class="me1">Weapon</span> != <span class="kw9">None</span><span class="br0">)</span> &amp;&amp; B.<span class="me1">Enemy</span>.<span class="me1">Weapon</span>.<span class="me1">bMeleeWeapon</span> <span class="br0">)</span>
  <span class="kw1">return</span> <span class="nu0">0</span>;
 <span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">(</span> <span class="br0">(</span>EnemyDist &lt; <span class="nu0">400</span><span class="br0">)</span> || <span class="br0">(</span>EnemyDir.<span class="me1">Z</span> &gt; <span class="nu0">30</span><span class="br0">)</span> <span class="br0">)</span>
  <span class="kw1">return</span> <span class="nu0">0</span>;
 <span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">(</span> <span class="kw7">FRand</span><span class="br0">(</span><span class="br0">)</span> &lt; <span class="nu0">0.65</span> <span class="br0">)</span>
  <span class="kw1">return</span> <span class="nu0">1</span>;
 <span class="kw1">return</span> <span class="nu0">0</span>;
<span class="br0">}</span>
 
<span class="kw5">function</span> <span class="kw4">float</span> SuggestAttackStyle<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
 <span class="kw1">if</span> <span class="br0">(</span> <span class="br0">(</span>AIController<span class="br0">(</span>Instigator.<span class="me1">Controller</span><span class="br0">)</span> != <span class="kw9">None</span><span class="br0">)</span>
  &amp;&amp; <span class="br0">(</span>AIController<span class="br0">(</span>Instigator.<span class="me1">Controller</span><span class="br0">)</span>.<span class="me1">Skill</span> &lt; <span class="nu0">3</span><span class="br0">)</span> <span class="br0">)</span>
  <span class="kw1">return</span> <span class="nu0">0.4</span>;
    <span class="kw1">return</span> <span class="nu0">0.8</span>;
<span class="br0">}</span>
 
<span class="kw5">function</span> <span class="kw4">float</span> SuggestDefenseStyle<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
    <span class="kw1">return</span> <span class="nu0">-0.4</span>;
<span class="br0">}</span>
<span class="co1">// End AI Interface</span>
 
 
<span class="co1">// charge is used to both increase volecity and for the time delay if app,</span>
<span class="kw6">simulated</span> <span class="kw5">function</span> <span class="kw4">float</span> ChargeBar<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
    <span class="kw1">if</span> <span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">bIsFiring</span><span class="br0">)</span>
       <span class="kw1">return</span> <span class="kw7">FMin</span><span class="br0">(</span><span class="nu0">1</span>,FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">HoldTime</span>/GrenadeLauncher_SecondaryFireModeAbstract<span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span><span class="br0">)</span>.<span class="me1">MaxStrength</span><span class="br0">)</span>;
    <span class="kw1">else</span>
       <span class="kw1">return</span> <span class="nu0">0.0</span>;
<span class="br0">}</span>
 
<span class="kw6">simulated</span> <span class="kw5">function</span> <span class="kw8">tick</span> <span class="br0">(</span><span class="kw4">float</span> dt<span class="br0">)</span>
<span class="br0">{</span>
   <span class="co1">// check for an ammo change and if so...change the 1st view skin..</span>
   <span class="co1">// and play a reloading animation</span>
    <span class="kw1">if</span> <span class="br0">(</span>OldCount != Count<span class="br0">)</span>
 <span class="br0">{</span>
        OldCount = Count;
        bPlayChangeAmmo=<span class="kw9">True</span>;
        PlayChangeAmmo<span class="br0">(</span><span class="br0">)</span>;
    <span class="br0">}</span>
<span class="br0">}</span>
 
<span class="kw6">Simulated</span> <span class="kw5">function</span> PlayChangeAmmo<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
     <span class="co1">// Because we have to swtich the skin we will have the animation call (via an amin notify)</span>
     <span class="co1">// the PlayAmmoMeshSwitch() function to ensure we are snyced as we dont want to swtich the</span>
     <span class="co1">// skin until we have finnshed playing the AmmoDown animation</span>
 
     <span class="co1">// use this timer to let animtions finnish playing </span>
     SetTimer<span class="br0">(</span><span class="nu0">2.0</span>, <span class="kw9">true</span><span class="br0">)</span>;
     <span class="co1">// Play the down animations here</span>
     PlayAnim<span class="br0">(</span><span class="st0">'AmmoDown'</span>, <span class="nu0">1.25</span>, <span class="nu0">0.3</span><span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="kw6">simulated</span> <span class="kw5">function</span> PlayAmmoMeshSwitch<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
   <span class="co1">// The animnotify will fire off this function when the weapon is playing the Ammodown animation at the 9th frame</span>
   <span class="co1">// and the bPlayChangeAmmo flag is used to know that we are indeed in a changing of ammo sequnce</span>
    <span class="kw1">if</span> <span class="br0">(</span>bPlayChangeAmmo<span class="br0">)</span>
    <span class="br0">{</span>
        <span class="co1">// Change 1st Skin here</span>
        Skins<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>=<a href="/Texture"><span class="kw10">Texture</span></a><span class="st0">'ChaosTex_001.Nades.Chaos_Nadelauncher_id1'</span>;
        <span class="kw1">Switch</span> <span class="br0">(</span>Count<span class="br0">)</span> <span class="br0">{</span>
        <span class="kw1">Case</span> <span class="nu0">1</span>:
            Skins<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>= <a href="/Texture"><span class="kw10">Texture</span></a><span class="st0">'ChaosTex_001.Nades.Chaos_NadeFlame'</span>;
            Skins<span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span>= <a href="/Texture"><span class="kw10">Texture</span></a><span class="st0">'ChaosTex_001.Nades.Chaos_Nadeshell'</span>;
            Skins<span class="br0">[</span><span class="nu0">3</span><span class="br0">]</span>= FinalBlend<span class="st0">'XEffectMat.Shield.RedShell'</span>;
            <span class="kw1">if</span> <span class="br0">(</span>PlayerController<span class="br0">(</span>Instigator.<span class="me1">Controller</span><span class="br0">)</span> != <span class="kw9">none</span><span class="br0">)</span>
                  PlayerController<span class="br0">(</span>Instigator.<span class="me1">Controller</span><span class="br0">)</span>.<span class="me1">ReceiveLocalizedMessage</span><span class="br0">(</span><span class="kw5">class</span><span class="st0">'NapalmAmmoChangeNotification'</span>, <span class="nu0">0</span>, <span class="kw9">none</span>, <span class="kw9">none</span>, FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="kw5">Class</span><span class="br0">)</span>;
            PlayOwnedSound<span class="br0">(</span>Nadelauncher_select1, SLOT_Interact,,,,, <span class="kw9">false</span><span class="br0">)</span>;
            <span class="kw1">break</span>;
        <span class="kw1">Case</span> <span class="nu0">2</span>:
            Skins<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>= <a href="/Texture"><span class="kw10">Texture</span></a><span class="st0">'ChaosTex_001.Nades.chaos_nadeflash'</span>;
            Skins<span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span>= <a href="/Texture"><span class="kw10">Texture</span></a><span class="st0">'ChaosTex_001.Nades.Chaos_NadeshellFlash'</span>;
            Skins<span class="br0">[</span><span class="nu0">3</span><span class="br0">]</span>= Shader<span class="st0">'XGameShaders.PlayerShaders.LightningHit'</span>;
            <span class="kw1">if</span> <span class="br0">(</span>PlayerController<span class="br0">(</span>Instigator.<span class="me1">Controller</span><span class="br0">)</span> != <span class="kw9">none</span><span class="br0">)</span>
                 PlayerController<span class="br0">(</span>Instigator.<span class="me1">Controller</span><span class="br0">)</span>.<span class="me1">ReceiveLocalizedMessage</span><span class="br0">(</span><span class="kw5">class</span><span class="st0">'FlashAmmoChangeNotification'</span>, <span class="nu0">0</span>, <span class="kw9">none</span>, <span class="kw9">none</span>, FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="kw5">Class</span><span class="br0">)</span>;
            PlayOwnedSound<span class="br0">(</span>Nadelauncher_select1, SLOT_Interact,,,,, <span class="kw9">false</span><span class="br0">)</span>;
            <span class="kw1">break</span>;
        <span class="kw1">Case</span> <span class="nu0">3</span>:
             Skins<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>= <a href="/Texture"><span class="kw10">Texture</span></a><span class="st0">'ChaosTex_001.Nades.chaos_nadepoison'</span>;
             Skins<span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span>= <a href="/Texture"><span class="kw10">Texture</span></a><span class="st0">'ChaosTex_001.Nades.Chaos_NadeshellPoison'</span>;
             Skins<span class="br0">[</span><span class="nu0">3</span><span class="br0">]</span>= FinalBlend<span class="st0">'XEffectMat.goop.GoopFB'</span>;
             <span class="kw1">if</span> <span class="br0">(</span>PlayerController<span class="br0">(</span>Instigator.<span class="me1">Controller</span><span class="br0">)</span> != <span class="kw9">none</span><span class="br0">)</span>
                 PlayerController<span class="br0">(</span>Instigator.<span class="me1">Controller</span><span class="br0">)</span>.<span class="me1">ReceiveLocalizedMessage</span><span class="br0">(</span><span class="kw5">class</span><span class="st0">'PoisonAmmoChangeNotification'</span>, <span class="nu0">0</span>, <span class="kw9">none</span>, <span class="kw9">none</span>, FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="kw5">Class</span><span class="br0">)</span>;
             PlayOwnedSound<span class="br0">(</span>Nadelauncher_select1, SLOT_Interact,,,,, <span class="kw9">false</span><span class="br0">)</span>;
             <span class="kw1">break</span>;
        <span class="kw1">default</span>:
            Skins<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>= <a href="/Texture"><span class="kw10">Texture</span></a><span class="st0">'ChaosTex_001.Nades.chaos_nadeexplo'</span>;
            Skins<span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span>= <a href="/Texture"><span class="kw10">Texture</span></a><span class="st0">'ChaosTex_001.Nades.Chaos_Nadeshell'</span>;
            Skins<span class="br0">[</span><span class="nu0">3</span><span class="br0">]</span>= <a href="/Texture"><span class="kw10">Texture</span></a><span class="st0">'WeaponSkins.Skins.GrenadeTex'</span>;
            <span class="kw1">if</span> <span class="br0">(</span>PlayerController<span class="br0">(</span>Instigator.<span class="me1">Controller</span><span class="br0">)</span> != <span class="kw9">none</span><span class="br0">)</span>
                  PlayerController<span class="br0">(</span>Instigator.<span class="me1">Controller</span><span class="br0">)</span>.<span class="me1">ReceiveLocalizedMessage</span><span class="br0">(</span><span class="kw5">class</span><span class="st0">'ExplosiveAmmoChangeNotification'</span>, <span class="nu0">0</span>, <span class="kw9">none</span>, <span class="kw9">none</span>, FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="kw5">Class</span><span class="br0">)</span>;
            PlayOwnedSound<span class="br0">(</span>Nadelauncher_select1, SLOT_Interact,,,,, <span class="kw9">false</span><span class="br0">)</span>;
            <span class="kw1">break</span>;
        <span class="br0">}</span>
        <span class="co1">// now we have changed the skins on the 1st views play the Ammoup animation</span>
        Playanim<span class="br0">(</span><span class="st0">'AmmoUp'</span>, <span class="nu0">1.2</span>, <span class="nu0">0.3</span><span class="br0">)</span>;
     <span class="br0">}</span>
<span class="br0">}</span>
 
 
<span class="co1">// needed to overide the weapons call as we have a multi-ammo weapon</span>
<span class="kw6">simulated</span> <span class="kw5">function</span> <span class="kw4">bool</span> HasAmmo<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
       <span class="kw5">local</span> Inventory Inv;
 
       inv = <a href="/Pawn"><span class="kw10">Pawn</span></a><span class="br0">(</span>Owner<span class="br0">)</span>.<span class="me1">FindInventoryType</span><span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeAmmoNapalm'</span><span class="br0">)</span>;
       <span class="kw1">if</span> <span class="br0">(</span>inv != <span class="kw9">none</span>  &amp;&amp; Ammunition<span class="br0">(</span>inv<span class="br0">)</span>.<span class="me1">HasAmmo</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>
         <span class="kw1">return</span> <span class="kw9">true</span>;
       inv = <a href="/Pawn"><span class="kw10">Pawn</span></a><span class="br0">(</span>Owner<span class="br0">)</span>.<span class="me1">FindInventoryType</span><span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeAmmoFlash'</span><span class="br0">)</span>;
       <span class="kw1">if</span> <span class="br0">(</span>inv != <span class="kw9">none</span>  &amp;&amp; Ammunition<span class="br0">(</span>inv<span class="br0">)</span>.<span class="me1">HasAmmo</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>
         <span class="kw1">return</span> <span class="kw9">true</span>;
       inv = <a href="/Pawn"><span class="kw10">Pawn</span></a><span class="br0">(</span>Owner<span class="br0">)</span>.<span class="me1">FindInventoryType</span><span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeAmmoPoison'</span><span class="br0">)</span>;
       <span class="kw1">if</span> <span class="br0">(</span>inv != <span class="kw9">none</span>  &amp;&amp; Ammunition<span class="br0">(</span>inv<span class="br0">)</span>.<span class="me1">HasAmmo</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>
         <span class="kw1">return</span> <span class="kw9">true</span>;
       inv = <a href="/Pawn"><span class="kw10">Pawn</span></a><span class="br0">(</span>Owner<span class="br0">)</span>.<span class="me1">FindInventoryType</span><span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeAmmoStandard'</span><span class="br0">)</span>;
       <span class="kw1">if</span> <span class="br0">(</span>inv != <span class="kw9">none</span>  &amp;&amp; Ammunition<span class="br0">(</span>inv<span class="br0">)</span>.<span class="me1">HasAmmo</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>
         <span class="kw1">return</span> <span class="kw9">true</span>;
       <span class="kw1">return</span> <span class="kw9">false</span>; <span class="co1">// if we got this far no ammo for nade launcher</span>
<span class="br0">}</span>
 
<span class="co1">// needed to add this check for a multi-ammo weapon</span>
<span class="kw6">simulated</span> <span class="kw5">function</span> BringUp<span class="br0">(</span><span class="kw6">optional</span> Weapon PrevWeapon<span class="br0">)</span>
<span class="br0">{</span>
    OutOfAmmo<span class="br0">(</span><span class="br0">)</span>;  <span class="co1">// check to make sure we have some type of ammo</span>
    <span class="co1">// Make sure we load the right skin... but don't wast server time with this...</span>
    <span class="kw1">If</span><span class="br0">(</span><span class="kw8">Level</span>.<span class="kw8">NetMode</span> != <span class="kw9">NM_DedicatedServer</span><span class="br0">)</span>
    <span class="br0">{</span>
        Skins<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>=<a href="/Texture"><span class="kw10">Texture</span></a><span class="st0">'ChaosTex_001.Nades.Chaos_Nadelauncher_id1'</span>;
        <span class="kw1">if</span> <span class="br0">(</span>Count == <span class="nu0">1</span><span class="br0">)</span>
        <span class="br0">{</span>
            Skins<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>= <a href="/Texture"><span class="kw10">Texture</span></a><span class="st0">'ChaosTex_001.Nades.Chaos_NadeFlame'</span>;
            Skins<span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span>= <a href="/Texture"><span class="kw10">Texture</span></a><span class="st0">'ChaosTex_001.Nades.Chaos_Nadeshell'</span>;
            Skins<span class="br0">[</span><span class="nu0">3</span><span class="br0">]</span>= FinalBlend<span class="st0">'XEffectMat.Shield.RedShell'</span>;
        <span class="br0">}</span>
        <span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">(</span>Count == <span class="nu0">2</span><span class="br0">)</span>
        <span class="br0">{</span>
            Skins<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>= <a href="/Texture"><span class="kw10">Texture</span></a><span class="st0">'ChaosTex_001.Nades.chaos_nadeflash'</span>;
            Skins<span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span>= <a href="/Texture"><span class="kw10">Texture</span></a><span class="st0">'ChaosTex_001.Nades.Chaos_NadeshellFlash'</span>;
            Skins<span class="br0">[</span><span class="nu0">3</span><span class="br0">]</span>= Shader<span class="st0">'XGameShaders.PlayerShaders.LightningHit'</span>;
        <span class="br0">}</span>
        <span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">(</span>Count == <span class="nu0">3</span><span class="br0">)</span>
        <span class="br0">{</span>
             Skins<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>= <a href="/Texture"><span class="kw10">Texture</span></a><span class="st0">'ChaosTex_001.Nades.chaos_nadepoison'</span>;
             Skins<span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span>= <a href="/Texture"><span class="kw10">Texture</span></a><span class="st0">'ChaosTex_001.Nades.Chaos_NadeshellPoison'</span>;
             Skins<span class="br0">[</span><span class="nu0">3</span><span class="br0">]</span>= FinalBlend<span class="st0">'XEffectMat.goop.GoopFB'</span>;
        <span class="br0">}</span>
        <span class="kw1">else</span>
        <span class="br0">{</span>
            Skins<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>= <a href="/Texture"><span class="kw10">Texture</span></a><span class="st0">'ChaosTex_001.Nades.chaos_nadeexplo'</span>;
            Skins<span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span>= <a href="/Texture"><span class="kw10">Texture</span></a><span class="st0">'ChaosTex_001.Nades.Chaos_Nadeshell'</span>;
            Skins<span class="br0">[</span><span class="nu0">3</span><span class="br0">]</span>= <a href="/Texture"><span class="kw10">Texture</span></a><span class="st0">'WeaponSkins.Skins.GrenadeTex'</span>;
        <span class="br0">}</span>
     <span class="br0">}</span>
     <span class="kw6">Super</span>.<span class="me1">BringUp</span><span class="br0">(</span><span class="br0">)</span>;
<span class="br0">}</span>
 
<span class="co1">// needed to add this check for a multi-ammo weapon</span>
<span class="kw6">simulated</span> <span class="kw5">function</span> OutOfAmmo<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
 
   <span class="kw1">if</span> <span class="br0">(</span><span class="kw8">Level</span>.<span class="kw8">NetMode</span> == <span class="kw9">NM_Standalone</span> &amp;&amp; !Instigator.<span class="me1">IsLocallyControlled</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>
      <span class="kw1">return</span>;
 
    <span class="kw1">if</span> <span class="br0">(</span><span class="br0">(</span>Ammo<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> != <span class="kw9">None</span> &amp;&amp; FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> != <span class="kw9">None</span> &amp;&amp; Ammo<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">AmmoAmount</span> &gt;= FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">AmmoPerFire</span><span class="br0">)</span> || <span class="br0">(</span>Ammo<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> != <span class="kw9">none</span> &amp;&amp; FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> != <span class="kw9">none</span> &amp;&amp; Ammo<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">AmmoAmount</span> &gt;= FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">AmmoPerFire</span><span class="br0">)</span> <span class="br0">)</span>
    <span class="br0">{</span>
        <span class="kw1">return</span>; <span class="co1">// we have ammo return</span>
    <span class="br0">}</span>
    <span class="kw1">else</span>
    <span class="br0">{</span>
        <span class="kw1">if</span> <span class="br0">(</span>HasAmmo<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>
        <span class="br0">{</span>
            ChangeAmmo<span class="br0">(</span><span class="br0">)</span>; <span class="co1">// meaning we have some type of nade ammo change to it</span>
        <span class="br0">}</span>
        <span class="kw1">else</span>
        <span class="br0">{</span>
            <span class="co1">//if we have gotten to this point we are really out of ammo...better swich weapons</span>
            DoAutoSwitch<span class="br0">(</span><span class="br0">)</span>;
        <span class="br0">}</span>
     <span class="br0">}</span>
<span class="br0">}</span>
 
 
<span class="co1">// manual key function to swich ammo out</span>
<span class="kw6">exec</span> <span class="kw5">function</span> ChangeAmmo<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
   <span class="kw5">local</span> Inventory Inv;
 
   <span class="co1">// Check to see if they even have ammo to switch</span>
   <span class="kw1">if</span> <span class="br0">(</span>!HasAmmo<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>
     <span class="kw1">return</span>;
 
   <span class="co1">// dont let them chang ammo if they are firing</span>
   <span class="kw1">if</span> <span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">bIsFiring</span> || FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">bIsFiring</span><span class="br0">)</span>
       <span class="kw1">return</span>;
 
   <span class="co1">//DJP: Stops stuff firing when the type switches (when out of ammo).</span>
   <span class="kw1">if</span> <span class="br0">(</span><a href="/Pawn"><span class="kw10">Pawn</span></a><span class="br0">(</span>Owner<span class="br0">)</span> != <span class="kw9">none</span> &amp;&amp; <a href="/Pawn"><span class="kw10">Pawn</span></a><span class="br0">(</span>Owner<span class="br0">)</span>.<span class="me1">Controller</span> != <span class="kw9">none</span><span class="br0">)</span>
   <span class="br0">{</span>
        <a href="/Pawn"><span class="kw10">Pawn</span></a><span class="br0">(</span>Owner<span class="br0">)</span>.<span class="me1">Controller</span>.<span class="me1">bFire</span> = <span class="nu0">0</span>;
        <a href="/Pawn"><span class="kw10">Pawn</span></a><span class="br0">(</span>Owner<span class="br0">)</span>.<span class="me1">Controller</span>.<span class="me1">bAltFire</span> = <span class="nu0">0</span>;
   <span class="br0">}</span>
 
 
    <span class="kw1">while</span> <span class="br0">(</span>!bChangedAmmo<span class="br0">)</span>
    <span class="br0">{</span>
 
      <span class="kw1">if</span> <span class="br0">(</span>Count == <span class="nu0">0</span><span class="br0">)</span>
      <span class="br0">{</span>
         Count += <span class="nu0">1</span>;
 
         Inv = <a href="/Pawn"><span class="kw10">Pawn</span></a><span class="br0">(</span>Owner<span class="br0">)</span>.<span class="me1">FindInventoryType</span><span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeAmmoNapalm'</span><span class="br0">)</span>;
         <span class="kw1">if</span> <span class="br0">(</span>Inv  != <span class="kw9">none</span>  &amp;&amp; Ammunition<span class="br0">(</span>inv<span class="br0">)</span>.<span class="me1">HasAmmo</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>
         <span class="br0">{</span>
             bChangedAmmo=<span class="kw9">true</span>;
             <span class="co1">// Remove old fire mode 0</span>
             <span class="kw1">if</span> <span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> != <span class="kw9">none</span><span class="br0">)</span>
                 FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">Destroy</span><span class="br0">(</span><span class="br0">)</span>;
             <span class="co1">// primary fire</span>
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> = Spawn<span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeLauncher_Primary_napalm'</span>, <span class="kw8">self</span><span class="br0">)</span>;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">ThisModeNum</span> = <span class="nu0">0</span>;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">Weapon</span> = <span class="kw8">self</span>;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">Instigator</span> = Instigator;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">AmmoClass</span> =<span class="kw5">class</span><span class="st0">'GrenadeAmmoNapalm'</span>;    <span class="co1">// need these two to change the ammo</span>
             Ammo<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> = Ammunition<span class="br0">(</span>Instigator.<span class="me1">FindInventoryType</span><span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">AmmoClass</span><span class="br0">)</span><span class="br0">)</span>;
             <span class="co1">// Remove old fire mode 1</span>
             <span class="kw1">if</span> <span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> != <span class="kw9">none</span><span class="br0">)</span>
                 FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">Destroy</span><span class="br0">(</span><span class="br0">)</span>;
             <span class="co1">// secondary fire</span>
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> = Spawn<span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeLauncher_Secondary_napalm'</span>, <span class="kw8">self</span><span class="br0">)</span>;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">ThisModeNum</span> = <span class="nu0">1</span>;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">Weapon</span> = <span class="kw8">self</span>;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">Instigator</span> = Instigator;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">AmmoClass</span> = <span class="kw5">class</span><span class="st0">'GrenadeAmmonapalm'</span>;
             Ammo<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> = Ammunition<span class="br0">(</span>Instigator.<span class="me1">FindInventoryType</span><span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">AmmoClass</span><span class="br0">)</span><span class="br0">)</span>;
 
             <span class="co1">// Remove old Attchment and spawn new one with correct skin</span>
             <span class="kw1">if</span> <span class="br0">(</span> AttachmentClass != <span class="kw9">none</span><span class="br0">)</span>
               DetachFromPawn<span class="br0">(</span>instigator<span class="br0">)</span>;
             AttachmentClass=<span class="kw5">class</span><span class="st0">'GrenadeLauncher_NapalmAttachment'</span>;
             AttachToPawn<span class="br0">(</span>Instigator<span class="br0">)</span>;
             PickupClass=<span class="kw5">class</span><span class="st0">'GrenadeLauncher_NapalmPickup'</span>;
             <span class="kw1">Break</span>;
         <span class="br0">}</span>
      <span class="br0">}</span>
      <span class="kw1">if</span> <span class="br0">(</span>Count == <span class="nu0">1</span><span class="br0">)</span>
      <span class="br0">{</span>
         Count += <span class="nu0">1</span>;
         Inv = <a href="/Pawn"><span class="kw10">Pawn</span></a><span class="br0">(</span>Owner<span class="br0">)</span>.<span class="me1">FindInventoryType</span><span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeAmmoFlash'</span><span class="br0">)</span>;
         <span class="kw1">if</span> <span class="br0">(</span>Inv  != <span class="kw9">none</span>  &amp;&amp; Ammunition<span class="br0">(</span>inv<span class="br0">)</span>.<span class="me1">HasAmmo</span><span class="br0">(</span><span class="br0">)</span> <span class="br0">)</span>
         <span class="br0">{</span>
             bChangedAmmo=<span class="kw9">true</span>;
             <span class="co1">// Remove old fire mode 0</span>
             <span class="kw1">if</span> <span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> != <span class="kw9">none</span><span class="br0">)</span>
                 FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">Destroy</span><span class="br0">(</span><span class="br0">)</span>;
             <span class="co1">// primary fire</span>
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> = Spawn<span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeLauncher_Primary_flash'</span>, <span class="kw8">self</span><span class="br0">)</span>;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">ThisModeNum</span> = <span class="nu0">0</span>;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">Weapon</span> = <span class="kw8">self</span>;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">Instigator</span> = Instigator;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">AmmoClass</span>=<span class="kw5">class</span><span class="st0">'GrenadeAmmoFlash'</span>;    <span class="co1">// need these two to change the ammo</span>
             Ammo<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> = Ammunition<span class="br0">(</span>Instigator.<span class="me1">FindInventoryType</span><span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">AmmoClass</span><span class="br0">)</span><span class="br0">)</span>;
             <span class="co1">// Remove old fire mode 1</span>
             <span class="kw1">if</span> <span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> != <span class="kw9">none</span><span class="br0">)</span>
                 FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">Destroy</span><span class="br0">(</span><span class="br0">)</span>;
             <span class="co1">// secondary fire</span>
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> = Spawn<span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeLauncher_Secondary_flash'</span>, <span class="kw8">self</span><span class="br0">)</span>;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">ThisModeNum</span> = <span class="nu0">1</span>;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">Weapon</span> = <span class="kw8">self</span>;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">Instigator</span> = Instigator;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">AmmoClass</span>=<span class="kw5">class</span><span class="st0">'GrenadeAmmoFlash'</span>;
             Ammo<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> = Ammunition<span class="br0">(</span>Instigator.<span class="me1">FindInventoryType</span><span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">AmmoClass</span><span class="br0">)</span><span class="br0">)</span>;
 
             <span class="co1">// Remove old Attchment and spawn new one with correct skin</span>
             <span class="kw1">if</span> <span class="br0">(</span> AttachmentClass != <span class="kw9">none</span><span class="br0">)</span>
               DetachFromPawn<span class="br0">(</span>instigator<span class="br0">)</span>;
             AttachmentClass=<span class="kw5">class</span><span class="st0">'GrenadeLauncher_FlashAttachment'</span>;
             AttachToPawn<span class="br0">(</span>Instigator<span class="br0">)</span>;
             PickupClass=<span class="kw5">class</span><span class="st0">'GrenadeLauncher_FlashPickup'</span>;
             <span class="kw1">Break</span>;
         <span class="br0">}</span>
      <span class="br0">}</span>
      <span class="kw1">if</span> <span class="br0">(</span>Count == <span class="nu0">2</span><span class="br0">)</span>
      <span class="br0">{</span>
         Count += <span class="nu0">1</span>;
         Inv = <a href="/Pawn"><span class="kw10">Pawn</span></a><span class="br0">(</span>Owner<span class="br0">)</span>.<span class="me1">FindInventoryType</span><span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeAmmoPoison'</span><span class="br0">)</span>;
         <span class="kw1">if</span> <span class="br0">(</span>Inv  != <span class="kw9">none</span>  &amp;&amp; Ammunition<span class="br0">(</span>inv<span class="br0">)</span>.<span class="me1">HasAmmo</span><span class="br0">(</span><span class="br0">)</span> <span class="br0">)</span>
         <span class="br0">{</span>
             bChangedAmmo=<span class="kw9">true</span>;
             <span class="co1">// Remove old fire mode 0</span>
             <span class="kw1">if</span> <span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> != <span class="kw9">none</span><span class="br0">)</span>
                 FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">Destroy</span><span class="br0">(</span><span class="br0">)</span>;
             <span class="co1">// primary fire</span>
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> = Spawn<span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeLauncher_Primary_poison'</span>, <span class="kw8">self</span><span class="br0">)</span>;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">ThisModeNum</span> = <span class="nu0">0</span>;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">Weapon</span> = <span class="kw8">self</span>;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">Instigator</span> = Instigator;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">AmmoClass</span>=<span class="kw5">class</span><span class="st0">'GrenadeAmmoPoison'</span>;    <span class="co1">// need these two to change the ammo</span>
             Ammo<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> = Ammunition<span class="br0">(</span>Instigator.<span class="me1">FindInventoryType</span><span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">AmmoClass</span><span class="br0">)</span><span class="br0">)</span>;
             <span class="co1">// Remove old fire mode 1</span>
             <span class="kw1">if</span> <span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> != <span class="kw9">none</span><span class="br0">)</span>
                 FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">Destroy</span><span class="br0">(</span><span class="br0">)</span>;
             <span class="co1">// secondary fire</span>
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> = Spawn<span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeLauncher_Secondary_poison'</span>, <span class="kw8">self</span><span class="br0">)</span>;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">ThisModeNum</span> = <span class="nu0">1</span>;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">Weapon</span> = <span class="kw8">self</span>;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">Instigator</span> = Instigator;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">AmmoClass</span>=<span class="kw5">class</span><span class="st0">'GrenadeAmmopoison'</span>;
             Ammo<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> = Ammunition<span class="br0">(</span>Instigator.<span class="me1">FindInventoryType</span><span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">AmmoClass</span><span class="br0">)</span><span class="br0">)</span>;
 
             <span class="co1">// Remove old Attchment and spawn new one with correct skin</span>
             <span class="kw1">if</span> <span class="br0">(</span> AttachmentClass != <span class="kw9">none</span><span class="br0">)</span>
               DetachFromPawn<span class="br0">(</span>instigator<span class="br0">)</span>;
             AttachmentClass=<span class="kw5">class</span><span class="st0">'GrenadeLauncher_PoisonAttachment'</span>;
             AttachToPawn<span class="br0">(</span>Instigator<span class="br0">)</span>;
             PickupClass=<span class="kw5">class</span><span class="st0">'GrenadeLauncher_PoisonPickup'</span>;
             <span class="kw1">Break</span>;
         <span class="br0">}</span>
      <span class="br0">}</span>
      <span class="kw1">if</span> <span class="br0">(</span>Count == <span class="nu0">3</span><span class="br0">)</span>
      <span class="br0">{</span>
         count = <span class="nu0">0</span>;  <span class="co1">// reset counter on last type of ammo</span>
         Inv = <a href="/Pawn"><span class="kw10">Pawn</span></a><span class="br0">(</span>Owner<span class="br0">)</span>.<span class="me1">FindInventoryType</span><span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeAmmoStandard'</span><span class="br0">)</span>;
         <span class="kw1">if</span> <span class="br0">(</span>Inv  != <span class="kw9">none</span>  &amp;&amp; Ammunition<span class="br0">(</span>inv<span class="br0">)</span>.<span class="me1">HasAmmo</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>
         <span class="br0">{</span>
             bChangedAmmo=<span class="kw9">true</span>;
             <span class="co1">// Remove old fire mode 0</span>
             <span class="kw1">if</span> <span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> != <span class="kw9">none</span><span class="br0">)</span>
                 FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">Destroy</span><span class="br0">(</span><span class="br0">)</span>;
             <span class="co1">// primary fire</span>
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> = Spawn<span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeLauncher_Primary'</span>, <span class="kw8">self</span><span class="br0">)</span>;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">ThisModeNum</span> = <span class="nu0">0</span>;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">Weapon</span> = <span class="kw8">self</span>;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">Instigator</span> = Instigator;
             FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">AmmoClass</span>=<span class="kw5">class</span><span class="st0">'GrenadeAmmoStandard'</span>;
             Ammo<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> = Ammunition<span class="br0">(</span>Instigator.<span class="me1">FindInventoryType</span><span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">AmmoClass</span><span class="br0">)</span><span class="br0">)</span>;
             <span class="co1">// Remove old fire mode 1</span>
             <span class="kw1">if</span> <span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> != <span class="kw9">none</span><span class="br0">)</span>
                 FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">Destroy</span><span class="br0">(</span><span class="br0">)</span>;
             <span class="co1">// secondary fire</span>
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> = Spawn<span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeLauncher_Secondary'</span>, <span class="kw8">self</span><span class="br0">)</span>;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">ThisModeNum</span> = <span class="nu0">1</span>;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">Weapon</span> = <span class="kw8">self</span>;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">Instigator</span> = Instigator;
             FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">AmmoClass</span>=<span class="kw5">class</span><span class="st0">'GrenadeAmmoStandard'</span>;
             Ammo<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> = Ammunition<span class="br0">(</span>Instigator.<span class="me1">FindInventoryType</span><span class="br0">(</span>FireMode<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">AmmoClass</span><span class="br0">)</span><span class="br0">)</span>;
 
             <span class="co1">// Remove old Attchment and spawn new one with correct skin</span>
             <span class="kw1">if</span> <span class="br0">(</span> AttachmentClass != <span class="kw9">none</span><span class="br0">)</span>
                 DetachFromPawn<span class="br0">(</span>instigator<span class="br0">)</span>;
             AttachmentClass=<span class="kw5">class</span><span class="st0">'GrenadeLauncher_Attachment'</span>;
             AttachToPawn<span class="br0">(</span>Instigator<span class="br0">)</span>;
             PickupClass=<span class="kw5">class</span><span class="st0">'GrenadeLauncher_Pickup'</span>;
             <span class="kw1">Break</span>;
         <span class="br0">}</span>
      <span class="br0">}</span>
    <span class="br0">}</span>
    bChangedAmmo=<span class="kw9">false</span>; <span class="co1">// set to flase as we have changed ammo at this point and need to reset the flag</span>
    <span class="kw7">GoToState</span><span class="br0">(</span><span class="st0">'WaitforAmmoChange'</span><span class="br0">)</span>; <span class="co1">// "Pauses" the gun so that the player can load the new ammo</span>
<span class="br0">}</span>
 
 
<span class="kw5">function</span> GiveTo<span class="br0">(</span><a href="/Pawn"><span class="kw10">Pawn</span></a> Other, <span class="kw6">optional</span> Pickup Pickup<span class="br0">)</span>
<span class="br0">{</span>
 <span class="kw5">local</span> Inventory Inv;
 
 <span class="kw6">Super</span>.<span class="me1">GiveTo</span><span class="br0">(</span>Other, Pickup<span class="br0">)</span>;
 
 <span class="co1">// add empty ammo for player (for Mutant, Last Man Standing and AllAmmo)</span>
 <span class="kw1">if</span> <span class="br0">(</span> !bDeleteMe <span class="br0">)</span> <span class="br0">{</span>
  Inv = <a href="/Pawn"><span class="kw10">Pawn</span></a><span class="br0">(</span>Owner<span class="br0">)</span>.<span class="me1">FindInventoryType</span><span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeAmmoStandard'</span><span class="br0">)</span>;
  <span class="kw1">if</span> <span class="br0">(</span> Inv == <span class="kw9">None</span> <span class="br0">)</span> <span class="br0">{</span>
   Inv = Spawn<span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeAmmoStandard'</span><span class="br0">)</span>;
   Ammunition<span class="br0">(</span>Inv<span class="br0">)</span>.<span class="me1">AmmoAmount</span> = <span class="nu0">0</span>;
   Inv.<span class="me1">GiveTo</span><span class="br0">(</span>Other<span class="br0">)</span>;
  <span class="br0">}</span>
  Inv = <a href="/Pawn"><span class="kw10">Pawn</span></a><span class="br0">(</span>Owner<span class="br0">)</span>.<span class="me1">FindInventoryType</span><span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeAmmoNapalm'</span><span class="br0">)</span>;
  <span class="kw1">if</span> <span class="br0">(</span> Inv == <span class="kw9">None</span> <span class="br0">)</span> <span class="br0">{</span>
   Inv = Spawn<span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeAmmoNapalm'</span><span class="br0">)</span>;
   Ammunition<span class="br0">(</span>Inv<span class="br0">)</span>.<span class="me1">AmmoAmount</span> = <span class="nu0">0</span>;
   Inv.<span class="me1">GiveTo</span><span class="br0">(</span>Other<span class="br0">)</span>;
  <span class="br0">}</span>
  Inv = <a href="/Pawn"><span class="kw10">Pawn</span></a><span class="br0">(</span>Owner<span class="br0">)</span>.<span class="me1">FindInventoryType</span><span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeAmmoPoison'</span><span class="br0">)</span>;
  <span class="kw1">if</span> <span class="br0">(</span> Inv == <span class="kw9">None</span> <span class="br0">)</span> <span class="br0">{</span>
   Inv = Spawn<span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeAmmoPoison'</span><span class="br0">)</span>;
   Ammunition<span class="br0">(</span>Inv<span class="br0">)</span>.<span class="me1">AmmoAmount</span> = <span class="nu0">0</span>;
   Inv.<span class="me1">GiveTo</span><span class="br0">(</span>Other<span class="br0">)</span>;
  <span class="br0">}</span>
  Inv = <a href="/Pawn"><span class="kw10">Pawn</span></a><span class="br0">(</span>Owner<span class="br0">)</span>.<span class="me1">FindInventoryType</span><span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeAmmoFlash'</span><span class="br0">)</span>;
  <span class="kw1">if</span> <span class="br0">(</span> Inv == <span class="kw9">None</span> <span class="br0">)</span> <span class="br0">{</span>
   Inv = Spawn<span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeAmmoFlash'</span><span class="br0">)</span>;
   Ammunition<span class="br0">(</span>Inv<span class="br0">)</span>.<span class="me1">AmmoAmount</span> = <span class="nu0">0</span>;
   Inv.<span class="me1">GiveTo</span><span class="br0">(</span>Other<span class="br0">)</span>;
  <span class="br0">}</span>
 <span class="br0">}</span>
<span class="br0">}</span>
</pre></div>
<p>Whew. Big and ugly. Again I should touch on a few key points. In the tick we needed to modify it to tell the client that we have changed ammo and we need to play the changeammo animations as well as change the skin. That's where the vars from the ChaosWeapon were used. The PlayChangeAmmo() was used to kick off the animation of the changing of the ammo. However we uses different skins for the different ammo type loaded into the 1st view of the weapon. So we needed to change the skins. We want to wait until the 1st model is out of view before we change the skin. We used an AnimNotify in the animation file to do this. We broke the animation up into two parts, an Ammodown then and Ammoup. Ammodown plays the "unloading" part. At the 2nd to the last frame of that AmmoDown animation we set up the AnimNotify to call the PlayAmmoMeshSwitch() function. This function will then change to the new skin (or mesh) and then play the up animation. Thus the skin/mesh changing all happens out of view of the player and when see the AmmoUp animation play its playing with the correct skin (or mesh). Please note that for this example we just changed the skin. In the other weapons we had to change the weapon mesh and did that in the PlayAmmoMeshSwitch() as well. We also play to the client a change ammo message. This is not needed. The BringUp() function needed to be modify to handle the dropped weapons. With out a check for the skins (or mesh) you would get the default skin/mesh of the weapon and not the current loaded ammo skin/mesh. The rest is more or less standard "stuff'.</p>
<p>A couple of things I should mention.</p>
<ul>
<li>Using this method you will may need a new attachment class for each of the other ammo types. This attachment class can be a subclass of the default attachment class you use in your weapon. Nothing special is need here just change any skins/mesh in this attachment class if it applies.</li>
<li>You will also need to have a new weapon pickup for each of the other ammo type that you have. This handles the case of you having a different ammo type loaded when you toss your weapon or die. If you did not add a new pickup, then the person that picks up your dropped weapon is left with the original ammo and not the ammo you have it loaded with. Here is an example of one:</li>
</ul>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="co1">//=============================================================================</span>
<span class="co1">// GrenadeLauncher_Napalmpickup</span>
<span class="co1">// $Id: GrenadeLauncher_Napalmpickup.uc,v 1.9 2003/07/12 20:48:44 jb Exp $</span>
<span class="co1">//=============================================================================</span>
<span class="kw5">class</span> GrenadeLauncher_Napalmpickup <span class="kw5">extends</span> GrenadeLauncher_pickup;
 
<span class="co1">//over ride this to give out proper ammo to Nade (Napalm ammo)</span>
<span class="kw5">function</span> inventory SpawnCopy<span class="br0">(</span> <a href="/Pawn"><span class="kw10">pawn</span></a> Other <span class="br0">)</span>
<span class="br0">{</span>
 <span class="kw5">local</span> inventory Copy;
        <span class="kw5">local</span> Weapon W;
    <span class="kw5">local</span> GrenadeLauncher GL;
 
 <span class="kw1">if</span> <span class="br0">(</span> Inventory != <span class="kw9">None</span> <span class="br0">)</span>
 <span class="br0">{</span>
  Copy = Inventory;
  Inventory = <span class="kw9">None</span>;
 <span class="br0">}</span>
 <span class="kw1">else</span>
  Copy = spawn<span class="br0">(</span>InventoryType,Other,,,rot<span class="br0">(</span><span class="nu0">0</span>,<span class="nu0">0</span>,<span class="nu0">0</span><span class="br0">)</span><span class="br0">)</span>;
 
    <span class="co1">// add in the Napalm nade stuff here</span>
    W = Weapon<span class="br0">(</span>copy<span class="br0">)</span>;
    <span class="co1">// Clean up "old" fire mode(s)</span>
    <span class="co1">// primary fire</span>
    <span class="kw1">if</span> <span class="br0">(</span>W.<span class="me1">FireMode</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> != <span class="kw9">none</span><span class="br0">)</span>
      W.<span class="me1">FireMode</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">Destroy</span><span class="br0">(</span><span class="br0">)</span>;
    <span class="co1">// Set Primary Fire to Napalm Stuff</span>
    W.<span class="me1">FireMode</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> = Spawn<span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeLauncher_Primary_napalm'</span>, <span class="kw8">self</span><span class="br0">)</span>;
    W.<span class="me1">FireMode</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">ThisModeNum</span> = <span class="nu0">0</span>;
    W.<span class="me1">FireMode</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">Weapon</span> = W;
    W.<span class="me1">FireMode</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">Instigator</span> = Other;
    W.<span class="me1">FireMode</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">AmmoClass</span> =<span class="kw5">class</span><span class="st0">'GrenadeAmmoNapalm'</span>;    <span class="co1">// need these two to change the ammo</span>
    W.<span class="me1">Ammo</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> = Ammunition<span class="br0">(</span>Other.<span class="me1">FindInventoryType</span><span class="br0">(</span>W.<span class="me1">FireMode</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>.<span class="me1">AmmoClass</span><span class="br0">)</span><span class="br0">)</span>;
 
    <span class="co1">// secondary fire</span>
    <span class="kw1">if</span> <span class="br0">(</span>W.<span class="me1">FireMode</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> != <span class="kw9">none</span><span class="br0">)</span>
       W.<span class="me1">FireMode</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">Destroy</span><span class="br0">(</span><span class="br0">)</span>;
    <span class="co1">// Set secondary Fire to Napalm Stuff</span>
    W.<span class="me1">FireMode</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> = Spawn<span class="br0">(</span><span class="kw5">class</span><span class="st0">'GrenadeLauncher_Secondary_napalm'</span>, <span class="kw8">self</span><span class="br0">)</span>;
    W.<span class="me1">FireMode</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">ThisModeNum</span> = <span class="nu0">1</span>;
    W.<span class="me1">FireMode</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">Weapon</span> = W;
    W.<span class="me1">FireMode</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">Instigator</span> = Other;
    W.<span class="me1">FireMode</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">AmmoClass</span> = <span class="kw5">class</span><span class="st0">'GrenadeAmmonapalm'</span>;
    W.<span class="me1">Ammo</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> = Ammunition<span class="br0">(</span>Other.<span class="me1">FindInventoryType</span><span class="br0">(</span>w.<span class="me1">FireMode</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>.<span class="me1">AmmoClass</span><span class="br0">)</span><span class="br0">)</span>;
    W.<span class="me1">PickupClass</span>=<span class="kw5">class</span><span class="st0">'GrenadeLauncher_NapalmPickup'</span>;
    W.<span class="me1">AttachmentClass</span>=<span class="kw5">class</span><span class="st0">'GrenadeLauncher_NapalmAttachment'</span>;
 
    <span class="co1">// Finally set the Count of the nade launcher to Napalm and give it to em :)</span>
    GL = GrenadeLauncher<span class="br0">(</span>copy<span class="br0">)</span>;
    <span class="kw1">if</span> <span class="br0">(</span>GL != <span class="kw9">none</span><span class="br0">)</span>
       GL.<span class="me1">Count</span>=<span class="nu0">1</span>;
 
 Copy.<span class="me1">GiveTo</span><span class="br0">(</span> Other, <span class="kw8">self</span> <span class="br0">)</span>;
 
 <span class="kw1">return</span> Copy;
<span class="br0">}</span>
</pre></div>
<p>This ammo pickup looks a lot like our change ammo function and its very simular to that other than a few tweaks. So did you make it through this tut? I hope that this gives you the basics on how to handle a weapon that can fire more than one ammo types. It also should avoid all of the issues with animations, network play and handle out of ammo, change ammo and droppen weapon issues. Thanks for your time.</p>
<p><b>Jb:</b> Fixed an error that produced AN on the weapon pickup class. Sorry saw it only a few times and never had a chance to go back and fix it till now.</p>
<p><b>Zer0:</b> This needs updating for UT2004, there are some weird issues with FireModes in 2k4. I can't get firemodes to change at all in 04, various type mismatch/destroy is not a member of Firemode/bad or missing etc errors.</p>
<p><b>zugy:</b> Hmmm...Is there a way to get this working in 2k4? It'd help out a LOT for the grenade code I'm working on for Project Torlan...</p>

<!-- 
NewPP limit report
Preprocessor node count: 26/1000000
Post-expand include size: 17/2097152 bytes
Template argument size: 0/2097152 bytes
#ifexist count: 0/100
-->
<div class="printfooter">
</div>
	    <div id="catlinks"><p class='catlinks'><a href="../../../../articles/c/a/t/Special%7ECategories_101d.html" title="Special:Categories">Category</a>: <span dir='ltr'><a href="../../../../articles/l/e/g/Category%7ELegacy_Tutorial_261e.html" title="Category:Legacy Tutorial">Legacy Tutorial</a></span></p></div>	    <!-- end content -->
	    <div class="visualClear"></div>
	  </div>
	</div>
      </div>
      <div id="column-one">
	<div id="p-cactions" class="portlet">
	  <h5>Views</h5>
	  <ul>
	    <li id="ca-nstab-legacy"
	       class="selected"	       ><a href="../../../../articles/m/u/l/Legacy%7EMultiammo_Weapons_96db.html">Legacy</a></li><li id="ca-talk"
	       class="new"	       ><a href="../../../../articles/m/u/l/Legacy_talk%7EMultiammo_Weapons_d31b.html">Discussion</a></li><li id="ca-current"
	       	       ><a href="http://wiki.beyondunreal.com/Legacy:Multiammo_Weapons">Current revision</a></li>	  </ul>
	</div>
	<div class="portlet" id="p-logo">
	  <a style="background-image: url(../../../../misc/uewiki.png);"
	    href="../../../../index.html"
	    title="Main Page"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
		<div class='portlet' id='p-navigation'>
	  <h5>Navigation</h5>
	  <div class='pBody'>
	    <ul>
	    	      <li id="n-mainpage"><a href="../../../../index.html">Main Page</a></li>
	     	      <li id="n-portal"><a href="../../../../articles/c/o/m/Unreal_Wiki%7ECommunity_Portal_3311.html">Community portal</a></li>
	     	      <li id="n-help"><a href="../../../../articles/c/o/n/Help%7EContents_22de.html">Help</a></li>
	     	    </ul>
	  </div>
	</div>
		<div id="p-search" class="portlet">
	  <h5><label for="searchInput">Search</label></h5>
	  <div id="searchBody" class="pBody">
	    <form action="javascript:goToStatic(3)" id="searchform"><div>
	      <input id="searchInput" name="search" type="text"
	        accesskey="f" value="" />
	      <input type='submit' name="go" class="searchButton" id="searchGoButton"
	        value="Go" />
	    </div></form>
	  </div>
	</div>
	      </div><!-- end of the left (by default at least) column -->
      <div class="visualClear"></div>
      <div id="footer">
    <div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="../../../../skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" /></a></div>	<div id="f-copyrightico"><a href="../../../../../COPYING.html"><img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" alt='Attribution-Noncommercial-Share Alike 3.0' /></a></div>	<ul id="f-list">
	  	  	  <li id="f-credits">This page was last modified 07:04, 2 July 2005 by Anonymous user(s) of Unreal Wiki. </li>	  <li id="f-copyright">Licensed as <a href="../../../../articles/c/o/p/Unreal_Wiki%7ECopyrights_e561.html" title="Unreal Wiki:Copyrights">Attribution-Noncommercial-Share Alike 3.0</a>.</li>	  <li id="f-about"><a href="../../../../articles/a/b/o/Unreal_Wiki%7EAbout_9ce6.html" title="Unreal Wiki:About">About Unreal Wiki</a></li>	  <li id="f-disclaimer"><a href="../../../../articles/g/e/n/Unreal_Wiki%7EGeneral_disclaimer_a0a2.html" title="Unreal Wiki:General disclaimer">Disclaimers</a></li>	  	</ul>
      </div>
    </div>
  </body>
</html>
