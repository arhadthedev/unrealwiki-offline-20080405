<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<!-- headlinks removed -->
	<link rel="shortcut icon" href="../../../../misc/uewiki-favicon.png"/>
    <title>Legacy:Manual Shift Car - Unreal Wiki</title>
    <style type="text/css">/*<![CDATA[*/ @import "../../../../skins/offline/main.css"; /*]]>*/</style>
    <link rel="stylesheet" type="text/css" media="print" href="../../../../skins/common/commonPrint.css" />
    <!--[if lt IE 5.5000]><style type="text/css">@import "../../../../skins/monobook/IE50Fixes.css";</style><![endif]-->
    <!--[if IE 5.5000]><style type="text/css">@import "../../../../skins/monobook/IE55Fixes.css";</style><![endif]-->
    <!--[if IE 6]><style type="text/css">@import "../../../../skins/monobook/IE60Fixes.css";</style><![endif]-->
    <!--[if IE]><script type="text/javascript" src="../../../../skins/common/IEFixes.js"></script>
    <meta http-equiv="imagetoolbar" content="no" /><![endif]-->
    <script type="text/javascript" src="../../../../skins/common/wikibits.js"></script>
    <script type="text/javascript" src="../../../../skins/offline/md5.js"></script>
    <script type="text/javascript" src="../../../../skins/offline/utf8.js"></script>
    <script type="text/javascript" src="../../../../skins/offline/lookup.js"></script>
    <script type="text/javascript" src="../../../../articles/-/_/_/-.html"></script>        <style type="text/css">/*<![CDATA[*/
@import "../../../../articles/c/o/m/MediaWiki%7ECommon.css_d42e.html";
@import "../../../../articles/m/o/n/MediaWiki%7EMonobook.css_fb19.html";
@import "../../../../articles/-/_/_/-.html";
/*]]>*/</style>          </head>
  <body
    class="ns-100">
    <div id="globalWrapper">
      <div id="column-content">
	<div id="content">
	  <a name="top" id="contentTop"></a>
	        <h1 class="firstHeading">Legacy:Manual Shift Car</h1>
	  <div id="bodyContent">
	    <h3 id="siteSub">From Unreal Wiki, The Unreal Engine Documentation Site</h3>
	    <div id="contentSub"></div>
	    	    	    <!-- start content -->
	    <table id="toc" class="toc" summary="Contents">
<tr>
<td>
<div id="toctitle">
<h2>Contents</h2>
</div>
<ul>
<li class="toclevel-1"><a href="#Breakdown"><span class="tocnumber">1</span> <span class="toctext">Breakdown</span></a></li>
<li class="toclevel-1"><a href="#The_Goods"><span class="tocnumber">2</span> <span class="toctext">The Goods</span></a>
<ul>
<li class="toclevel-2"><a href="#To_start_the_class_off"><span class="tocnumber">2.1</span> <span class="toctext">To start the class off</span></a></li>
<li class="toclevel-2"><a href="#Critical_variables"><span class="tocnumber">2.2</span> <span class="toctext">Critical variables</span></a></li>
<li class="toclevel-2"><a href="#Not_so_critical_variables"><span class="tocnumber">2.3</span> <span class="toctext">Not so critical variables</span></a>
<ul>
<li class="toclevel-3"><a href="#Replication_.3D"><span class="tocnumber">2.3.1</span> <span class="toctext">Replication =</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Functions"><span class="tocnumber">2.4</span> <span class="toctext">Functions</span></a>
<ul>
<li class="toclevel-3"><a href="#Defaults"><span class="tocnumber">2.4.1</span> <span class="toctext">Defaults</span></a></li>
<li class="toclevel-3"><a href="#Notes"><span class="tocnumber">2.4.2</span> <span class="toctext">Notes</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1"><a href="#Related_Topics"><span class="tocnumber">3</span> <span class="toctext">Related Topics</span></a></li>
<li class="toclevel-1"><a href="#Discussion"><span class="tocnumber">4</span> <span class="toctext">Discussion</span></a></li>
</ul>
</td>
</tr>
</table>
<script type="text/javascript">
//<![CDATA[
 if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } 
//]]>
</script>
<p><a name="Breakdown" id="Breakdown"></a></p>
<h2><span class="mw-headline">Breakdown</span></h2>
<p>This is a convertion of <a href="../../../../articles/o/n/s/Legacy%7EONSWheeledCraft_3fd0.html" title="Legacy:ONSWheeledCraft">ONSWheeledCraft</a>. This class allows for a stick shift or otherwise known as a manual transmission car. Why stick shift?</p>
<ul>
<li>It doesn't cost much in terms of fps</li>
<li>Lets you rev it in neutral&#160;:)</li>
<li>Fun to drive</li>
<li>Will allow rear/front/all wheel drive</li>
<li>Holding the brake and the rear wheels keep spinning (no rear brakes)</li>
</ul>
<ul>
<li>I hope you can use what I (CIpen) have created</li>
</ul>
<p><a name="The_Goods" id="The_Goods"></a></p>
<h2><span class="mw-headline">The Goods</span></h2>
<p><a name="To_start_the_class_off" id="To_start_the_class_off"></a></p>
<h3><span class="mw-headline">To start the class off</span></h3>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw5">class</span> WheeledClutch_Brake <span class="kw5">extends</span> ONSVehicle;
</pre></div>
<p><a name="Critical_variables" id="Critical_variables"></a></p>
<h3><span class="mw-headline">Critical variables</span></h3>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>             WheelSoftness;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>             WheelPenScale;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>             WheelPenOffset;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>             WheelRestitution;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>             WheelAdhesion;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>             WheelInertia;   <span class="co1">// I believe this is how much to resist change in motion</span>
 
    <span class="co1">//I(CIpen) made these an array so we could have different slips on each surface</span>
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> array&lt;float&gt;         WheelLongSlip; <span class="co1">// I think this is so we can have the wheels slip when you take off</span>
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> array&lt;InterpCurve&gt;   WheelLongFrictionFunc;<span class="co1">//this is the curve for how slippery the wheels are allong the X axis(forwards slip)</span>
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> array&lt;InterpCurve&gt;   WheelLatSlipFunc;<span class="co1">//this is the curve for how slippery the wheels are allong the Y axis(left/right slip)</span>
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> array&lt;float&gt;         WheelLongFrictionScale;  <span class="co1">// quick way to change the ammount of friction without having to draw out</span>
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> array&lt;float&gt;         WheelLatFrictionScale;   <span class="co1">// a new friction curve</span>
 
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                             WheelHandbrakeSlip;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                             WheelHandbrakeFriction;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                             WheelSuspensionTravel;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                             WheelSuspensionOffset;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                             WheelSuspensionMaxRenderTravel;   
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                             FTScale;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                             ChassisTorqueScale;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                             MinBrakeFriction;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">InterpCurve</span>                       MaxSteerAngleCurve; <span class="co1">// degrees, this makes the wheels turn like real car wheels*</span>
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                             GearRatios<span class="br0">[</span><span class="nu0">8</span><span class="br0">]</span>;  <span class="co1">// 0 is reverse, 1-4 f</span>
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">int</span>                               NumForwardGears;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                             TransRatio;   <span class="co1">// Other(constant)gears  i.e. so we can have driveshaft ratio(if one applies)</span>
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                             ChangeUpPoint;   <span class="co1">//EngineRPM that signals gear up change</span>
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                             ChangeDownPoint; <span class="co1">//EngineRPM that signals gear down change</span>
 
<span class="kw5">var</span>   <span class="kw4">int</span>                               bGearUp;
<span class="kw5">var</span>   <span class="kw4">int</span>                               bGearDown;
 
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                             LSDFactor;                                                                                    
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                             EngineBrakeFactor;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                             EngineBrakeRPMScale;                                                                                     
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                             MaxBrakeTorque;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                             SteerSpeed;         <span class="co1">// How fast it turns         </span>
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                             TurnDamping;                                                                                    
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                             StopThreshold;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                             HandbrakeThresh;                                                                                     
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                             EngineInertia;     <span class="co1">// Pre-gear box engine (piston mass)</span>
<span class="kw5">var</span>   <span class="kw4">bool</span>                              bClutching;        <span class="co1">// If holding the clutch</span>
<span class="kw5">var</span>   <span class="kw4">bool</span>                              bOldClutching;  
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                             IdleRPM;              <span class="co1">//RPM to idle at</span>
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                             EngineRPMSoundRange;   <span class="co1">//RPM sound range</span>
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">name</span>                              SteerBoneName;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> EAxis                             SteerBoneAxis;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                             SteerBoneMaxAngle; <span class="co1">// degrees                                                                                     </span>
 
<span class="kw5">var</span>   <span class="kw4">float</span>                             OutputBrake;    <span class="co1">//How much we are braking</span>
<span class="kw5">var</span>   <span class="kw4">float</span>                             OutputGas;      <span class="co1">//How much are we giving gas</span>
<span class="kw5">var</span>   <span class="kw4">float</span>                             OutputPitch;
<span class="kw5">var</span>   <span class="kw4">bool</span>                              OutputHandbrake;
 
<span class="kw5">var</span>   <span class="kw4">int</span>                               Gear;           <span class="co1">//What gear we are in</span>
<span class="kw5">var</span>   <span class="kw4">float</span>                             ForwardVel;
<span class="kw5">var</span>   <span class="kw4">bool</span>                              bIsInverted;
<span class="kw5">var</span>   <span class="kw4">bool</span>                              bIsDriving;
<span class="kw5">var</span>   <span class="kw4">float</span>                             NumPoweredWheels;
<span class="kw5">var</span>   <span class="kw4">float</span>                             NeutralRPM;
 
<span class="kw5">var</span>   <span class="kw4">InterpCurve</span>                       RPMtoGas;           <span class="co1">// This is what I use to convert the current in gear RPM to the amount of gas so the RPM doesn't go to zero when we hit the clutch</span>
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">InterpCurve</span>                       TorqueCurve;        <span class="co1">// Engine output torque</span>
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">InterpCurve</span>                       EngineS;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">InterpCurve</span>                       BrakeCurve;     <span class="co1">//This simulates more lifelike braking, where you apply braking</span>
 
<span class="kw5">var</span>   <span class="kw4">float</span>                             Gas, Gas2, hBrake;
 
<span class="kw5">var</span>   <span class="kw4">float</span>                             RPM2;    <span class="co1">//Neutral RPM</span>
<span class="kw5">var</span>   <span class="kw4">float</span>                             RPM;     <span class="co1">//Neutral RPM</span>
<span class="kw5">var</span>   <span class="kw4">float</span>                             NRPM;
<span class="kw5">var</span>   <span class="kw4">bool</span>                              bBraking;   <span class="co1">//if we are braking</span>
<span class="kw5">var</span>   <span class="kw4">bool</span>                              bThrot, bNThrot, bNoGas;
<span class="kw5">var</span>   <span class="kw4">bool</span>                              bInGear;          <span class="co1">//if we are completly in gear</span>
<span class="kw5">var</span>   <span class="kw4">bool</span>                              bRadians;
<span class="kw5">var</span>   <span class="kw4">float</span>                             TotalSpinVel;
<span class="kw5">var</span>   <span class="kw4">float</span>                             EngineRPM;
<span class="kw5">var</span>   <span class="kw4">float</span>                             WheelRPM;<span class="co1">// used to get the wheel RPM at anytime(so we don't change EngineRPM which is what the engine sound is tied to)</span>
<span class="kw5">var</span>   <span class="kw4">float</span>                             CarMPH;
<span class="kw5">var</span>   <span class="kw4">float</span>                             ETorque;
<span class="kw5">var</span>   <span class="kw4">float</span>                             ActualSteering;
<span class="kw5">var</span>   <span class="kw4">float</span>                             SteerBoneAngle;
<span class="kw5">var</span>   <span class="kw4">float</span>                             EnginePitch;
<span class="kw5">var</span>   <span class="kw4">Vector</span>                            worldForward;
<span class="kw5">var</span>   <span class="kw4">Vector</span>                            worldRight;
<span class="kw5">var</span>   <span class="kw4">Vector</span>                            worldUp;
<span class="kw5">var</span>   <span class="kw4">Matrix</span>                            carTM;
<span class="kw5">var</span>   <span class="kw4">Rotator</span>                           SteerRot;
<span class="kw5">var</span>   <span class="kw4">bool</span>                              bCurrentOnGround;
<span class="kw5">var</span>   <span class="kw4">float</span>                             DeltaPitch;
<span class="kw5">var</span>   <span class="kw4">float</span>                             DeltaHeading;
<span class="kw5">var</span>   <span class="kw4">float</span>                             DeltaRoll;
<span class="kw5">var</span>   <span class="kw4">float</span>                             VRate;
 
<span class="kw5">var</span>   <span class="kw4">vector</span>                            one, two, three;
<span class="kw5">var</span>   <span class="kw4">vector</span>                            Dist1, Dist2;     <span class="co1">// unused but this was for doing the daredevil stuff</span>
<span class="kw5">var</span>   <span class="kw4">float</span>                             Dist3;
<span class="kw5">var</span>   <span class="kw4">bool</span>                              bBrakeFrontWheelsOnly, bBrakeFrontWheels;
<span class="kw5">var</span>   <span class="kw4">Vector</span>                            UDForce, UDTorque;
<span class="kw5">var</span>   <span class="kw4">Vector</span>                            WForce, WTorque;
<span class="kw5">var</span>   <span class="kw4">Coords</span>                            WheelCoords;
<span class="kw5">var</span>   <span class="kw4">Coords</span>                            OldCoords;
<span class="kw5">var</span>   <span class="kw4">Coords</span>                            <span class="kw4">Coords</span>;
<span class="kw5">var</span>   <span class="kw4">Vector</span>                            ForwardsInOldPlane;
<span class="kw5">var</span>   <a href="/Pawn"><span class="kw10">Pawn</span></a>                              OldDriver;        
 
<span class="kw4">struct</span> <span class="kw6">native</span> SCarState
<span class="br0">{</span>
          <span class="kw5">var</span> <span class="kw4">vector</span>                    ChassisPosition;                               
          <span class="kw5">var</span> <span class="kw4">Quat</span>                      ChassisQuaternion;                             
          <span class="kw5">var</span> <span class="kw4">vector</span>                    ChassisLinVel;                                 
          <span class="kw5">var</span> <span class="kw4">vector</span>                    ChassisAngVel;                                 
 
          <span class="kw5">var</span> <span class="kw4">byte</span>                      ServerHandbrake;                               
          <span class="kw5">var</span> <span class="kw4">byte</span>                      ServerBrake;                                   
          <span class="kw5">var</span> <span class="kw4">byte</span>                      ServerGas;                                     
          <span class="kw5">var</span> <span class="kw4">byte</span>                      ServerGear;                                    
          <span class="kw5">var</span> <span class="kw4">byte</span>                      ServerSteering;
          <span class="kw5">var</span> <span class="kw4">int</span>                       ServerViewPitch;
          <span class="kw5">var</span> <span class="kw4">int</span>                       ServerViewYaw;
<span class="br0">}</span>;
 
<span class="kw5">var</span>   <span class="kw4">byte</span>                     FudgeByte;                                                                                     
<span class="kw5">var</span>   SCarState                CarState;                                      
<span class="kw5">var</span>   SCarState                OldCarState;
<span class="kw5">var</span>   KRigidBodyState          ChassisState;                                  
<span class="kw5">var</span>   <span class="kw4">bool</span>                     bNewCarState;                                                                                    
<span class="kw5">var</span>   <span class="kw4">bool</span>                     bOldVehicleOnGround;
<span class="kw5">var</span>   <span class="kw4">float</span>                    TheDeltaTime;
</pre></div>
<p><a name="Not_so_critical_variables" id="Not_so_critical_variables"></a></p>
<h3><span class="mw-headline">Not so critical variables</span></h3>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw5">var</span>   class&lt;CameraEffect&gt;           myBlur;
<span class="kw5">var</span>   myMotionBlur                  ClientMotionBlur;
 
<span class="kw5">var</span>   array&lt;ONSDirtSlipEffect&gt;          Dust; <span class="co1">// FL, FR, RL, RR</span>
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                             DustSlipRate;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                             DustSlipThresh;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                         RevMeterPosX;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                         RevMeterPosY;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                         RevMeterScale;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                         RevMeterSizeY;
 
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">bool</span>                          bDoStuntInfo;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">bool</span>                          bAllowAirControl;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">bool</span>                          bAllowChargingJump;
<span class="kw5">var</span>   <span class="kw4">bool</span>                            bAllowBigWheels;
 
<span class="kw5">var</span>   <span class="kw4">bool</span>                            bPushDown; <span class="co1">//jump is being charged</span>
<span class="kw5">var</span>   <span class="kw4">bool</span>                          bOldPushDown;
<span class="kw5">var</span>   <span class="kw4">bool</span>                          bAllWheelsOnGround;
 
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                         MaxJumpForce;
<span class="kw5">var</span>   <span class="kw4">float</span>                         JumpForce;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                         MaxJumpSpin;
<span class="kw5">var</span>   <span class="kw4">float</span>                         JumpSpin;
 
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                         JumpChargeTime;
<span class="kw5">var</span>   <span class="kw4">float</span>                           DesiredJumpForce; <span class="co1">//used by AI</span>
<span class="kw5">var</span>   <span class="kw4">string</span>                  JumpFeedbackForce;                             
 
<span class="kw5">var</span>   <a href="/sound"><span class="kw10">sound</span></a>                             JumpSound;
 
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                         JumpMeterOriginX;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                         JumpMeterOriginY;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                         JumpMeterWidth;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                         JumpMeterHeight;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                         JumpMeterSpacing;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">color</span>                         JumpMeterColor;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">color</span>                         SpinMeterColor;
<span class="kw5">var</span>   <a href="/Texture"><span class="kw10">Texture</span></a>                 JumpMeterTexture;                              
 
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                         AirTurnTorque;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                         AirPitchTorque;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                         AirPitchDamping;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                         AirRollTorque;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                         AirRollDamping;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                         MinAirControlDamping;                                                                                    
<span class="kw5">var</span>   <span class="kw4">float</span>                           FenderBenderSpeed;
 
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">bool</span>                          bMakeBrakeLights;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">vector</span>                               BrakeLightOffset<span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span>;                           
<span class="kw5">var</span>   ONSBrakelightCorona              BrakeLight<span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span>;                                 
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <a href="/Material"><span class="kw10">Material</span></a>                           BrakeLightMaterial;                            
 
<span class="kw5">var</span>   <span class="kw4">Rotator</span>                 OldRotation;
<span class="kw5">var</span>   <span class="kw4">Vector</span>                  LastOnGroundLocation;                          
<span class="kw5">var</span>   <span class="kw4">float</span>                           LastOnGroundTime;
 
<span class="kw5">var</span>   <span class="kw4">float</span>                           InAirSpin; <span class="co1">// Degrees</span>
<span class="kw5">var</span>   <span class="kw4">float</span>                           InAirPitch; <span class="co1">// Degrees</span>
<span class="kw5">var</span>   <span class="kw4">float</span>                           InAirRoll; <span class="co1">// Degrees</span>
<span class="kw5">var</span>   <span class="kw4">float</span>                           InAirTime; <span class="co1">// Second</span>
<span class="kw5">var</span>   <span class="kw4">float</span>                           InAirDistance; <span class="co1">// Meters</span>
<span class="kw5">var</span>   <span class="kw4">int</span>                             DaredevilPoints;
<span class="kw5">var</span>   <span class="kw6">config</span> <span class="kw4">int</span>                    IntSteerBoneAngle;
 
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                         DaredevilThreshInAirSpin;                      
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                         DaredevilThreshInAirPitch;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                         DaredevilThreshInAirRoll;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                         DaredevilThreshInAirTime;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> <span class="kw4">float</span>                         DaredevilThreshInAirDistance;
<span class="kw5">var</span><span class="br0">(</span><span class="br0">)</span> class&lt;LocalMessage&gt;              DaredevilMessageClass;
</pre></div>
<p><a name="Replication_.3D" id="Replication_.3D"></a></p>
<h4><span class="mw-headline">Replication =</span></h4>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw1">replication</span>
<span class="br0">{</span>
        <span class="kw6">reliable</span> <span class="kw1">if</span> <span class="br0">(</span><span class="kw8">Role</span> == <span class="kw9">ROLE_Authority</span><span class="br0">)</span>
                CarState, FudgeByte;                       <span class="co1">// make sure we get what we need to the client</span>
        <span class="kw6">reliable</span> <span class="kw1">if</span> <span class="br0">(</span>bNetInitial &amp;&amp; <span class="kw8">Role</span> == <span class="kw9">ROLE_Authority</span><span class="br0">)</span>
                bAllowAirControl, bAllowChargingJump;        <span class="co1">// showoff stuff</span>
        <span class="kw6">reliable</span> <span class="kw1">if</span> <span class="br0">(</span>bNetInitial &amp;&amp; bDoStuntInfo &amp;&amp; <span class="kw8">Role</span> == <span class="kw9">ROLE_Authority</span><span class="br0">)</span>
                DaredevilThreshInAirDistance, DaredevilThreshInAirTime, DaredevilThreshInAirSpin, DaredevilThreshInAirPitch, DaredevilThreshInAirRoll;
<span class="br0">}</span>
</pre></div>
<p><a name="Functions" id="Functions"></a></p>
<h3><span class="mw-headline">Functions</span></h3>
<dl>
<dt>PostNetBeginPlay</dt>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw6">simulated</span> <span class="kw5">function</span> PostNetBeginPlay<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
        <span class="kw5">local</span> <span class="kw4">int</span> i;
        NumPoweredWheels = <span class="nu0">0.0</span>;
        <span class="kw1">for</span><span class="br0">(</span>i=<span class="nu0">0</span>; i&lt;=<span class="nu0">1</span>; i++<span class="br0">)</span>
        <span class="br0">{</span>
                NumPoweredWheels += <span class="nu0">1.0</span>;
        <span class="br0">}</span>
       SVehicleUpdateParams<span class="br0">(</span><span class="br0">)</span>;
       <span class="kw6">Super</span>.<span class="me1">PostNetBeginPlay</span><span class="br0">(</span><span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
<dl>
<dt>PostNetReceive&#160;</dt>
<dd>Here is were we deal with stuff coming from the server.</dd>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw6">simulated</span> <span class="kw5">function</span> PostNetReceive<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
        <span class="kw6">Super</span>.<span class="me1">PostNetReceive</span><span class="br0">(</span><span class="br0">)</span>;
 
        <span class="kw1">if</span><span class="br0">(</span>OldCarState.<span class="me1">ChassisPosition</span> == CarState.<span class="me1">ChassisPosition</span> &amp;&amp;
                OldCarState.<span class="me1">ChassisQuaternion</span>.<span class="me1">X</span> == CarState.<span class="me1">ChassisQuaternion</span>.<span class="me1">X</span> &amp;&amp;
                OldCarState.<span class="me1">ChassisQuaternion</span>.<span class="me1">Y</span> == CarState.<span class="me1">ChassisQuaternion</span>.<span class="me1">Y</span> &amp;&amp;
                OldCarState.<span class="me1">ChassisQuaternion</span>.<span class="me1">Z</span> == CarState.<span class="me1">ChassisQuaternion</span>.<span class="me1">Z</span> &amp;&amp;
                OldCarState.<span class="me1">ChassisQuaternion</span>.<span class="me1">W</span> == CarState.<span class="me1">ChassisQuaternion</span>.<span class="me1">W</span> &amp;&amp;
                OldCarState.<span class="me1">ChassisLinVel</span> == CarState.<span class="me1">ChassisLinVel</span> &amp;&amp;
                OldCarState.<span class="me1">ChassisAngVel</span> == CarState.<span class="me1">ChassisAngVel</span> &amp;&amp;
                OldCarState.<span class="me1">ServerHandbrake</span> == CarState.<span class="me1">ServerHandbrake</span> &amp;&amp;
                OldCarState.<span class="me1">ServerBrake</span> == CarState.<span class="me1">ServerBrake</span> &amp;&amp;
                OldCarState.<span class="me1">ServerGas</span> == CarState.<span class="me1">ServerGas</span> &amp;&amp;
                OldCarState.<span class="me1">ServerGear</span> == CarState.<span class="me1">ServerGear</span> &amp;&amp;
                OldCarState.<span class="me1">ServerSteering</span> == CarState.<span class="me1">ServerSteering</span> &amp;&amp;
                OldCarState.<span class="me1">ServerViewPitch</span> == CarState.<span class="me1">ServerViewPitch</span> &amp;&amp;
                OldCarState.<span class="me1">ServerViewYaw</span> == CarState.<span class="me1">ServerViewYaw</span><span class="br0">)</span>
                <span class="kw1">return</span>;
 
        ChassisState.<span class="me1">Position</span>.<span class="me1">X</span> = CarState.<span class="me1">ChassisPosition</span>.<span class="me1">X</span>;
        ChassisState.<span class="me1">Position</span>.<span class="me1">Y</span> = CarState.<span class="me1">ChassisPosition</span>.<span class="me1">Y</span>;
        ChassisState.<span class="me1">Position</span>.<span class="me1">Z</span> = CarState.<span class="me1">ChassisPosition</span>.<span class="me1">Z</span>;
 
        ChassisState.<span class="kw4">Quaternion</span> = CarState.<span class="me1">ChassisQuaternion</span>;
 
        ChassisState.<span class="me1">LinVel</span>.<span class="me1">X</span> = <span class="nu0">0</span>.1f * CarState.<span class="me1">ChassisLinVel</span>.<span class="me1">X</span>;
        ChassisState.<span class="me1">LinVel</span>.<span class="me1">Y</span> = <span class="nu0">0</span>.1f * CarState.<span class="me1">ChassisLinVel</span>.<span class="me1">Y</span>;
        ChassisState.<span class="me1">LinVel</span>.<span class="me1">Z</span> = <span class="nu0">0</span>.1f * CarState.<span class="me1">ChassisLinVel</span>.<span class="me1">Z</span>;
 
        ChassisState.<span class="me1">AngVel</span>.<span class="me1">X</span> = <span class="nu0">0</span>.001f * CarState.<span class="me1">ChassisAngVel</span>.<span class="me1">X</span>;
        ChassisState.<span class="me1">AngVel</span>.<span class="me1">Y</span> = <span class="nu0">0</span>.001f * CarState.<span class="me1">ChassisAngVel</span>.<span class="me1">Y</span>;
        ChassisState.<span class="me1">AngVel</span>.<span class="me1">Z</span> = <span class="nu0">0</span>.001f * CarState.<span class="me1">ChassisAngVel</span>.<span class="me1">Z</span>;
 
        bNewCarState = <span class="kw9">true</span>;
        OldCarState.<span class="me1">ChassisPosition</span> = CarState.<span class="me1">ChassisPosition</span>;
        OldCarState.<span class="me1">ChassisQuaternion</span> = CarState.<span class="me1">ChassisQuaternion</span>;
        OldCarState.<span class="me1">ChassisLinVel</span> = CarState.<span class="me1">ChassisLinVel</span>;
        OldCarState.<span class="me1">ChassisAngVel</span> = CarState.<span class="me1">ChassisAngVel</span>;
        OldCarState.<span class="me1">ServerHandbrake</span> = CarState.<span class="me1">ServerHandbrake</span>;
        OldCarState.<span class="me1">ServerBrake</span> = CarState.<span class="me1">ServerBrake</span>;
        OldCarState.<span class="me1">ServerGas</span> = CarState.<span class="me1">ServerGas</span>;
        OldCarState.<span class="me1">ServerGear</span> = CarState.<span class="me1">ServerGear</span>;
        OldCarState.<span class="me1">ServerSteering</span> = CarState.<span class="me1">ServerSteering</span>;
        OldCarState.<span class="me1">ServerViewPitch</span> = CarState.<span class="me1">ServerViewPitch</span>;
        OldCarState.<span class="me1">ServerViewYaw</span> = CarState.<span class="me1">ServerViewYaw</span>;
 
        OutputPitch = RangeByteToFloat<span class="br0">(</span>CarState.<span class="me1">ServerHandbrake</span><span class="br0">)</span>;
        OutputHandbrake = <span class="br0">(</span>OutputPitch &gt; <span class="nu0">0.01</span><span class="br0">)</span>;
        OutputBrake = RangeByteToFloat<span class="br0">(</span>CarState.<span class="me1">ServerBrake</span><span class="br0">)</span>;
        OutputGas = RangeByteToFloat<span class="br0">(</span>CarState.<span class="me1">ServerGas</span><span class="br0">)</span>;
        Gear = CarState.<span class="me1">ServerGear</span>;
        Steering = RangeByteToFloat<span class="br0">(</span>CarState.<span class="me1">ServerSteering</span><span class="br0">)</span>;
        DriverViewPitch = CarState.<span class="me1">ServerViewPitch</span>;
        DriverViewYaw = CarState.<span class="me1">ServerViewYaw</span>;
<span class="br0">}</span>
</pre></div>
<dl>
<dt>PrecacheAnnouncer</dt>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw6">simulated</span> <span class="kw5">function</span> PrecacheAnnouncer<span class="br0">(</span>AnnouncerVoice V, <span class="kw4">bool</span> bRewardSounds<span class="br0">)</span>
<span class="br0">{</span>
 
        <span class="kw1">if</span> <span class="br0">(</span>bRewardSounds &amp;&amp; !bSoundsPrecached<span class="br0">)</span>
                V.<span class="me1">PrecacheSound</span><span class="br0">(</span><span class="st0">'fender_bender'</span><span class="br0">)</span>;
 
        <span class="kw6">Super</span>.<span class="me1">PrecacheAnnouncer</span><span class="br0">(</span>V, bRewardSounds<span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
<dl>
<dt>KUpdateState&#160;</dt>
<dd>This function tells when we should update.</dd>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw5">event</span> <span class="kw4">bool</span> KUpdateState<span class="br0">(</span><span class="kw6">out</span> KRigidBodyState newState<span class="br0">)</span>
<span class="br0">{</span>
        <span class="kw1">if</span><span class="br0">(</span><span class="kw8">Role</span> == <span class="kw9">ROLE_Authority</span> || !bNewCarState<span class="br0">)</span>
                <span class="kw1">return</span> <span class="kw9">false</span>;
 
        newState = ChassisState;
        bNewCarState = <span class="kw9">false</span>;
        <span class="kw1">return</span> <span class="kw9">true</span>;
<span class="br0">}</span>
</pre></div>
<dl>
<dt>SVehicleUpdateParams</dt>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw5">event</span> SVehicleUpdateParams<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
        <span class="kw5">local</span> <span class="kw4">int</span> i;
 
        <span class="kw6">Super</span>.<span class="me1">SVehicleUpdateParams</span><span class="br0">(</span><span class="br0">)</span>;
 
        <span class="kw1">for</span><span class="br0">(</span>i=<span class="nu0">0</span>; i&lt;Wheels.<span class="kw6">Length</span>; i++<span class="br0">)</span>
        <span class="br0">{</span>
                Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">Softness</span> = WheelSoftness;
                Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">PenScale</span> = WheelPenScale;
                Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">PenOffset</span> = WheelPenOffset;
                Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">LongSlip</span> = WheelLongSlip<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>;
                Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">LatSlipFunc</span> = WheelLatSlipFunc<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>;
                Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">Restitution</span> = WheelRestitution;
                Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">Adhesion</span> = WheelAdhesion;
                Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">WheelInertia</span> = WheelInertia;
                Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">LongFrictionFunc</span> = WheelLongFrictionFunc<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span>;
                Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">HandbrakeFrictionFactor</span> = WheelHandbrakeFriction;
                Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">HandbrakeSlipFactor</span> = WheelHandbrakeSlip;
                Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SuspensionTravel</span> = WheelSuspensionTravel;
                Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SuspensionOffset</span> = WheelSuspensionOffset;
                Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SuspensionMaxRenderTravel</span> = WheelSuspensionMaxRenderTravel;
        <span class="br0">}</span>
        <span class="kw1">if</span><span class="br0">(</span><span class="kw8">Level</span>.<span class="kw8">NetMode</span> != <span class="kw9">NM_DedicatedServer</span> &amp;&amp; bMakeBrakeLights<span class="br0">)</span>
        <span class="br0">{</span>
                <span class="kw1">for</span><span class="br0">(</span>i=<span class="nu0">0</span>; i&lt;<span class="nu0">2</span>; i++<span class="br0">)</span>
                <span class="br0">{</span>
                     <span class="kw1">if</span> <span class="br0">(</span>BrakeLight<span class="br0">[</span>i<span class="br0">]</span> != <span class="kw9">None</span><span class="br0">)</span>
                     <span class="br0">{</span>
                                BrakeLight<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SetBase</span><span class="br0">(</span><span class="kw9">None</span><span class="br0">)</span>;
                                BrakeLight<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SetLocation</span><span class="br0">(</span> Location + <span class="br0">(</span>BrakelightOffset<span class="br0">[</span>i<span class="br0">]</span> &gt;&gt; Rotation<span class="br0">)</span> <span class="br0">)</span>;
                                BrakeLight<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SetBase</span><span class="br0">(</span><span class="kw8">self</span><span class="br0">)</span>;
                                BrakeLight<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SetRelativeRotation</span><span class="br0">(</span> rot<span class="br0">(</span><span class="nu0">0</span>,<span class="nu0">32768</span>,<span class="nu0">0</span><span class="br0">)</span> <span class="br0">)</span>;
                                BrakeLight<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">Skins</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> = BrakeLightMaterial;
                      <span class="br0">}</span>
                <span class="br0">}</span>
        <span class="br0">}</span>
<span class="br0">}</span>
</pre></div>
<dl>
<dt>UpdateVehicle&#160;</dt>
<dd>This is the function were everything happens</dd>
</dl>
<pre>
          <i>Also see </i>Manual Shift Car/C++ Version
</pre>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw5">function</span> UpdateVehicle<span class="br0">(</span><span class="kw4">float</span> DeltaTime<span class="br0">)</span>
<span class="br0">{</span>
        <span class="kw5">local</span> <span class="kw4">Matrix</span> carTM;
        <span class="kw5">local</span> <span class="kw4">Vector</span> worldUp, worldRight, worldForward;
 
        <span class="kw5">local</span> KarmaParams KP;
        <span class="kw5">local</span> KRigidBodyState rbState;
        <span class="kw5">local</span> <span class="kw4">int</span>   i;
        <span class="kw5">local</span> <span class="kw4">float</span> maxSteerAngle, maxSteer, deltaSteer;
        <span class="kw5">local</span> <span class="kw4">float</span> DriveTorque, GripTorque, EngineTorque, EngineBraking, EngineWheelRatio;
        <span class="kw5">local</span> <span class="kw4">float</span> BrakeTorque;
        <span class="kw5">local</span> <span class="kw4">float</span> NewTotalSpinVel, LSDSplit, EvenSplit, UseSplit;
        <span class="kw5">local</span> <span class="kw4">float</span> TransInertia;
        <span class="kw5">local</span> <span class="kw4">float</span> LimitBrakeTorque;
        <span class="kw5">local</span> <span class="kw4">float</span> WheelTorque, VehicleForce, TransAcc;
        <span class="kw5">local</span> <span class="kw4">float</span> TurnAngVel, DampingScale, TurnDampingMag;
        <span class="kw5">local</span> <span class="kw4">float</span> PitchAngVel, RollAngVel, PitchDampingMag, RollDampingMag;
 
        <span class="kw5">local</span> <span class="kw4">Vector</span> AirControlTorque, AngVel;
        <span class="kw5">local</span> <span class="kw4">float</span>  VRate;
        <span class="kw5">local</span> <span class="kw4">Vector</span> Force, Torque;
        <span class="kw5">local</span> <span class="kw4">int</span> z;
 
        WForce = <span class="kw4">vect</span><span class="br0">(</span><span class="nu0">0</span>, <span class="nu0">0</span>, <span class="nu0">0</span><span class="br0">)</span>;
        WTorque = <span class="kw4">vect</span><span class="br0">(</span><span class="nu0">0</span>, <span class="nu0">0</span>, <span class="nu0">0</span><span class="br0">)</span>;
 
        <span class="kw1">if</span><span class="br0">(</span>!KIsAwake<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>
                <span class="kw1">return</span>;
        KP = KarmaParams<span class="br0">(</span>KParams<span class="br0">)</span>;
        <span class="kw1">if</span><span class="br0">(</span>KP == <span class="kw9">None</span><span class="br0">)</span>
                <span class="kw1">return</span>;
 
        <span class="kw1">if</span><span class="br0">(</span>Controller != <span class="kw9">None</span><span class="br0">)</span>
        <span class="br0">{</span>
              <span class="co1">//Calc up (z), right(y) and forward (x) vectors</span>
              GetAxes<span class="br0">(</span>Rotation, worldRight, worldForward, worldUp<span class="br0">)</span>;
 
              <span class="co1">/////////// STEERING ///////////</span>
              maxSteerAngle = <span class="kw7">InterpCurveEval</span><span class="br0">(</span>MaxSteerAngleCurve, VRate<span class="br0">)</span>;
              <span class="kw1">if</span><span class="br0">(</span>maxSteerAngle==<span class="nu0">0</span><span class="br0">)</span>
                    maxSteer = DeltaTime * SteerSpeed * maxSteerAngle;
              <span class="kw1">else</span>
                    maxSteer = DeltaTime * SteerSpeed;
 
              deltaSteer = <span class="br0">(</span>-Steering * maxSteerAngle<span class="br0">)</span> - ActualSteering; <span class="co1">// Amount we want to move (target - current)</span>
              deltaSteer = <span class="kw7">Clamp</span><span class="br0">(</span>deltaSteer, -maxSteer, maxSteer<span class="br0">)</span>;
              ActualSteering += deltaSteer;
 
              <span class="kw1">if</span><span class="br0">(</span>bAuto==<span class="kw9">True</span><span class="br0">)</span>
              <span class="br0">{</span>
                      EngineTorque = OutputGas * <span class="kw7">InterpCurveEval</span><span class="br0">(</span>TorqueCurve, EngineRPM<span class="br0">)</span>;
                      EngineBraking = <span class="br0">(</span><span class="nu0">1</span>.0f - OutputGas<span class="br0">)</span> * <span class="br0">(</span>EngineBrakeRPMScale*EngineRPM * EngineBrakeRPMScale*EngineRPM * EngineBrakeFactor<span class="br0">)</span>;
                      EngineTorque -= EngineBraking;
                      EngineWheelRatio = GearRatios<span class="br0">[</span>Gear<span class="br0">]</span> * TransRatio;
                      NewTotalSpinVel=<span class="nu0">0.0</span>;
                      EngineRPM = <span class="nu0">0.0</span>;
                      <span class="kw1">for</span><span class="br0">(</span>i=<span class="nu0">0</span>; i&lt;Wheels.<span class="kw6">length</span>; i++<span class="br0">)</span>
                      <span class="br0">{</span>
                              EvenSplit = <span class="nu0">1</span>/NumPoweredWheels;
                              <span class="kw1">if</span><span class="br0">(</span>TotalSpinVel &gt; <span class="nu0">0.1</span><span class="br0">)</span>
                                      LSDSplit = <span class="br0">(</span>TotalSpinVel - Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SpinVel</span><span class="br0">)</span>/<span class="br0">(</span><span class="br0">(</span>NumPoweredWheels<span class="nu0">-1</span><span class="br0">)</span> * TotalSpinVel<span class="br0">)</span>;
                              <span class="kw1">else</span>
                                      LSDSplit = EvenSplit;
                              UseSplit = <span class="br0">(</span><span class="br0">(</span><span class="nu0">1</span>-LSDFactor<span class="br0">)</span> * EvenSplit<span class="br0">)</span> + <span class="br0">(</span>LSDFactor * LSDSplit<span class="br0">)</span>;
                              DriveTorque = UseSplit * <span class="br0">(</span>EngineTorque / EngineWheelRatio<span class="br0">)</span>;
                              GripTorque = FTScale * Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">WheelRadius</span> * Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">TireLoad</span> * WheelLongFrictionScale<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> * <span class="kw7">InterpCurveEval</span><span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">LongFrictionFunc</span>, <span class="kw7">Abs</span><span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SlipVel</span><span class="br0">)</span><span class="br0">)</span>;
                              <span class="kw1">if</span><span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SlipVel</span> &lt; <span class="nu0">0.0</span><span class="br0">)</span>
                                      GripTorque *= <span class="nu0">-1.0</span>;
                              TransInertia = <span class="br0">(</span>EngineInertia / <span class="kw7">Abs</span><span class="br0">(</span>GearRatios<span class="br0">[</span>Gear<span class="br0">]</span> * TransRatio<span class="br0">)</span><span class="br0">)</span> + Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">WheelInertia</span>;
                              <span class="kw1">if</span><span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SpinVel</span> &gt; <span class="nu0">0.0</span><span class="br0">)</span>
                                      BrakeTorque = -OutputBrake * MaxBrakeTorque;
                              <span class="kw1">else</span>
                                      BrakeTorque = OutputBrake * MaxBrakeTorque;
 
                              LimitBrakeTorque = <span class="br0">(</span> <span class="kw7">Abs</span><span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SpinVel</span><span class="br0">)</span> * TransInertia <span class="br0">)</span> / TheDeltaTime; <span class="co1">// Size of torque needed to completely stop wheel spinning.</span>
                              BrakeTorque = <span class="kw7">Clamp</span><span class="br0">(</span>BrakeTorque, -LimitBrakeTorque, LimitBrakeTorque<span class="br0">)</span>; <span class="co1">// Never apply more than this!</span>
                              WheelTorque = DriveTorque + BrakeTorque - GripTorque;
                              VehicleForce = GripTorque / <span class="br0">(</span>FTScale * Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">WheelRadius</span><span class="br0">)</span>;
                              <span class="kw1">if</span><span class="br0">(</span> OutputBrake &gt; <span class="nu0">0.0</span> ||  <span class="br0">(</span>DriveTorque + BrakeTorque<span class="br0">)</span> * Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SpinVel</span> &lt; <span class="nu0">0.0</span><span class="br0">)</span>
                              <span class="br0">{</span>
                                      Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">DriveForce</span> = <span class="nu0">0.0</span>;
                                      Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">LongFriction</span> = <span class="kw7">Abs</span><span class="br0">(</span>VehicleForce<span class="br0">)</span> + <span class="br0">(</span>OutputBrake * MinBrakeFriction<span class="br0">)</span>;
                              <span class="br0">}</span>
                              <span class="kw1">else</span>
                              <span class="br0">{</span>
                                      Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">DriveForce</span> = VehicleForce;
                                      Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">LongFriction</span> = <span class="nu0">0.0</span>;
                              <span class="br0">}</span>
                              <span class="kw1">if</span> <span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">bWheelOnGround</span><span class="br0">)</span>
                                      Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">ChassisTorque</span> = <span class="nu0">-1.0</span> * <span class="br0">(</span>DriveTorque + BrakeTorque<span class="br0">)</span> * ChassisTorqueScale;
                               <span class="kw1">else</span>
                                      Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">ChassisTorque</span> = <span class="nu0">0.0</span>;
                              TransAcc = WheelTorque / TransInertia;
                              Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SpinVel</span> += TransAcc * DeltaTime;
                              <span class="kw1">if</span><span class="br0">(</span>Gear == <span class="nu0">0</span> &amp;&amp; Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SpinVel</span> &gt; <span class="nu0">0.0</span><span class="br0">)</span>
                                      Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SpinVel</span> = <span class="nu0">0.0</span>;
                              <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>Gear &gt; <span class="nu0">0</span> &amp;&amp; Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SpinVel</span> &lt; <span class="nu0">0.0</span><span class="br0">)</span>
                                      Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SpinVel</span> = <span class="nu0">0.0</span>;
                              NewTotalSpinVel += Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SpinVel</span>;
                              EngineRPM += Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SpinVel</span> / EngineWheelRatio;
                              Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">LatFriction</span> = WheelLatFrictionScale<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> * Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">TireLoad</span>;
                              Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">LatSlip</span> = <span class="kw7">InterpCurveEval</span><span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">LatSlipFunc</span>, Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SlipAngle</span><span class="br0">)</span>;
                              <span class="kw1">if</span><span class="br0">(</span>OutputHandbrake &amp;&amp; Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">bHandbrakeWheel</span><span class="br0">)</span>
                              <span class="br0">{</span>
                                      Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">LatFriction</span> *= Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">HandbrakeFrictionFactor</span>;
                                      Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">LatSlip</span> *= Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">HandbrakeSlipFactor</span>;
                              <span class="br0">}</span>
                              <span class="kw1">if</span><span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SteerType</span> == VST_Steered<span class="br0">)</span>
                                      Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">Steer</span> = ActualSteering;
                              <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SteerType</span> == VST_Inverted<span class="br0">)</span>
                                      Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">Steer</span> = -ActualSteering;
                              <span class="kw1">else</span>
                                      Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">Steer</span> = <span class="nu0">0.0</span>;
                      <span class="br0">}</span>
                      EngineRPM /= NumPoweredWheels;
                      EngineRPM = <span class="kw7">Max</span><span class="br0">(</span>EngineRPM, <span class="nu0">0.01</span><span class="br0">)</span>; <span class="co1">// ensure always positive!</span>
                      TotalSpinVel = NewTotalSpinVel;
              <span class="br0">}</span>
<span class="co1">///////////////STICK SHIFT///////////////////////////////</span>
              <span class="kw1">else</span>
              <span class="br0">{</span>
                   <span class="kw1">if</span><span class="br0">(</span>bClutching<span class="br0">)</span>
                   <span class="br0">{</span>
                        EngineTorque = <span class="kw7">InterpCurveEval</span><span class="br0">(</span>TorqueCurve, EngineRPM<span class="br0">)</span>;
                   <span class="br0">}</span>
                   <span class="kw1">else</span>
                   <span class="br0">{</span>
                        EngineTorque = <span class="kw7">InterpCurveEval</span><span class="br0">(</span>TorqueCurve, EngineRPM<span class="br0">)</span>;
                        <span class="kw1">if</span><span class="br0">(</span>EngineTorque &gt;= <span class="nu0">0</span><span class="br0">)</span>
                        <span class="br0">{</span>
                                   <span class="co1">// Calculate torque at output of engine. Combination of throttle, current RPM and engine braking.</span>
                                EngineTorque = OutputGas * <span class="kw7">InterpCurveEval</span><span class="br0">(</span>TorqueCurve, EngineRPM<span class="br0">)</span>;
                        <span class="br0">}</span>
                        <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>EngineTorque &lt; <span class="nu0">0</span><span class="br0">)</span>
                        <span class="br0">{</span>
                                EngineTorque = <span class="kw7">InterpCurveEval</span><span class="br0">(</span>TorqueCurve, EngineRPM<span class="br0">)</span>;
                        <span class="br0">}</span>
 
                        EngineBraking = <span class="br0">(</span><span class="nu0">1</span>.0f - OutputGas<span class="br0">)</span> * <span class="br0">(</span>EngineBrakeRPMScale*EngineRPM * EngineBrakeRPMScale*EngineRPM * EngineBrakeFactor<span class="br0">)</span>;
                   <span class="br0">}</span>
 
                  <span class="co1">// EngineRPM = OutputGas * InterpCurveEval(RPMCurve, EngineTorque);</span>
 
                   EngineTorque -= EngineBraking;
                   ETorque = EngineTorque;
                   <span class="co1">//DebugInfo = FString::Printf(TEXT("OutputBrake: %f      EngineRPM: %f    EngineTorque: %f"), OutputBrake, EngineRPM, EngineTorque);</span>
 
                   <span class="co1">// Total gear ratio between engine and differential (ie before being split between wheels).</span>
                   <span class="co1">// A higher gear ratio and the torque at the wheels is reduced.</span>
                   EngineWheelRatio = GearRatios<span class="br0">[</span>Gear<span class="br0">]</span> * TransRatio;
 
                   <span class="kw1">if</span><span class="br0">(</span>bClutching<span class="br0">)</span>
                   <span class="br0">{</span>
                        <span class="co1">//EngineRPM = 0.0;</span>
                        WheelRPM = <span class="nu0">0.0</span>;
                   <span class="br0">}</span>
                   <span class="kw1">else</span>
                   <span class="br0">{</span>
                        <span class="kw1">if</span><span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">bPoweredWheel</span><span class="br0">)</span>
                        <span class="br0">{</span>
                             <span class="co1">// Reset engine RPM. We calculate this by adding the component of each wheel spinning.</span>
                             NewTotalSpinVel=<span class="nu0">0.0</span>;
                             <span class="kw1">if</span><span class="br0">(</span>bInGear<span class="br0">)</span>
                             <span class="br0">{</span>
                                   WheelRPM = <span class="nu0">0.0</span>;
                                   EngineRPM = <span class="nu0">0.0</span>;
                             <span class="br0">}</span>
                             <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>!bInGear<span class="br0">)</span>
                                   WheelRPM = <span class="nu0">0.0</span>;
                        <span class="br0">}</span>
                   <span class="br0">}</span>
 
              <span class="co1">// Do model for each wheel.</span>
              <span class="co1">//  Okay this needs to be fixed because the way this is, all the wheels get power</span>
 
                   <span class="kw1">for</span><span class="br0">(</span>i=<span class="nu0">0</span>;i&lt;Wheels.<span class="kw6">length</span>; i++<span class="br0">)</span>
                   <span class="br0">{</span>
                      <span class="co1">//Wheels[i];</span>
                      <span class="co1">/////////// DRIVE ///////////</span>
                      <span class="co1">// Heuristic to divide torque up so that the wheels that are spinning slower get more of it.</span>
                      <span class="co1">// Sum of LSDFactor across all wheels should be 1.</span>
                      <span class="co1">// JTODO: Do we need to handle the case of vehicles with different size wheels?</span>
 
                      EvenSplit = <span class="nu0">1</span>/NumPoweredWheels;
 
                      <span class="co1">// If no wheels are spinning, just do an even split.</span>
                      <span class="kw1">if</span><span class="br0">(</span>TotalSpinVel &gt; <span class="nu0">0.1</span><span class="br0">)</span>
                              LSDSplit = <span class="br0">(</span>TotalSpinVel - Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SpinVel</span><span class="br0">)</span>/<span class="br0">(</span><span class="br0">(</span>NumPoweredWheels<span class="nu0">-1</span><span class="br0">)</span> * TotalSpinVel<span class="br0">)</span>;
                      <span class="kw1">else</span>
                              LSDSplit = EvenSplit;
 
                      UseSplit = <span class="br0">(</span><span class="br0">(</span><span class="nu0">1</span>-LSDFactor<span class="br0">)</span> * EvenSplit<span class="br0">)</span> + <span class="br0">(</span>LSDFactor * LSDSplit<span class="br0">)</span>;
 
                      <span class="kw1">if</span><span class="br0">(</span>bClutching<span class="br0">)</span>
                      <span class="br0">{</span>
                           EngineRPM = RPM;
 
                           <span class="co1">//DriveTorque = UseSplit * (EngineTorque / EngineWheelRatio);</span>
                      <span class="br0">}</span>
                      <span class="kw1">else</span>
                      <span class="br0">{</span>
                           <span class="kw1">if</span><span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">bPoweredWheel</span><span class="br0">)</span>
                           <span class="br0">{</span>
                                <span class="co1">//EngineRPM = RPM;</span>
 
                                <span class="co1">// Calculate Drive Torque : applied at wheels (ie after gearbox and differential)</span>
                                <span class="co1">// This is an 'open differential' ie. equal torque to each wheel</span>
                                DriveTorque = UseSplit * <span class="br0">(</span>EngineTorque / EngineWheelRatio<span class="br0">)</span>;
                           <span class="br0">}</span>
                      <span class="br0">}</span>
 
                      <span class="co1">/////////// LONGITUDINAL ///////////</span>
                      <span class="co1">// Calculate Grip Torque : longitudinal force against ground * distance of action (radius of tyre)</span>
                      <span class="co1">// LongFrictionFunc is assumed to be reflected for negative Slip Ratio</span>
                      GripTorque = FTScale * Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">WheelRadius</span> * Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">TireLoad</span> * WheelLongFrictionScale<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> * <span class="kw7">InterpCurveEval</span><span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">LongFrictionFunc</span>, <span class="kw7">Abs</span><span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SlipVel</span><span class="br0">)</span><span class="br0">)</span>;
 
                      <span class="kw1">if</span><span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SlipVel</span> &lt; <span class="nu0">0.0</span><span class="br0">)</span>
                              GripTorque *= <span class="nu0">-1.0</span>;
 
                      <span class="kw1">if</span><span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">bPoweredWheel</span><span class="br0">)</span>
                      <span class="br0">{</span>
                           <span class="co1">// GripTorque can't be more than the torque needed to invert slip ratio.</span>
                           TransInertia = <span class="br0">(</span>EngineInertia / <span class="kw7">Abs</span><span class="br0">(</span>GearRatios<span class="br0">[</span>Gear<span class="br0">]</span> * TransRatio<span class="br0">)</span><span class="br0">)</span> + Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">WheelInertia</span>;
                      <span class="br0">}</span>
 
                      <span class="co1">//FLOAT SlipAngVel = Wheels[i].SlipVel/Wheels[i].WheelRadius;</span>
 
                      <span class="kw1">if</span><span class="br0">(</span>bBraking<span class="br0">)</span>
                      <span class="br0">{</span>
                           <span class="co1">// Brake torque acts to stop wheels (ie against direction of motion)</span>
                           BrakeTorque = <span class="nu0">0.0</span>;
                           <span class="kw1">if</span><span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SpinVel</span> &gt; <span class="nu0">0.0</span><span class="br0">)</span>
                                BrakeTorque = -OutputBrake * MaxBrakeTorque;
                          <span class="kw1">else</span>
                                BrakeTorque = OutputBrake * MaxBrakeTorque;
 
                           LimitBrakeTorque = <span class="br0">(</span> <span class="kw7">Abs</span><span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SpinVel</span><span class="br0">)</span> * TransInertia <span class="br0">)</span> / TheDeltaTime; <span class="co1">// Size of torque needed to completely stop wheel spinning.</span>
                           BrakeTorque = <span class="kw7">Clamp</span><span class="br0">(</span>BrakeTorque, -LimitBrakeTorque, LimitBrakeTorque<span class="br0">)</span>; <span class="co1">// Never apply more than this!</span>
                           mBrakeTorque = BrakeTorque;
                      <span class="br0">}</span>
                      <span class="kw1">else</span>
                      <span class="br0">{</span>
                           BrakeTorque = <span class="nu0">0</span>;
                           mBrakeTorque = BrakeTorque;
                      <span class="br0">}</span>
<span class="co1">//_____________________________________________</span>
 
                      <span class="kw1">if</span><span class="br0">(</span>bClutching<span class="br0">)</span>
                      <span class="br0">{</span>
                              WheelTorque = GripTorque;
                              <span class="co1">//Log("GripTorque");</span>
                              <span class="co1">//Log(GripTorque);</span>
                      <span class="br0">}</span>
                      <span class="kw1">else</span>     <span class="co1">// we are in full gear</span>
                      <span class="br0">{</span>
                           <span class="kw1">if</span><span class="br0">(</span>!Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">bPoweredWheel</span><span class="br0">)</span>
                           <span class="br0">{</span>
                              <span class="co1">//Don't do this if 4 wheel drive!!!!</span>
                              WheelTorque = GripTorque * <span class="nu0">2</span>;
                           <span class="br0">}</span>
                           <span class="kw1">else</span>
                           <span class="br0">{</span>
                              <span class="co1">// Resultant torque at wheel : torque applied from engine + brakes + equal-and-opposite from tire-road interaction.</span>
                              WheelTorque = DriveTorque + BrakeTorque - GripTorque;
                          <span class="coMULTI">/*    Log("WheelTorque");
                              Log(WheelTorque);
                              Log("GripTorque");
                              Log(GripTorque);      */</span>
                           <span class="br0">}</span>
                      <span class="br0">}</span>
<span class="co1">//____________________________________________</span>
 
                      <span class="co1">// Resultant linear force applied to car. (GripTorque applied at road)</span>
                      VehicleForce = GripTorque / <span class="br0">(</span>FTScale * Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">WheelRadius</span><span class="br0">)</span>;
 
                      <span class="co1">// If the wheel torque is opposing the direction of spin (ie braking) we use friction to apply it.</span>
                      <span class="kw1">if</span><span class="br0">(</span> OutputBrake &gt; <span class="nu0">0</span> &amp;&amp; bBraking<span class="br0">)</span><span class="co1">//  || (DriveTorque + BrakeTorque) * Wheels[i].SpinVel &lt; 0.0</span>
                      <span class="br0">{</span>
                              Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">DriveForce</span> = <span class="nu0">0.0</span>;
                              Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">LongFriction</span> = <span class="kw7">Abs</span><span class="br0">(</span>VehicleForce<span class="br0">)</span> + <span class="br0">(</span>OutputBrake * MinBrakeFriction<span class="br0">)</span>;
                      <span class="br0">}</span>
                      <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>bClutching<span class="br0">)</span>
                      <span class="br0">{</span>
                              Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">DriveForce</span> = <span class="nu0">0.0</span>;
                              Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">LongFriction</span> = <span class="nu0">0.0</span>;
                      <span class="br0">}</span>
                      <span class="kw1">else</span>
                      <span class="br0">{</span>
                              <span class="kw1">if</span><span class="br0">(</span>!Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">bPoweredWheel</span><span class="br0">)</span>
                              <span class="br0">{</span>
                                     Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">DriveForce</span> = <span class="nu0">0.0</span>;
                                     Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">LongFriction</span> = <span class="nu0">0.0</span>;
                              <span class="br0">}</span>
                              <span class="kw1">else</span>
                              <span class="br0">{</span>
                                   Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">DriveForce</span> = VehicleForce;
                                   Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">LongFriction</span> = <span class="nu0">0.0</span>;
                                   <span class="co1">//Wheels[i].LongFriction = 0.0;</span>
                              <span class="br0">}</span>
                      <span class="br0">}</span>
 
 
                      <span class="kw1">if</span><span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">bPoweredWheel</span><span class="br0">)</span>
                      <span class="br0">{</span>
                           <span class="co1">// Calculate torque applied back to chassis if wheel is on the ground</span>
                           <span class="kw1">if</span> <span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">bWheelOnGround</span><span class="br0">)</span>
                              Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">ChassisTorque</span> = <span class="nu0">-1.0</span> * <span class="br0">(</span>DriveTorque + BrakeTorque<span class="br0">)</span> * ChassisTorqueScale;
                           <span class="kw1">else</span>
                              Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">ChassisTorque</span> = <span class="nu0">0.0</span>;
                      <span class="br0">}</span>
 
                      <span class="co1">// Calculate new wheel speed.</span>
                      <span class="co1">// The lower the gear ratio, the harder it is to accelerate the engine.</span>
 
                      <span class="kw1">if</span><span class="br0">(</span>bClutching<span class="br0">)</span>
                      <span class="br0">{</span>
                             TransAcc = WheelTorque / <span class="nu0">-1</span>;
                             Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SpinVel</span> += TransAcc * DeltaTime;
                      <span class="br0">}</span>
                      <span class="kw1">else</span>
                      <span class="br0">{</span>
                             <span class="kw1">if</span><span class="br0">(</span>!Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">bPoweredWheel</span><span class="br0">)</span>
                             <span class="br0">{</span>
                                   TransAcc = WheelTorque / <span class="nu0">-1</span>;
                                   Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SpinVel</span> += TransAcc * DeltaTime;
                             <span class="br0">}</span>
                             <span class="kw1">else</span>
                             <span class="br0">{</span>
                                   TransAcc = WheelTorque / TransInertia;
                                   Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SpinVel</span> += TransAcc * DeltaTime;
                             <span class="br0">}</span>
                      <span class="br0">}</span>
 
<span class="co1">//  -----this is were the engine needs to be slowly put into gear-----</span>
 
                      <span class="kw1">if</span><span class="br0">(</span>bClutching<span class="br0">)</span>
                      <span class="br0">{</span>
 
                          WheelRPM += <span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SpinVel</span> / EngineWheelRatio<span class="br0">)</span>;
                          <span class="co1">//TorqueConverter();</span>
                      <span class="br0">}</span>
                      <span class="kw1">else</span>   <span class="co1">// we are in full gear</span>
                      <span class="br0">{</span>
                          <span class="kw1">if</span><span class="br0">(</span>!Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">bPoweredWheel</span><span class="br0">)</span>
                          <span class="br0">{</span>
                               WheelRPM += <span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SpinVel</span> / EngineWheelRatio<span class="br0">)</span>;
                          <span class="br0">}</span>
                          <span class="kw1">else</span>
                          <span class="br0">{</span>
                               <span class="co1">// Accumulate wheel spin speeds to find engine RPM.</span>
                               <span class="co1">// The lower the gear ratio, the faster the engine spins for a given wheel speed.</span>
                               NewTotalSpinVel += Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SpinVel</span>;
                               <span class="kw1">if</span><span class="br0">(</span>!bInGear<span class="br0">)</span>
                               <span class="br0">{</span>
<span class="co1">//                                  EngineRPM += (Wheels[i].SpinVel / EngineWheelRatio);</span>
                                    WheelRPM += <span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SpinVel</span> / EngineWheelRatio<span class="br0">)</span>;
                                    TorqueConverter<span class="br0">(</span><span class="br0">)</span>;
 
                               <span class="br0">}</span>
                               <span class="kw1">if</span><span class="br0">(</span>bInGear<span class="br0">)</span>
                               <span class="br0">{</span>
                                    WheelRPM += <span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SpinVel</span> / EngineWheelRatio<span class="br0">)</span>;
                                    EngineRPM += <span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SpinVel</span> / EngineWheelRatio<span class="br0">)</span>;
                               <span class="br0">}</span>
                          <span class="br0">}</span>
 
                      <span class="br0">}</span>
<span class="co1">//  ---------------------------------------------------------------</span>
 
                      <span class="co1">// Make sure the wheel can't spin in the wrong direction for the current gear.</span>
                      <span class="kw1">if</span><span class="br0">(</span>bClutching<span class="br0">)</span>
                      <span class="br0">{</span>
                      <span class="br0">}</span>
                      <span class="kw1">else</span>
                      <span class="br0">{</span>
                           <span class="kw1">if</span><span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">bPoweredWheel</span><span class="br0">)</span>
                           <span class="br0">{</span>
                                  <span class="kw1">if</span><span class="br0">(</span>Gear == <span class="nu0">0</span> &amp;&amp; Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SpinVel</span> &gt; <span class="nu0">0.0</span><span class="br0">)</span>
                                       Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SpinVel</span> = <span class="nu0">0.0</span>;
                                  <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>Gear &gt; <span class="nu0">0</span> &amp;&amp; Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SpinVel</span> &lt; <span class="nu0">0.0</span><span class="br0">)</span>
                                       Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SpinVel</span> = <span class="nu0">0.0</span>;
                           <span class="br0">}</span>
                      <span class="br0">}</span>
 
                      <span class="co1">/////////// LATERAL ///////////</span>
                      <span class="kw1">if</span><span class="br0">(</span>!Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">bPoweredWheel</span><span class="br0">)</span>
                      <span class="br0">{</span>
                           Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">LatFriction</span> = <span class="br0">(</span>WheelLatFrictionScale<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> * <span class="nu0">1.5</span><span class="br0">)</span> * Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">TireLoad</span> ;
                           Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">LatSlip</span> = <span class="kw7">InterpCurveEval</span><span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">LatSlipFunc</span>, Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SlipAngle</span><span class="br0">)</span>;
                      <span class="br0">}</span>
                      <span class="kw1">else</span>
                      <span class="br0">{</span>
                           Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">LatFriction</span> = WheelLatFrictionScale<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> * Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">TireLoad</span>;
                           Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">LatSlip</span> = <span class="kw7">InterpCurveEval</span><span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">LatSlipFunc</span>, Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SlipAngle</span><span class="br0">)</span>;
                      <span class="br0">}</span>
 
                      <span class="kw1">if</span><span class="br0">(</span>OutputHandbrake &amp;&amp; Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">bHandbrakeWheel</span><span class="br0">)</span>
                      <span class="br0">{</span>
                              Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">LatFriction</span> *= Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">HandbrakeFrictionFactor</span>;
                              Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">LatSlip</span> *= Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">HandbrakeSlipFactor</span>;
                      <span class="br0">}</span>
 
                      <span class="co1">/////////// STEERING  ///////////</span>
 
                      <span class="co1">// Pass on steering to wheels that want it.</span>
                      <span class="kw1">if</span><span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SteerType</span> == VST_Steered<span class="br0">)</span>
                              Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">Steer</span> = ActualSteering;
                      <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SteerType</span> == VST_Inverted<span class="br0">)</span>
                              Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">Steer</span> = -ActualSteering;
                      <span class="kw1">else</span>
                              Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">Steer</span> = <span class="nu0">0.0</span>;
                 <span class="br0">}</span>
              <span class="br0">}</span>
              <span class="kw1">if</span><span class="br0">(</span>bClutching<span class="br0">)</span>
              <span class="br0">{</span>
              <span class="br0">}</span>
              <span class="kw1">else</span>
              <span class="br0">{</span>
                   <span class="co1">// EngineRPM is in radians per second, want in revolutions per minute</span>
                   EngineRPM /= <span class="nu0">4</span>;
<span class="co1">//               EngineRPM /= 2.0 * PI; // revs per sec</span>
<span class="co1">//               EngineRPM *= 60;</span>
                   EngineRPM = <span class="kw7">Max</span><span class="br0">(</span>EngineRPM, <span class="nu0">0.00</span><span class="br0">)</span>; <span class="co1">// ensure always positive!</span>
 
                   RPM /= NumPoweredWheels;
<span class="co1">//               RPM /= 2.0 * PI; // revs per sec</span>
<span class="co1">//               RPM *= 60;</span>
                   RPM = <span class="kw7">Max</span><span class="br0">(</span>EngineRPM, <span class="nu0">0.00</span><span class="br0">)</span>; <span class="co1">// ensure always positive!</span>
              <span class="br0">}</span>
 
              <span class="kw1">if</span><span class="br0">(</span>!bClutching<span class="br0">)</span>
              <span class="br0">{</span>
                   <span class="co1">// Update total wheel spin vel</span>
                   TotalSpinVel = NewTotalSpinVel;
              <span class="br0">}</span>
 
              <span class="co1">// Turn (yaw) damping.</span>
              carTM = CachedLocalToWorld;  <span class="co1">// was  carTM = LocalToWorld()</span>
              <span class="co1">//worldUp(carTM.M[2][0], carTM.M[2][1], carTM.M[2][2]);</span>
              <span class="co1">//worldRight(carTM.M[1][0], carTM.M[1][1], carTM.M[1][2]);</span>
              <span class="co1">//worldForward(carTM.M[0][0], carTM.M[0][1], carTM.M[0][2]);</span>
 
            <span class="co1">//  KGetRigidBodyState(rbState);</span>
            <span class="co1">//  AngVel = KRBVecToVector(rbState.AngVel);</span>
              AngVel.<span class="me1">X</span> = rbState.<span class="me1">AngVel</span>.<span class="me1">X</span>;
              AngVel.<span class="me1">Y</span> = rbState.<span class="me1">AngVel</span>.<span class="me1">Y</span>;
              AngVel.<span class="me1">Z</span> = rbState.<span class="me1">AngVel</span>.<span class="me1">Z</span>;
              TurnAngVel = AngVel <span class="kw3">dot</span> worldUp;
 
              DampingScale = <span class="nu0">1.0</span> - MinAirControlDamping;
              <span class="kw1">if</span><span class="br0">(</span>bAllowAirControl &amp;&amp; !bVehicleOnGround<span class="br0">)</span>
              <span class="br0">{</span>
          <span class="co1">//            Log("bVehicleOnGround");</span>
          <span class="co1">//            Log(bVehicleOnGround);</span>
                      TurnDampingMag = <span class="br0">(</span><span class="nu0">1.0</span> - DampingScale*<span class="kw7">Abs</span><span class="br0">(</span>Steering<span class="br0">)</span><span class="br0">)</span> * TurnDamping * TurnAngVel;
                      <span class="co1">//KAddImpulse( WForce, -TurnDampingMag * worldUp );</span>
                      Force += <span class="br0">(</span>WForce + <span class="br0">(</span><span class="nu0">-1</span> * TurnDampingMag<span class="br0">)</span> * worldUp<span class="br0">)</span>;
              <span class="br0">}</span>
 
              <span class="kw1">else</span>
              <span class="br0">{</span>
                      TurnDampingMag = <span class="br0">(</span><span class="nu0">1.0</span> - <span class="kw7">Abs</span><span class="br0">(</span>ActualSteering<span class="br0">)</span><span class="br0">)</span> * TurnDamping * TurnAngVel;
                      <span class="co1">//KAddImpulse( WForce, -TurnDampingMag * worldUp );</span>
                      Force += <span class="br0">(</span>WForce + <span class="br0">(</span><span class="nu0">-1</span> + TurnDampingMag<span class="br0">)</span> * worldUp<span class="br0">)</span>;
              <span class="br0">}</span>
 
              <span class="co1">// If vehicle is in the air and we are allowing air control...</span>
              <span class="kw1">if</span><span class="br0">(</span>!bVehicleOnGround<span class="br0">)</span>
              <span class="br0">{</span>
                      PitchAngVel = AngVel <span class="kw3">dot</span> worldRight;
                      RollAngVel = AngVel <span class="kw3">dot</span> worldForward;
 
                      <span class="kw1">if</span><span class="br0">(</span>bAllowAirControl<span class="br0">)</span>
                      <span class="br0">{</span>
                              AirControlTorque = worldRight * OutputPitch * -AirPitchTorque;
 
                              <span class="kw1">if</span><span class="br0">(</span>bIsWalking<span class="br0">)</span>
                              <span class="br0">{</span>
        <span class="co1">//                          Log("bIsWalking");</span>
        <span class="co1">//                          Log(bIsWalking);</span>
                                      AirControlTorque += <span class="br0">(</span>worldForward * Steering * -AirRollTorque<span class="br0">)</span>;
                                      <span class="br0">}</span>
                              <span class="kw1">else</span>
                              <span class="br0">{</span>
                                      AirControlTorque += <span class="br0">(</span>worldUp * Steering * -AirTurnTorque<span class="br0">)</span>;
                              <span class="br0">}</span>
                              <span class="co1">//KAddImpulse( WForce, AirControlTorque );</span>
                              Force += AirControlTorque;
 
                              <span class="co1">// Damping forces</span>
                              PitchDampingMag = <span class="br0">(</span><span class="nu0">1.0</span> - DampingScale*<span class="kw7">Abs</span><span class="br0">(</span>OutputPitch<span class="br0">)</span><span class="br0">)</span> * AirPitchDamping * PitchAngVel;
                              RollDampingMag = <span class="br0">(</span><span class="nu0">1.0</span> - DampingScale*<span class="kw7">Abs</span><span class="br0">(</span>Steering<span class="br0">)</span><span class="br0">)</span> * AirRollDamping * RollAngVel;
 
                              <span class="co1">//KAddImpulse( WForce, (-PitchDampingMag * worldRight) + (-RollDampingMag * worldForward) );</span>
                              Force += <span class="br0">(</span>WForce + <span class="br0">(</span><span class="br0">(</span><span class="nu0">-1</span> + PitchDampingMag<span class="br0">)</span> * worldRight<span class="br0">)</span> + <span class="br0">(</span><span class="br0">(</span><span class="nu0">-1</span> + RollDampingMag<span class="br0">)</span> * worldForward<span class="br0">)</span><span class="br0">)</span>;
 
                              UDForce = Force;
                              UDTorque = Torque;
                      <span class="br0">}</span>
                      <span class="kw1">else</span>
                      <span class="br0">{</span>
                         PitchDampingMag = AirPitchDamping * PitchAngVel;
                         <span class="co1">//KAddImpulse( WForce, -PitchDampingMag * worldRight );</span>
                         Force += <span class="br0">(</span>WForce + <span class="br0">(</span><span class="nu0">-1</span> + PitchDampingMag<span class="br0">)</span> * worldRight<span class="br0">)</span>;
                      <span class="br0">}</span>
              <span class="br0">}</span>
              <span class="kw1">else</span>
              <span class="br0">{</span>
                   UDForce = Force;
                   UDTorque = Torque;
              <span class="br0">}</span>
        <span class="br0">}</span>
<span class="br0">}</span>
</pre></div>
<dl>
<dt>Engine</dt>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw5">function</span> Engine<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
     Gas = Gas2;
     RPM = <span class="kw7">InterpCurveEval</span><span class="br0">(</span>EngineS, Gas<span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
<dl>
<dt>StoptheCar</dt>
</dl>
<ul>
<li>This function allows for slower, more real life like breaking</li>
</ul>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw5">function</span> StoptheCar<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
   <span class="kw1">if</span><span class="br0">(</span>bBraking<span class="br0">)</span>
   <span class="br0">{</span>
      <span class="kw1">if</span><span class="br0">(</span>hBrake&lt;=<span class="nu0">21</span> &amp;&amp; hBrake&gt;=<span class="nu0">0</span><span class="br0">)</span>
      <span class="br0">{</span>
           hBrake += <span class="nu0">0.5</span>;
      <span class="br0">}</span>
      <span class="kw1">if</span><span class="br0">(</span>hBrake&gt;<span class="nu0">21</span><span class="br0">)</span>
             hBrake = <span class="nu0">21</span>;
   <span class="br0">}</span>
   <span class="kw1">if</span><span class="br0">(</span>!bBraking<span class="br0">)</span>
   <span class="br0">{</span>
           <span class="kw1">if</span><span class="br0">(</span>hBrake&lt;=<span class="nu0">21</span> &amp;&amp; hBrake&gt;=<span class="nu0">0</span><span class="br0">)</span>
           <span class="br0">{</span>
                hBrake -= <span class="nu0">0.5</span>;
           <span class="br0">}</span>
           <span class="kw1">if</span><span class="br0">(</span>hBrake&lt;<span class="nu0">0</span><span class="br0">)</span>
                hBrake = <span class="nu0">0</span>;
   <span class="br0">}</span>
<span class="br0">}</span>
</pre></div>
<dl>
<dt>TorqueConverter</dt>
</dl>
<ul>
<li>This function should prolly have a different name, I named it this thinking I would need to accually have a torque converter for the tranny but I turned out making it a function that eases into gear and fixes the rpm to equal that of the engine rpm when the clutch is pressed.</li>
</ul>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw5">function</span> TorqueConverter<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
    <span class="kw5">local</span>  <span class="kw4">float</span>    rpmDifference;
    <span class="kw5">local</span>  <span class="kw4">float</span>    myRPM;
    rpmDifference = <span class="nu0">0.0</span>;
    myRPM = WheelRPM;
    myRPM *= <span class="nu0">6.28</span>; <span class="co1">// convert to radians per sec</span>
    myRPM /= <span class="nu0">60</span>;
         <span class="kw1">if</span><span class="br0">(</span>EngineRPM == myRPM<span class="br0">)</span>
              bInGear = <span class="kw9">True</span>;
         <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>EngineRPM &gt; myRPM<span class="br0">)</span>
         <span class="br0">{</span>
              <span class="kw1">if</span><span class="br0">(</span>myRPM &lt; <span class="nu0">0</span><span class="br0">)</span>
                    rpmDifference = EngineRPM - <span class="br0">(</span><span class="nu0">2</span> * <span class="kw7">Abs</span><span class="br0">(</span>myRPM<span class="br0">)</span><span class="br0">)</span>;
 
              <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>myRPM &gt;= <span class="nu0">0</span><span class="br0">)</span>
                    rpmDifference = EngineRPM - myRPM;
              <span class="kw1">if</span><span class="br0">(</span>rpmDifference &lt;= <span class="nu0">200.0</span><span class="br0">)</span>
              <span class="br0">{</span>
                   bInGear = <span class="kw9">True</span>;
              <span class="br0">}</span>
              <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>rpmDifference &gt; <span class="nu0">200.0</span><span class="br0">)</span>
              <span class="br0">{</span>
                   bInGear = <span class="kw9">False</span>;
                   rpmDifference = rpmDifference * <span class="nu0">0.2</span>;
                   EngineRPM -= rpmDifference;
                   bRadians = <span class="kw9">True</span>;
              <span class="br0">}</span>
         <span class="br0">}</span>
         <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>EngineRPM &lt; myRPM<span class="br0">)</span>
         <span class="br0">{</span>
              rpmDifference = myRPM - EngineRPM;
              <span class="kw1">if</span><span class="br0">(</span>rpmDifference &lt;= <span class="nu0">200.0</span><span class="br0">)</span>
              <span class="br0">{</span>
                   bInGear = <span class="kw9">True</span>;
              <span class="br0">}</span>
              <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>rpmDifference &gt; <span class="nu0">200.0</span><span class="br0">)</span>
              <span class="br0">{</span>
                   bInGear = <span class="kw9">False</span>;
                   rpmDifference = rpmDifference * <span class="nu0">0.2</span>;
                   EngineRPM -= rpmDifference;
                   bRadians = <span class="kw9">True</span>;
              <span class="br0">}</span>
         <span class="br0">}</span>
<span class="br0">}</span>
</pre></div>
<dl>
<dt>KApplyForce</dt>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw5">function</span> KApplyForce<span class="br0">(</span><span class="kw6">out</span> <span class="kw4">vector</span> Force, <span class="kw6">out</span> <span class="kw4">vector</span> Torque<span class="br0">)</span>
<span class="br0">{</span>
    <span class="kw6">Super</span>.<span class="me1">KApplyForce</span><span class="br0">(</span>Force, Torque<span class="br0">)</span>;
    Force += UDForce;
    Torque += UDTorque;
    <span class="kw1">if</span> <span class="br0">(</span>bBoosting == <span class="kw9">true</span> &amp;&amp; bVehicleOnGround == <span class="kw9">true</span><span class="br0">)</span>
        Force += <span class="kw4">vector</span><span class="br0">(</span>Rotation<span class="br0">)</span> * SpeedBoost;
<span class="br0">}</span>
</pre></div>
<dl>
<dt>KImpact</dt>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw5">event</span> KImpact<span class="br0">(</span><a href="/Actor"><span class="kw10">Actor</span></a> Other, <span class="kw4">vector</span> Pos, <span class="kw4">vector</span> ImpactVel, <span class="kw4">vector</span> ImpactNorm<span class="br0">)</span>
<span class="br0">{</span>
    <span class="kw1">if</span> <span class="br0">(</span><span class="kw8">Role</span> == <span class="kw9">ROLE_Authority</span><span class="br0">)</span>
    <span class="br0">{</span>
 
        ImpactInfo.<span class="me1">Other</span> = Other;
        ImpactInfo.<span class="me1">Pos</span> = Pos;
        ImpactInfo.<span class="me1">ImpactVel</span> = ImpactVel;
        ImpactInfo.<span class="me1">ImpactNorm</span> = ImpactNorm;
        ImpactInfo.<span class="me1">ImpactAccel</span> = KParams.<span class="me1">KAcceleration</span>;
        ImpactTicksLeft = ImpactDamageTicks;
    <span class="br0">}</span>
<span class="br0">}</span>
</pre></div>
<dl>
<dt>DrivingStatusChanged</dt>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw5">event</span> DrivingStatusChanged<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
        <span class="kw5">local</span> <span class="kw4">int</span> i;
        <span class="kw6">Super</span>.<span class="me1">DrivingStatusChanged</span><span class="br0">(</span><span class="br0">)</span>;
    <span class="kw1">if</span> <span class="br0">(</span>bDriving &amp;&amp; <span class="kw8">Level</span>.<span class="kw8">NetMode</span> != <span class="kw9">NM_DedicatedServer</span> &amp;&amp; !bDropDetail<span class="br0">)</span>
        <span class="br0">{</span>
        Dust.<span class="kw6">length</span> = Wheels.<span class="kw6">length</span>;
        <span class="kw1">for</span><span class="br0">(</span>i=<span class="nu0">0</span>; i&lt;Wheels.<span class="kw6">Length</span>; i++<span class="br0">)</span>
            <span class="kw1">if</span> <span class="br0">(</span>Dust<span class="br0">[</span>i<span class="br0">]</span> == <span class="kw9">None</span><span class="br0">)</span>
            <span class="br0">{</span>
                        <span class="co1">// Create wheel dust emitters.</span>
                        WheelCoords = GetBoneCoords<span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">BoneName</span><span class="br0">)</span>;
                        Dust<span class="br0">[</span>i<span class="br0">]</span> = spawn<span class="br0">(</span><span class="kw5">class</span><span class="st0">'ONSDirtSlipEffect'</span>, <span class="kw8">self</span>,, WheelCoords.<span class="me1">Origin</span> + <span class="br0">(</span><span class="br0">(</span><span class="kw4">vect</span><span class="br0">(</span><span class="nu0">0</span>,<span class="nu0">0</span>,<span class="nu0">-1</span><span class="br0">)</span> * Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">WheelRadius</span><span class="br0">)</span> &gt;&gt; Rotation<span class="br0">)</span><span class="br0">)</span>;
                        Dust<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SetBase</span><span class="br0">(</span><span class="kw8">self</span><span class="br0">)</span>;
                            Dust<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SetDirtColor</span><span class="br0">(</span> <span class="kw8">Level</span>.<span class="me1">DustColor</span> <span class="br0">)</span>;
                <span class="br0">}</span>
                <span class="kw1">if</span><span class="br0">(</span>bMakeBrakeLights<span class="br0">)</span>
                <span class="br0">{</span>
                        <span class="kw1">for</span><span class="br0">(</span>i=<span class="nu0">0</span>; i&lt;<span class="nu0">2</span>; i++<span class="br0">)</span>
                        <span class="kw1">if</span> <span class="br0">(</span>BrakeLight<span class="br0">[</span>i<span class="br0">]</span> == <span class="kw9">None</span><span class="br0">)</span>
                        <span class="br0">{</span>
                                BrakeLight<span class="br0">[</span>i<span class="br0">]</span> = spawn<span class="br0">(</span><span class="kw5">class</span><span class="st0">'ONSBrakelightCorona'</span>, <span class="kw8">self</span>,, Location + <span class="br0">(</span>BrakeLightOffset<span class="br0">[</span>i<span class="br0">]</span> &gt;&gt; Rotation<span class="br0">)</span> <span class="br0">)</span>;
                                BrakeLight<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SetBase</span><span class="br0">(</span><span class="kw8">self</span><span class="br0">)</span>;
                                BrakeLight<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SetRelativeRotation</span><span class="br0">(</span> rot<span class="br0">(</span><span class="nu0">0</span>,<span class="nu0">32768</span>,<span class="nu0">0</span><span class="br0">)</span> <span class="br0">)</span>; <span class="co1">// Point lights backwards.</span>
                                BrakeLight<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">Skins</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> = BrakeLightMaterial;
                        <span class="br0">}</span>
                <span class="br0">}</span>
        <span class="br0">}</span>
    <span class="kw1">else</span>
    <span class="br0">{</span>
        <span class="kw1">if</span> <span class="br0">(</span><span class="kw8">Level</span>.<span class="kw8">NetMode</span> != <span class="kw9">NM_DedicatedServer</span><span class="br0">)</span>
        <span class="br0">{</span>
            <span class="kw1">for</span><span class="br0">(</span>i=<span class="nu0">0</span>; i&lt;Dust.<span class="kw6">Length</span>; i++<span class="br0">)</span>
                Dust<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">Destroy</span><span class="br0">(</span><span class="br0">)</span>;
 
            Dust.<span class="kw6">Length</span> = <span class="nu0">0</span>;
 
            <span class="kw1">if</span><span class="br0">(</span>bMakeBrakeLights<span class="br0">)</span>
            <span class="br0">{</span>
                <span class="kw1">for</span><span class="br0">(</span>i=<span class="nu0">0</span>; i&lt;<span class="nu0">2</span>; i++<span class="br0">)</span>
                    <span class="kw1">if</span> <span class="br0">(</span>BrakeLight<span class="br0">[</span>i<span class="br0">]</span> != <span class="kw9">None</span><span class="br0">)</span>
                        BrakeLight<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">Destroy</span><span class="br0">(</span><span class="br0">)</span>;
            <span class="br0">}</span>
        <span class="br0">}</span>
        TurnDamping = <span class="nu0">0.0</span>;
    <span class="br0">}</span>
<span class="br0">}</span>
</pre></div>
<dl>
<dt>KDriverEnter</dt>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw5">function</span> KDriverEnter<span class="br0">(</span><a href="/Pawn"><span class="kw10">Pawn</span></a> P<span class="br0">)</span>
<span class="br0">{</span>
        <span class="kw6">Super</span>.<span class="me1">KDriverEnter</span><span class="br0">(</span>P<span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
<dl>
<dt>ClientKDriverLeave</dt>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw6">simulated</span> <span class="kw5">function</span> ClientKDriverLeave<span class="br0">(</span>PlayerController PC<span class="br0">)</span>
<span class="br0">{</span>
        <span class="kw6">Super</span>.<span class="me1">ClientKDriverLeave</span><span class="br0">(</span>PC<span class="br0">)</span>;
 
        bWeaponIsAltFiring = <span class="kw9">false</span>;
        PC.<span class="me1">EndZoom</span><span class="br0">(</span><span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
<dl>
<dt>SpecialCalcFirstPersonView</dt>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw6">simulated</span> <span class="kw5">function</span> SpecialCalcFirstPersonView<span class="br0">(</span>PlayerController PC, <span class="kw6">out</span> <a href="/Actor"><span class="kw10">actor</span></a> ViewActor, <span class="kw6">out</span> <span class="kw4">vector</span> CameraLocation, <span class="kw6">out</span> <span class="kw4">rotator</span> CameraRotation <span class="br0">)</span>
<span class="br0">{</span>
        ViewActor = <span class="kw8">self</span>;
        CameraLocation = Location + <span class="br0">(</span>FPCamPos &gt;&gt; Rotation<span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
<dl>
<dt>Fire</dt>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw5">function</span> Fire<span class="br0">(</span><span class="kw6">optional</span> <span class="kw4">float</span> F<span class="br0">)</span>
<span class="br0">{</span>
       VehicleFire<span class="br0">(</span><span class="kw9">False</span><span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
<dl>
<dt>AltFire</dt>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw5">function</span> AltFire<span class="br0">(</span><span class="kw6">optional</span> <span class="kw4">float</span> F<span class="br0">)</span>
<span class="br0">{</span>
 
        VehicleFire<span class="br0">(</span><span class="kw9">true</span><span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
<dl>
<dt>VehicleFire</dt>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw5">function</span> VehicleFire<span class="br0">(</span><span class="kw4">bool</span> bWasAltFire<span class="br0">)</span>
<span class="br0">{</span>
         <span class="kw1">if</span><span class="br0">(</span>!bWasAltFire<span class="br0">)</span>
         <span class="br0">{</span>
                 bGearUp = <span class="nu0">1</span>;
                 ChangeGear<span class="br0">(</span>bGearUp<span class="br0">)</span>;
         <span class="br0">}</span>
 
         <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>bWasAltFire<span class="br0">)</span>
         <span class="br0">{</span>
                 bGearDown = <span class="nu0">-1</span>;
                 ChangeGear<span class="br0">(</span>bGearDown<span class="br0">)</span>;
         <span class="br0">}</span>
<span class="br0">}</span>
</pre></div>
<dl>
<dt>VehicleCeaseFire</dt>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw5">function</span> VehicleCeaseFire<span class="br0">(</span><span class="kw4">bool</span> bWasAltFire<span class="br0">)</span>
<span class="br0">{</span>
         <span class="kw1">if</span><span class="br0">(</span>!bWasAltFire<span class="br0">)</span>
         <span class="br0">{</span>
                 bGearUp = <span class="nu0">0</span>;
                 ChangeGear<span class="br0">(</span>bGearUp<span class="br0">)</span>;
         <span class="br0">}</span>
         <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>bWasAltFire<span class="br0">)</span>
         <span class="br0">{</span>
                 bGearDown = <span class="nu0">0</span>;
                 ChangeGear<span class="br0">(</span>bGearDown<span class="br0">)</span>;
         <span class="br0">}</span>
    <span class="kw6">Super</span>.<span class="me1">VehicleCeaseFire</span><span class="br0">(</span>bWasAltFire<span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
<dl>
<dt>ClientVehicleCeaseFire</dt>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw6">simulated</span> <span class="kw5">function</span> ClientVehicleCeaseFire<span class="br0">(</span><span class="kw4">bool</span> bWasAltFire<span class="br0">)</span>
<span class="br0">{</span>
    <span class="kw6">Super</span>.<span class="me1">ClientVehicleCeaseFire</span><span class="br0">(</span>bWasAltFire<span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
<dl>
<dt>Tick</dt>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw5">function</span> <span class="kw8">Tick</span><span class="br0">(</span><span class="kw4">float</span> DT<span class="br0">)</span>
<span class="br0">{</span>
    <span class="kw5">local</span> <span class="kw4">int</span>               i, x;
    <span class="kw5">local</span> <span class="kw4">bool</span>              lostTraction;
    <span class="kw5">local</span> KarmaParams       KP;
    <span class="kw5">local</span> KRigidBodyState   BodyState;
 
    TheDeltaTime = DT;
    <span class="kw6">Super</span>.<span class="kw8">Tick</span><span class="br0">(</span>DT<span class="br0">)</span>;
 
    VRate = VSize<span class="br0">(</span>Velocity<span class="br0">)</span>;
    KP = KarmaParams<span class="br0">(</span>KParams<span class="br0">)</span>;
    KGetRigidBodyState<span class="br0">(</span>BodyState<span class="br0">)</span>;
 
    SteerBoneAxis = AXIS_Z;
    KWake<span class="br0">(</span><span class="br0">)</span>;
    <span class="kw1">if</span><span class="br0">(</span><span class="kw8">Role</span> == <span class="kw9">ROLE_Authority</span><span class="br0">)</span>
    <span class="br0">{</span>
        <span class="kw1">if</span><span class="br0">(</span>bDriving<span class="br0">)</span>
        <span class="br0">{</span>
            <span class="co1">// Update ForwardVel, CarMPH and bIsInverted on both server and client.</span>
            GetAxes<span class="br0">(</span>Rotation, worldForward, worldRight, worldUp<span class="br0">)</span>;
 
            ForwardVel = Velocity <span class="kw3">dot</span> worldForward;
            CarMPH = <span class="kw7">Abs</span><span class="br0">(</span><span class="br0">(</span>ForwardVel * <span class="nu0">3600.0</span><span class="br0">)</span> / <span class="nu0">140800.0</span><span class="br0">)</span>; <span class="co1">// Convert from units per sec to miles per hour.</span>
 
            bIsInverted = worldUp.<span class="me1">Z</span> &lt; <span class="nu0">0.2</span>;
 
            <span class="co1">// Update engine sound pitch</span>
            EnginePitch = <span class="nu0">255.0</span> * <span class="br0">(</span><span class="br0">(</span>EngineRPM+IdleRPM<span class="br0">)</span>/EngineRPMSoundRange<span class="br0">)</span>;
            EnginePitch = <span class="kw7">Clamp</span><span class="br0">(</span>EnginePitch, <span class="nu0">0.0</span>, <span class="nu0">255.0</span><span class="br0">)</span>;
            SoundPitch = EnginePitch;
 
            SteerBoneAngle = <span class="br0">(</span>ActualSteering/<span class="kw7">InterpCurveEval</span><span class="br0">(</span>MaxSteerAngleCurve, VRate<span class="br0">)</span><span class="br0">)</span> * SteerBoneMaxAngle * <span class="br0">(</span><span class="nu0">65535.0</span>/<span class="nu0">360.0</span><span class="br0">)</span>;
 
            one.<span class="me1">X</span> = <span class="nu0">0</span>;
            one.<span class="me1">Y</span> = <span class="nu0">0</span>;
            one.<span class="me1">Z</span> = SteerBoneAngle;
 
            two.<span class="me1">X</span> = SteerBoneAngle;
            two.<span class="me1">Y</span> = <span class="nu0">0</span>;
            two.<span class="me1">Z</span> = <span class="nu0">0</span>;
 
            three.<span class="me1">X</span> = <span class="nu0">0</span>;
            three.<span class="me1">Y</span> = SteerBoneAngle;
            three.<span class="me1">Z</span> = <span class="nu0">0</span>;
 
 
            <span class="kw1">if</span><span class="br0">(</span>SteerBoneAxis == AXIS_X<span class="br0">)</span>
                 <span class="co1">//SteerRot = Rotator(0, 0, SteerBoneAngle);</span>
                 SteerRot = <span class="kw4">Rotator</span><span class="br0">(</span>one<span class="br0">)</span>;
 
            <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>SteerBoneAxis == AXIS_Y<span class="br0">)</span>
                 <span class="co1">//SteerRot = Rotator(SteerBoneAngle, 0, 0);</span>
                 SteerRot = <span class="kw4">Rotator</span><span class="br0">(</span>two<span class="br0">)</span>;
 
            <span class="kw1">else</span>
                 <span class="co1">//SteerRot = Rotator(0, SteerBoneAngle, 0);</span>
                 SteerRot = <span class="kw4">Rotator</span><span class="br0">(</span>three<span class="br0">)</span>;
 
            SetBoneDirection<span class="br0">(</span>SteerBoneName, SteerRot, WForce, <span class="nu0">1</span>, <span class="nu0">0</span><span class="br0">)</span>;
        <span class="br0">}</span>
    <span class="br0">}</span>
        <span class="co1">// Update any stunt variables.</span>
        <span class="kw1">if</span><span class="br0">(</span>bDoStuntInfo<span class="br0">)</span>
        <span class="br0">{</span>
                ForwardsInOldPlane = <span class="kw4">Coords</span>.<span class="me1">XAxis</span> - <span class="br0">(</span><span class="kw4">Coords</span>.<span class="me1">XAxis</span> <span class="kw3">dot</span> OldCoords.<span class="me1">ZAxis</span><span class="br0">)</span> * OldCoords.<span class="me1">ZAxis</span>;
                <span class="co1">//ForwardsInOldPlane = SafeNormal(ForwardsInOldPlane);</span>
                DeltaHeading = <span class="kw7">Acos</span><span class="br0">(</span> <span class="kw7">Clamp</span><span class="br0">(</span> ForwardsInOldPlane <span class="kw3">dot</span> OldCoords.<span class="me1">XAxis</span>, <span class="nu0">-1.0</span>, <span class="nu0">1.0</span> <span class="br0">)</span> <span class="br0">)</span>;
                <span class="kw1">if</span><span class="br0">(</span> <span class="br0">(</span>ForwardsInOldPlane <span class="kw3">dot</span> OldCoords.<span class="me1">YAxis</span><span class="br0">)</span> &lt; <span class="nu0">0.0</span><span class="br0">)</span>
                        DeltaHeading *= <span class="nu0">-1.0</span>;
                DeltaPitch = <span class="kw7">Asin</span><span class="br0">(</span> <span class="kw7">Clamp</span><span class="br0">(</span><span class="kw4">Coords</span>.<span class="me1">XAxis</span> <span class="kw3">dot</span> OldCoords.<span class="me1">ZAxis</span>, <span class="nu0">-1</span>.0f, <span class="nu0">1.0</span><span class="br0">)</span> <span class="br0">)</span>;
                DeltaRoll = <span class="kw7">Asin</span><span class="br0">(</span> <span class="kw7">Clamp</span><span class="br0">(</span><span class="kw4">Coords</span>.<span class="me1">YAxis</span> <span class="kw3">dot</span> OldCoords.<span class="me1">ZAxis</span>, <span class="nu0">-1</span>.0f, <span class="nu0">1.0</span><span class="br0">)</span> <span class="br0">)</span>;
                <span class="co1">//debugf( TEXT("DR:%f DP:%f"), DeltaRoll, DeltaPitch );</span>
 
                bCurrentOnGround = <span class="br0">(</span>bVehicleOnGround || KP.<span class="me1">bContactingLevel</span><span class="br0">)</span>;
                DaredevilPoints = <span class="nu0">0</span>;
 
                <span class="kw1">if</span><span class="br0">(</span>bCurrentOnGround<span class="br0">)</span>
                <span class="br0">{</span>
                        <span class="kw1">if</span><span class="br0">(</span>!bOldVehicleOnGround<span class="br0">)</span>
                        <span class="br0">{</span>
                                <span class="co1">// We just landed - see if we should display Daredevil 'message'</span>
                                InAirTime = <span class="kw8">Level</span>.<span class="me1">TimeSeconds</span> - LastOnGroundTime;
 
                                Dist1 = Location;
                                Dist2 = LastOnGroundLocation;
                                <span class="kw4">Vect</span>  = Dist1 - Dist2;
                                Dist3 = <span class="kw4">Vect</span>.<span class="me1">X</span> * <span class="kw4">Vect</span>.<span class="me1">X</span> - <span class="kw4">Vect</span>.<span class="me1">Y</span> * <span class="kw4">Vect</span>.<span class="me1">Y</span>;
                                Dist3 = <span class="kw7">Sqrt</span><span class="br0">(</span>Dist3<span class="br0">)</span>;
 
                                DaredevilPoints += <span class="kw7">Max</span><span class="br0">(</span> Ceil<span class="br0">(</span> <span class="kw7">Abs</span><span class="br0">(</span>InAirSpin<span class="br0">)</span>/<span class="br0">(</span><span class="nu0">0.5</span>*DaredevilThreshInAirSpin<span class="br0">)</span> <span class="br0">)</span> - <span class="nu0">1</span>, <span class="nu0">0</span> <span class="br0">)</span>;
                                DaredevilPoints += <span class="kw7">Max</span><span class="br0">(</span> Ceil<span class="br0">(</span> <span class="kw7">Abs</span><span class="br0">(</span>InAirPitch<span class="br0">)</span>/<span class="br0">(</span><span class="nu0">0.5</span>*DaredevilThreshInAirPitch<span class="br0">)</span> <span class="br0">)</span> - <span class="nu0">1</span>, <span class="nu0">0</span> <span class="br0">)</span>;
                                DaredevilPoints += <span class="kw7">Max</span><span class="br0">(</span> Ceil<span class="br0">(</span> <span class="kw7">Abs</span><span class="br0">(</span>InAirRoll<span class="br0">)</span>/<span class="br0">(</span><span class="nu0">0.5</span>*DaredevilThreshInAirRoll<span class="br0">)</span> <span class="br0">)</span> - <span class="nu0">1</span>, <span class="nu0">0</span> <span class="br0">)</span>;
                                DaredevilPoints += <span class="kw7">Max</span><span class="br0">(</span> Ceil<span class="br0">(</span> InAirTime/<span class="br0">(</span><span class="nu0">0.5</span>*DaredevilThreshInAirTime<span class="br0">)</span> <span class="br0">)</span> - <span class="nu0">1</span>, <span class="nu0">0</span> <span class="br0">)</span>;
                                DaredevilPoints += <span class="kw7">Max</span><span class="br0">(</span> Ceil<span class="br0">(</span> InAirDistance/<span class="br0">(</span><span class="nu0">0</span>.5f*DaredevilThreshInAirDistance<span class="br0">)</span> <span class="br0">)</span> - <span class="nu0">1</span>, <span class="nu0">0</span> <span class="br0">)</span>;
                                DaredevilPoints *= <span class="nu0">10</span>;
 
                                <span class="co1">// A wheel must be touching the ground on landing to get a daredevil</span>
                                <span class="kw1">if</span><span class="br0">(</span> bVehicleOnGround &amp;&amp; DaredevilPoints &gt; <span class="nu0">0</span> <span class="br0">)</span>
                                <span class="br0">{</span>
                                        OnDaredevil<span class="br0">(</span><span class="br0">)</span>;
                                <span class="br0">}</span>
                        <span class="br0">}</span>
 
 
                        LastOnGroundLocation = Location;
                        LastOnGroundTime = <span class="kw8">Level</span>.<span class="me1">TimeSeconds</span>;
                        InAirSpin = <span class="nu0">0.0</span>;
                        InAirPitch = <span class="nu0">0.0</span>;
                        InAirRoll = <span class="nu0">0.0</span>;
                <span class="br0">}</span>
                <span class="kw1">else</span>
                <span class="br0">{</span>
                        InAirSpin += <span class="br0">(</span><span class="nu0">180.0</span>/PI<span class="br0">)</span> * DeltaHeading;
                        InAirPitch += <span class="br0">(</span><span class="nu0">180.0</span>/PI<span class="br0">)</span> * DeltaPitch;
                        InAirRoll += <span class="br0">(</span><span class="nu0">180.0</span>/PI<span class="br0">)</span> * DeltaRoll;
                <span class="br0">}</span>
 
                OldRotation = Rotation;
                bOldVehicleOnGround = bCurrentOnGround;
        <span class="br0">}</span>
 
        <span class="kw1">if</span><span class="br0">(</span>!bDriving<span class="br0">)</span>
        <span class="br0">{</span>
                bOldVehicleOnGround = <span class="kw9">true</span>; <span class="co1">// If no-one is in the vehicle, dont consider it for daredevil status.</span>
        <span class="br0">}</span>
 
        <span class="kw1">if</span><span class="br0">(</span>bAllowChargingJump<span class="br0">)</span>
        <span class="br0">{</span>
                <span class="co1">// Check if all wheels are on the ground.</span>
                <span class="kw1">if</span><span class="br0">(</span>bAllWheelsOnGround == <span class="kw9">true</span><span class="br0">)</span>
                <span class="br0">{</span>
                     <span class="kw1">for</span><span class="br0">(</span>x = <span class="nu0">0</span>; x&lt;Wheels.<span class="kw6">Length</span>; x++<span class="br0">)</span>
                     <span class="br0">{</span>
                         <span class="kw1">if</span> <span class="br0">(</span>Wheels<span class="br0">[</span>x<span class="br0">]</span>.<span class="me1">bWheelOnGround</span> != <span class="kw9">false</span><span class="br0">)</span>
                                bAllWheelsOnGround = <span class="kw9">false</span>;
                     <span class="br0">}</span>
                <span class="br0">}</span>
                <span class="kw1">else</span>
                <span class="br0">{</span>
                     <span class="co1">// If any wheels are off the ground - we can just reset everything.</span>
                     <span class="kw1">if</span><span class="br0">(</span>!bVehicleOnGround<span class="br0">)</span>
                     <span class="br0">{</span>
                          JumpForce = <span class="nu0">0.0</span>;
                          JumpSpin = <span class="nu0">0.0</span>;
<span class="co1">//                          bPushDown = false;</span>
                     <span class="br0">}</span>
 
                <span class="br0">}</span>
        <span class="br0">}</span>
      <span class="co1">//Engine(Throttle);</span>
     <span class="co1">// If on the server - we work out OutputGas, OutputBrake etc, and pack them to be sent to the client.</span>
     <span class="kw1">if</span><span class="br0">(</span>!bClutching<span class="br0">)</span>
           Gas2 = <span class="kw7">InterpCurveEval</span><span class="br0">(</span>RPMtoGas, EngineRPM<span class="br0">)</span>;
     ProcessCarInput<span class="br0">(</span><span class="br0">)</span>;
     PackState<span class="br0">(</span><span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
<dl>
<dt>ProcessCarInput</dt>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw5">function</span> ProcessCarInput<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
        <span class="kw5">local</span> <span class="kw4">bool</span>     bReverse;
 
        bReverse = <span class="kw9">false</span>;
        <span class="kw1">if</span><span class="br0">(</span>Driver == <span class="kw9">none</span><span class="br0">)</span>
        <span class="br0">{</span>
                OutputBrake = <span class="nu0">1.0</span>;
                OutputGas = <span class="nu0">0.0</span>;
        <span class="br0">}</span>
        <span class="kw1">else</span>
        <span class="br0">{</span>
                <span class="kw1">if</span><span class="br0">(</span>Throttle &gt;= <span class="nu0">0</span><span class="br0">)</span> <span class="co1">// pressing forwards</span>
                <span class="br0">{</span>
                        OutputGas = <span class="kw7">Abs</span><span class="br0">(</span>Throttle<span class="br0">)</span>;
                        OutputBrake = <span class="nu0">0.0</span>;
                        <span class="kw1">if</span><span class="br0">(</span>bClutching<span class="br0">)</span>
                        <span class="br0">{</span>
                             <span class="kw1">if</span><span class="br0">(</span>Throttle == <span class="nu0">0</span><span class="br0">)</span>
                             <span class="br0">{</span>
                                  <span class="kw1">if</span><span class="br0">(</span>Gas2&lt;=<span class="nu0">21</span> &amp;&amp; Gas2&gt;=<span class="nu0">0</span><span class="br0">)</span>
                                  <span class="br0">{</span>
                                        Gas2 -= <span class="nu0">0.5</span>;
                                  <span class="br0">}</span>
                                  <span class="kw1">if</span><span class="br0">(</span>Gas2&lt;<span class="nu0">0</span><span class="br0">)</span>
                                        Gas2 = <span class="nu0">0</span>;
                             <span class="br0">}</span>
                             <span class="kw1">else</span>
                             <span class="br0">{</span>
                                  <span class="kw1">if</span><span class="br0">(</span>Gas2&lt;=<span class="nu0">21</span> &amp;&amp; Gas2&gt;=<span class="nu0">0</span><span class="br0">)</span>
                                  <span class="br0">{</span>
                                         Gas2 += <span class="nu0">0.5</span>;
                                  <span class="br0">}</span>
                                  <span class="kw1">if</span><span class="br0">(</span>Gas2&gt;<span class="nu0">21</span><span class="br0">)</span>
                                         Gas2 = <span class="nu0">21</span>;
                             <span class="br0">}</span>
                             <span class="kw1">if</span><span class="br0">(</span>Gas2 &gt;=<span class="nu0">21</span><span class="br0">)</span>
                                  Gas2 = <span class="nu0">21</span>;
                         <span class="br0">}</span>
                         <span class="kw1">if</span><span class="br0">(</span>!bClutching<span class="br0">)</span>
 
                 <span class="br0">}</span>
 
       StoptheCar<span class="br0">(</span><span class="br0">)</span>;
       OutputBrake = <span class="kw7">Abs</span><span class="br0">(</span><span class="kw7">InterpCurveEval</span><span class="br0">(</span>BrakeCurve, hBrake<span class="br0">)</span><span class="br0">)</span>;
 
        OutputPitch = Rise;
        <span class="br0">}</span>
        Engine<span class="br0">(</span><span class="br0">)</span>;
        KWake<span class="br0">(</span><span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
<dl>
<dt>Clutch</dt>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw6">exec</span> <span class="kw5">function</span> Clutch<span class="br0">(</span><span class="kw4">bool</span> bEnabled<span class="br0">)</span>
<span class="br0">{</span>
       <span class="kw1">if</span><span class="br0">(</span>!bEnabled<span class="br0">)</span>
       <span class="br0">{</span>
           bClutching = <span class="kw9">False</span>;
           bInGear = <span class="kw9">False</span>;
       <span class="br0">}</span>
 
       <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>bEnabled<span class="br0">)</span>
       <span class="br0">{</span>
           bClutching = <span class="kw9">True</span>;
 
           RPM = EngineRPM;
       <span class="br0">}</span>
<span class="br0">}</span>
</pre></div>
<dl>
<dt>Brake</dt>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw6">exec</span> <span class="kw5">function</span> Brake<span class="br0">(</span><span class="kw4">bool</span> bEnabled<span class="br0">)</span>
<span class="br0">{</span>
      <span class="kw1">if</span><span class="br0">(</span>bEnabled<span class="br0">)</span>
      <span class="br0">{</span>
           bBraking = <span class="kw9">True</span>;
           OutputHandbrake = <span class="kw9">true</span>;
      <span class="br0">}</span>
      <span class="kw1">if</span><span class="br0">(</span>!bEnabled<span class="br0">)</span>
      <span class="br0">{</span>
           bBraking = <span class="kw9">false</span>;
           OutputHandbrake = <span class="kw9">false</span>;
      <span class="br0">}</span>
<span class="br0">}</span>
</pre></div>
<dl>
<dt>ChangeGear</dt>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw5">function</span> ChangeGear<span class="br0">(</span><span class="kw4">int</span> GearChoice<span class="br0">)</span>
<span class="br0">{</span>
      <span class="kw1">if</span><span class="br0">(</span>bClutching<span class="br0">)</span><span class="br0">{</span>
        <span class="kw1">if</span><span class="br0">(</span>Gear &gt;= <span class="nu0">1</span> &amp;&amp; Gear &lt;= <span class="nu0">7</span><span class="br0">)</span>
        <span class="br0">{</span>
             <span class="kw1">if</span><span class="br0">(</span>GearChoice == <span class="nu0">1</span><span class="br0">)</span>
             <span class="br0">{</span>
                  Gear++;
                  bGearUp = <span class="nu0">0</span>;
             <span class="br0">}</span>
             <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>GearChoice == <span class="nu0">-1</span><span class="br0">)</span>
             <span class="br0">{</span>
                  Gear--;
                  bGearDown = <span class="nu0">0</span>;
             <span class="br0">}</span>
             <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>GearChoice == <span class="nu0">0</span><span class="br0">)</span>
             <span class="br0">{</span>
 
             <span class="br0">}</span>
        <span class="br0">}</span>
        <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>Gear == <span class="nu0">0</span> &amp;&amp; GearChoice == <span class="nu0">1</span><span class="br0">)</span>
        <span class="br0">{</span>
              Gear++;
              bGearUp = <span class="nu0">0</span>;
        <span class="br0">}</span>
        <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>Gear == <span class="nu0">8</span> &amp;&amp; GearChoice == <span class="nu0">-1</span><span class="br0">)</span>
        <span class="br0">{</span>
              Gear--;
              bGearDown = <span class="nu0">0</span>;
        <span class="br0">}</span>
        <span class="kw1">else</span>
        <span class="br0">{</span>
             bGearUp = <span class="nu0">0</span>;
             bGearDown = <span class="nu0">0</span>;
        <span class="br0">}</span>
      <span class="br0">}</span>
<span class="br0">}</span>
</pre></div>
<dl>
<dt>PackState</dt>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw5">function</span> PackState<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
        <span class="kw5">local</span> KRigidBodyState   RBState;
        <span class="kw5">local</span> <span class="kw4">rotator</span>           ViewRot;
        <span class="kw1">if</span><span class="br0">(</span>!KIsAwake<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>
                <span class="kw1">return</span>;
        KGetRigidBodyState<span class="br0">(</span>RBState<span class="br0">)</span>;
        CActiveWeapon=SActiveWeapon;
        CarState.<span class="me1">ChassisPosition</span>.<span class="me1">X</span> = RBState.<span class="me1">Position</span>.<span class="me1">X</span>;
        CarState.<span class="me1">ChassisPosition</span>.<span class="me1">Y</span> = RBState.<span class="me1">Position</span>.<span class="me1">Y</span>;
        CarState.<span class="me1">ChassisPosition</span>.<span class="me1">Z</span> = RBState.<span class="me1">Position</span>.<span class="me1">Z</span>;
        CarState.<span class="me1">ChassisQuaternion</span> = RBState.<span class="kw4">Quaternion</span>;
        CarState.<span class="me1">ChassisLinVel</span>.<span class="me1">X</span> = <span class="nu0">10.0</span> * RBState.<span class="me1">LinVel</span>.<span class="me1">X</span>;
        CarState.<span class="me1">ChassisLinVel</span>.<span class="me1">Y</span> = <span class="nu0">10.0</span> * RBState.<span class="me1">LinVel</span>.<span class="me1">Y</span>;
        CarState.<span class="me1">ChassisLinVel</span>.<span class="me1">Z</span> = <span class="nu0">10.0</span> * RBState.<span class="me1">LinVel</span>.<span class="me1">Z</span>;
        CarState.<span class="me1">ChassisAngVel</span>.<span class="me1">X</span> = <span class="nu0">1000.0</span> * RBState.<span class="me1">AngVel</span>.<span class="me1">X</span>;
        CarState.<span class="me1">ChassisAngVel</span>.<span class="me1">Y</span> = <span class="nu0">1000.0</span> * RBState.<span class="me1">AngVel</span>.<span class="me1">Y</span>;
        CarState.<span class="me1">ChassisAngVel</span>.<span class="me1">Z</span> = <span class="nu0">1000.0</span> * RBState.<span class="me1">AngVel</span>.<span class="me1">Z</span>;
        CarState.<span class="me1">ServerHandbrake</span> = FloatToRangeByte<span class="br0">(</span>OutputPitch<span class="br0">)</span>;
        CarState.<span class="me1">ServerBrake</span> = FloatToRangeByte<span class="br0">(</span>OutputBrake<span class="br0">)</span>;
        CarState.<span class="me1">ServerGas</span> = FloatToRangeByte<span class="br0">(</span>OutputGas<span class="br0">)</span>;
        CarState.<span class="me1">ServerGear</span> = Gear;
        CarState.<span class="me1">ServerSteering</span> = FloatToRangeByte<span class="br0">(</span>Steering<span class="br0">)</span>;
        <span class="kw1">if</span><span class="br0">(</span>Controller != <span class="kw9">None</span><span class="br0">)</span>
        <span class="br0">{</span>
                <span class="kw1">if</span><span class="br0">(</span>IsHumanControlled<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>
                <span class="br0">{</span>
                        DriverViewPitch = Controller.<span class="me1">Rotation</span>.<span class="me1">Pitch</span>;
                        DriverViewYaw = Controller.<span class="me1">Rotation</span>.<span class="me1">Yaw</span>;
                <span class="br0">}</span>
                <span class="kw1">else</span>
                <span class="br0">{</span>
                        ViewRot = <span class="kw4">rotator</span><span class="br0">(</span>Controller.<span class="me1">FocalPoint</span> - Location<span class="br0">)</span>;
                        DriverViewPitch = ViewRot.<span class="me1">Pitch</span>;
                        DriverViewYaw = ViewRot.<span class="me1">Yaw</span>;
                <span class="br0">}</span>
        <span class="br0">}</span>
        <span class="kw1">else</span>
        <span class="br0">{</span>
                DriverViewPitch = Rotation.<span class="me1">Pitch</span>;
                DriverViewYaw = Rotation.<span class="me1">Yaw</span>;
        <span class="br0">}</span>
        CarState.<span class="me1">ServerViewPitch</span> = DriverViewPitch;
        CarState.<span class="me1">ServerViewYaw</span> = DriverViewYaw;
        FudgeByte++;
<span class="br0">}</span>
</pre></div>
<dl>
<dt>Motion Blur (still in the works)</dt>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw5">function</span> addblur<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
      <span class="kw5">local</span> PlayerController PC;
 
      PC = PlayerController<span class="br0">(</span>Controller<span class="br0">)</span>;
 
      PC.<span class="me1">AddCameraEffect</span><span class="br0">(</span><span class="kw6">new</span> myBlur<span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
<dl>
<dt>LimitPitch</dt>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw5">function</span> <span class="kw4">int</span> LimitPitch<span class="br0">(</span><span class="kw4">int</span> pitch<span class="br0">)</span>
<span class="br0">{</span>
        <span class="kw1">if</span> <span class="br0">(</span>bAllowAirControl &amp;&amp; !bVehicleOnGround<span class="br0">)</span>
                <span class="kw1">return</span> pitch;
        <span class="kw1">return</span> <span class="kw6">Super</span>.<span class="me1">LimitPitch</span><span class="br0">(</span>pitch<span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
<dl>
<dt>Destroyed</dt>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw6">simulated</span> <span class="kw5">function</span> Destroyed<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
    <span class="kw1">if</span> <span class="br0">(</span>LeftTrail != <span class="kw9">None</span><span class="br0">)</span>
        LeftTrail.<span class="me1">Destroy</span><span class="br0">(</span><span class="br0">)</span>;
 
    <span class="kw1">if</span> <span class="br0">(</span>RightTrail != <span class="kw9">None</span><span class="br0">)</span>
        RightTrail.<span class="me1">Destroy</span><span class="br0">(</span><span class="br0">)</span>;
 
    <span class="kw6">Super</span>.<span class="me1">Destroyed</span><span class="br0">(</span><span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
<dl>
<dt>TakeImpactDamage</dt>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw5">event</span> TakeImpactDamage<span class="br0">(</span><span class="kw4">float</span> AccelMag<span class="br0">)</span>
<span class="br0">{</span>
    <span class="kw5">local</span> <span class="kw4">int</span> Damage;
        Damage = <span class="kw4">int</span><span class="br0">(</span>VSize<span class="br0">(</span>ImpactInfo.<span class="me1">Other</span>.<span class="me1">Velocity</span><span class="br0">)</span> * <span class="nu0">20</span> * ImpactDamageModifier<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>;
    <span class="kw1">if</span> <span class="br0">(</span>Vehicle<span class="br0">(</span>ImpactInfo.<span class="me1">Other</span><span class="br0">)</span> != <span class="kw9">None</span><span class="br0">)</span>
        TakeDamage<span class="br0">(</span>Damage, Vehicle<span class="br0">(</span>ImpactInfo.<span class="me1">Other</span><span class="br0">)</span>, ImpactInfo.<span class="me1">Pos</span>, <span class="kw4">vect</span><span class="br0">(</span><span class="nu0">0</span>,<span class="nu0">0</span>,<span class="nu0">0</span><span class="br0">)</span>, <span class="kw5">class</span><span class="st0">'DamType'</span><span class="br0">)</span>;
    <span class="kw1">else</span>
        TakeDamage<span class="br0">(</span><span class="kw4">int</span><span class="br0">(</span>AccelMag * ImpactDamageModifier<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>/ WallCollisionResistance , <span class="kw8">Self</span>, ImpactInfo.<span class="me1">Pos</span>, <span class="kw4">vect</span><span class="br0">(</span><span class="nu0">0</span>,<span class="nu0">0</span>,<span class="nu0">0</span><span class="br0">)</span>, <span class="kw5">class</span><span class="st0">'DamType'</span><span class="br0">)</span>;
 
    <span class="co1">//FIXME - scale sound volume to damage amount</span>
    <span class="kw1">if</span> <span class="br0">(</span>ImpactDamageSounds.<span class="kw6">Length</span> &gt; <span class="nu0">0</span><span class="br0">)</span>        PlaySound<span class="br0">(</span>ImpactDamageSounds<span class="br0">[</span><span class="kw7">Rand</span><span class="br0">(</span>ImpactDamageSounds.<span class="me1">Length</span><span class="nu0">-1</span><span class="br0">)</span><span class="br0">]</span>,,TransientSoundVolume*<span class="nu0">2.5</span><span class="br0">)</span>;
    <span class="kw1">if</span> <span class="br0">(</span>Health &lt; <span class="nu0">0</span> &amp;&amp; <span class="br0">(</span><span class="kw8">Level</span>.<span class="me1">TimeSeconds</span> - LastImpactExplosionTime<span class="br0">)</span> &gt; TimeBetweenImpactExplosions<span class="br0">)</span>
    <span class="br0">{</span>
        VehicleExplosion<span class="br0">(</span>Normal<span class="br0">(</span>ImpactInfo.<span class="me1">ImpactNorm</span><span class="br0">)</span>, <span class="nu0">0.5</span><span class="br0">)</span>;
        LastImpactExplosionTime = <span class="kw8">Level</span>.<span class="me1">TimeSeconds</span>;
    <span class="br0">}</span>
<span class="br0">}</span>
</pre></div>
<dl>
<dt>Died</dt>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw5">function</span> Died<span class="br0">(</span>Controller Killer, class&lt;DamageType&gt; <a href="/DamageType"><span class="kw10">damageType</span></a>, <span class="kw4">vector</span> HitLocation<span class="br0">)</span>
<span class="br0">{</span>
    <span class="kw1">if</span> <span class="br0">(</span><a href="/DamageType"><span class="kw10">damageType</span></a> == <span class="kw9">none</span><span class="br0">)</span>
       <span class="kw1">return</span>;
    <span class="kw1">if</span> <span class="br0">(</span>Killer != <span class="kw9">None</span><span class="br0">)</span>        PlayerController<span class="br0">(</span>Killer<span class="br0">)</span>.<span class="me1">ReceiveLocalizedMessage</span><span class="br0">(</span><span class="kw5">class</span><span class="st0">'VehicleKillMessage'</span>, <span class="nu0">7</span><span class="br0">)</span>;
    <span class="kw6">Super</span>.<span class="me1">Died</span><span class="br0">(</span>Killer, <a href="/DamageType"><span class="kw10">damageType</span></a>, HitLocation<span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
<dl>
<dt>FloatToRangeByte</dt>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw6">simulated</span> <span class="kw5">function</span> <span class="kw4">byte</span> FloatToRangeByte<span class="br0">(</span><span class="kw4">float</span> f<span class="br0">)</span>
<span class="br0">{</span>
        f= <span class="kw7">FClamp</span><span class="br0">(</span>f, <span class="nu0">0</span>, <span class="nu0">1</span><span class="br0">)</span>;
        f = <span class="kw7">Round</span><span class="br0">(</span>f * <span class="nu0">255</span><span class="br0">)</span>;
        <span class="kw1">return</span> <span class="kw4">byte</span><span class="br0">(</span>f<span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
<dl>
<dt>RangeByteToFloat</dt>
</dl>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="co1">//The opposite of the above function.</span>
<span class="kw6">simulated</span> <span class="kw5">function</span> <span class="kw4">float</span> RangeByteToFloat<span class="br0">(</span><span class="kw4">byte</span> b<span class="br0">)</span>
<span class="br0">{</span>
        <span class="kw5">local</span> <span class="kw4">float</span> f;
        f = b;
        f /= <span class="nu0">255</span>;
        <span class="kw1">return</span> f;
<span class="br0">}</span>
</pre></div>
<p><a name="Defaults" id="Defaults"></a></p>
<h4><span class="mw-headline">Defaults</span></h4>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw1">defaultproperties</span>
<span class="br0">{</span>
     myBlur=<span class="kw5">Class</span><span class="st0">'WhatEverPackage.myMotionBlur'</span>
 
     NumForwardGears=<span class="nu0">7</span>
 
     DustSlipRate=<span class="nu0">2.800000</span>
     DustSlipThresh=<span class="nu0">50.000000</span>
     DaredevilThreshInAirSpin=<span class="nu0">100.000000</span>
     DaredevilThreshInAirPitch=<span class="nu0">300.000000</span>
     DaredevilThreshInAirRoll=<span class="nu0">300.000000</span>
     DaredevilThreshInAirTime=<span class="nu0">1.500000</span>
     DaredevilThreshInAirDistance=<span class="nu0">17.000000</span>
     DaredevilMessageClass=<span class="kw5">Class</span><span class="st0">'Onslaught.ONSDaredevilMessage'</span>
     bOldVehicleOnGround=<span class="kw9">True</span>
     MaxJumpSpin=<span class="nu0">30000.000000</span>
     JumpChargeTime=<span class="nu0">1.000000</span>
     JumpFeedbackForce=<span class="st0">"HoverBikeJump"</span>
     JumpSound=<a href="/sound"><span class="kw10">Sound</span></a><span class="st0">'ONSVehicleSounds-S.Hydraulics.Hydraulic10'</span>
     JumpMeterOriginX=<span class="nu0">0.275000</span>
     JumpMeterOriginY=<span class="nu0">0.943000</span>
     JumpMeterWidth=<span class="nu0">0.136000</span>
     JumpMeterHeight=<span class="nu0">0.057000</span>
     JumpMeterSpacing=<span class="nu0">0.010000</span>
     JumpMeterColor=<span class="br0">(</span>R=<span class="nu0">215</span>,A=<span class="nu0">255</span><span class="br0">)</span>
     SpinMeterColor=<span class="br0">(</span>B=<span class="nu0">215</span>,G=<span class="nu0">100</span>,A=<span class="nu0">255</span><span class="br0">)</span>
     JumpMeterTexture=<a href="/Texture"><span class="kw10">Texture</span></a><span class="st0">'Engine.WhiteTexture'</span>
     MinAirControlDamping=<span class="nu0">0.100000</span>
     bBrakeFrontWheelsOnly=<span class="kw9">False</span>
     ChangeUpPoint=<span class="nu0">2800</span>
     StopThreshold=<span class="nu0">0.2</span>
     CrosshairHitFeedbackTex=<a href="/Texture"><span class="kw10">Texture</span></a><span class="st0">'ONSInterface-TX.tankBarrelAligned'</span>
     DefaultCrosshair=<a href="/Material"><span class="kw10">Material</span></a><span class="st0">'InterfaceContent.Hud.fbBombFocus'</span>
     CrosshairScale=<span class="nu0">0.125</span>
     bTeamLocked=<span class="kw9">false</span>
     bGearUp=<span class="kw9">True</span>
     bInGear=<span class="kw9">True</span>
     bEjectPassengersWhenFlipped=<span class="kw9">False</span>
     bCanFlip=<span class="kw9">true</span>
     DisintegrationHealth=<span class="nu0">0.0</span>
     bShowChargingBar = <span class="kw9">false</span>;
     <span class="co1">// Damages</span>
     WallCollisionResistance = <span class="nu0">5</span> <span class="co1">// Collision resistance: the bigger it is, the less damage taken</span>
     ExplosionDamage=<span class="nu0">0.0</span>
     DriverDamageMult=<span class="nu0">0</span>
     CenterSpringRangePitch=<span class="nu0">5000</span>
     CenterSpringRangeRoll=<span class="nu0">5000</span>
     StolenAnnouncement=<span class="st0">"Play"</span>
 
     bNetNotify=<span class="kw9">true</span>
<span class="br0">}</span>
</pre></div>
<ul>
<li>Global variables that would need to be added to the above uscript:</li>
</ul>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw4">enum</span> ETextAnchor
<span class="br0">{</span>
    TA_Left,
    TA_Right,
    TA_Middle
<span class="br0">}</span>;
<span class="kw5">var</span>   <span class="kw4">float</span>                         ScaleX, ScaleY;
</pre></div>
<p><b>CIpen:</b> Here is some simple code you can add to print data on the screen to avoid logging 24/7. This is what I used to check numbers such as RPM, Gas, EngineRPM, and whatever else I could fit on 1024x768 resolution. I've found it to be most handy. I'm sure you can find this elsewhere but I'm saving you the effort of looking.</p>
<ul>
<li>And here is the DrawHUD function that we must have to draw on the screen when a player has possesion of the vehicle:</li>
</ul>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw6">simulated</span> <span class="kw5">function</span> DrawHUD<span class="br0">(</span>Canvas C<span class="br0">)</span>
<span class="br0">{</span>
    <span class="kw5">local</span> PlayerController PC;
 
 
    PC = PlayerController<span class="br0">(</span>Controller<span class="br0">)</span>;
 
    ScaleX = C.<span class="me1">ClipX</span>/<span class="nu0">1024</span>;
    ScaleY = C.<span class="me1">ClipY</span>/<span class="nu0">768</span>;
 
    C.<span class="me1">Style</span> = ERenderStyle.<span class="me1">STY_Additive</span>;
    C.<span class="me1">Font</span> = PC.<span class="me1">MyHUD</span>.<span class="me1">GetFontSizeIndex</span><span class="br0">(</span>C, <span class="nu0">-2</span><span class="br0">)</span>;
    C.<span class="me1">DrawColor</span> = C.<span class="me1">MakeColor</span><span class="br0">(</span><span class="nu0">255</span>,<span class="nu0">255</span>,<span class="nu0">255</span><span class="br0">)</span>;
 
    DrawEngineStuff<span class="br0">(</span>C<span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
<ul>
<li>Here is the DrawEngineStuff(C) which is isn't a required function but is there to organize:</li>
</ul>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw6">simulated</span> <span class="kw5">function</span> DrawEngineStuff<span class="br0">(</span>Canvas C<span class="br0">)</span>
<span class="br0">{</span>
    C.<span class="me1">Font</span> = C.<span class="me1">TinyFont</span>;
 
    C.<span class="me1">SetPos</span><span class="br0">(</span><span class="nu0">40</span>*ScaleX, <span class="nu0">150</span>*ScaleY<span class="br0">)</span>;
    C.<span class="me1">DrawText</span><span class="br0">(</span><span class="st0">"Engine stuff"</span><span class="br0">)</span>;
 
    C.<span class="me1">SetPos</span><span class="br0">(</span><span class="nu0">40</span>*ScaleX, <span class="nu0">160</span>*ScaleY<span class="br0">)</span>;
    C.<span class="me1">DrawText</span><span class="br0">(</span><span class="st0">"Engine RPM: "</span> @ EngineRPM<span class="br0">)</span>;
<span class="br0">}</span>
</pre></div>
<p>40*ScaleX sets the vertical starting position, and 150*ScaleY sets the horizontal starting position.</p>
<p><a name="Notes" id="Notes"></a></p>
<h4><span class="mw-headline">Notes</span></h4>
<p>If you are to subclass, you need to know that the engine rpm is in radians per min. This means that if you were to create a torque curve and wanted the rpm range to be from 500 to 7000, you would need to convert all the points from revolutions per min to radians per sec. Take the rpm(real life engine rpm) of 7000, divide by 60, then multiply by 2 PI. Like so:</p>
<p>(7000/60)*6.2831853</p>
<p>this yields 733.038285 as the correct rpm</p>
<p>bNetNotify=true is prolly the most critical thing needed for this class to work online/lan</p>
<p>I've got a lot of changes that need to be made to this class, so be patient. Additions include, properly calculating wheel torque if the wheel is powered or not, better collisions with walls(currently if you hit a wall flat at 300 mph the vehicle just stops and takes no damage), available auto transmision, ...</p>
<p><a name="Related_Topics" id="Related_Topics"></a></p>
<h2><span class="mw-headline">Related Topics</span></h2>
<ul>
<li><a href="../../../../articles/v/e/h/Legacy%7EVehicles_acc3.html" title="Legacy:Vehicles">Vehicles</a> – Main topics for Vehicles.</li>
<li><a href="../../../../articles/v/e/h/Legacy%7EVehicle_6bd9.html" title="Legacy:Vehicle">Vehicle</a> – Parent class for all vehicles and turrets.
<ul>
<li><a href="../../../../articles/s/v/e/Legacy%7ESVehicle_1039.html" title="Legacy:SVehicle">SVehicle</a>
<ul>
<li><a href="../../../../articles/o/n/s/Legacy%7EONSVehicle_101f.html" title="Legacy:ONSVehicle">ONSVehicle</a>
<ul>
<li><a href="../../../../articles/o/n/s/Legacy%7EONSWheeledCraft_3fd0.html" title="Legacy:ONSWheeledCraft">ONSWheeledCraft</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="../../../../articles/m/a/k/Legacy%7EMaking_Mods_187d.html" title="Legacy:Making Mods">Making Mods</a></li>
</ul>
<p><a name="Discussion" id="Discussion"></a></p>
<h2><span class="mw-headline">Discussion</span></h2>
<p><b>Graphik:</b> Very nice idea, but a bit unsuited for an FPS, more for a racing game like UnWheel. It seems to me that Epic made sure that the vehicles were as "dumbed down" as possible to keep the focus on fragging people with a vehicle rather than the minutia of driving one. I recommend sending this in to <a href="http://unwheel.beyondunreal.com/" class="external text" title="http://unwheel.beyondunreal.com/" rel="nofollow">UnWheel</a> when you're done. If they don't actually use it I'm sure they'd at the very least find it interesting.</p>
<p><b>CIpen:</b> Accually I got a thumbs up on that at the same time I created this page. The bounds of this script is almost limitless, as it would be easy to have say the tire blow out when shot. As soon as I get a free day I'll update this page with all the new additions (infact that might be something good to do tonight). The big change is that I added the option for auto or stick control and the the power is ditributed over the wheels that are powered.</p>
<p><b>Foxpaw:</b> Why do you divide by 60 when converting rotations per minute to radians per minute? The radians per minute should be greater than the roatations per minute, as there's more than one radian per rotation. Or is that supposed to say, radians per second?</p>
<p><b>CIpen:</b> Yes, you pointed out a typo&#160;:D. Yes, it should say radians per second. Yet your own message has typos, it's not rotations per minute, but revolutions per minute.&#160;:)</p>
<p><b>Foxpaw:</b> Err, ehm, well, I guess that depends on where you measure it from. I'd measure it from the flywheel which definately rotates. I suppose some parts of the crankshaft do revolve though, so either could be correct.</p>
<hr />
<p><b>Zxanphorian:</b> WOW, that is a lot of scriptage there! I have an idea, to make it randomly stall&#160;:B</p>
<hr />
<p><b>CIpen:</b> Ya, there are a lot of cool possibilities with this class. You could attach a model to the wheel bone, add another bone for disk brakes (to attach a disk brake mesh to that turns when the wheels turn), make the engine blow up if you downgear and the engine rpm goes to high, have an axle break, have more wheel slip functions for different traction of different surfaces... any number of things....</p>
<p><b>OlympusMons:</b> I would have to agree CIpen. Has anyone given any thought to making a proper automatic car you know the manual automatic ones.&#160;:S Like what mafia did. I havent really had time to look through all this code although I'd like to, I was just wondering if all of this is actually needed to make a manual shift car or if there are other features which have been added through all of this script. Actually another cool thing to do would be to make a proper 4wd manual shift. Hmm!</p>
<p><b>CIpen:</b> Good! Lets get to the meat! The first thing you need to know is that the function UpdateVehicle() is somehow tied to native code. To see this all you need to do is log the DeltaTime from inside the Tick() function and from inside UpdateVehicle() function. You should see that UpdateVehicle() always has the same DeltaTime so matter what your FPS is (at least this is what I remember it being when I tested it).</p>
<p>The next serious thing is that, unless you do your own wheel calculations, you'll have to build around the SVehicleWheel variables that are calculated each frame. It's both good and bad I guess. Take a minute to thing about this: below is the line that calculates the GripTorque.</p>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
GripTorque = FTScale * Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">WheelRadius</span> * Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">TireLoad</span> * WheelLongFrictionScale<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> * <span class="kw7">InterpCurveEval</span><span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">LongFrictionFunc</span>, <span class="kw7">Abs</span><span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SlipVel</span><span class="br0">)</span><span class="br0">)</span>;
</pre></div>
<p>Now, lets say we want to be the biggest uscript hot shot around, you might change this line to look like this:</p>
<div dir="ltr" style="text-align: left;" class="highlighted-source">
<pre class="source-uscript">
<span class="kw1">if</span><span class="br0">(</span>bPlayerIsOnHood<span class="br0">)</span>
     GripTorque = FTScale * Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">WheelRadius</span> * <span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">TireLoad</span> + PlayerMass<span class="br0">)</span> * WheelLongFrictionScale<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> * <span class="kw7">InterpCurveEval</span><span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">LongFrictionFunc</span>, <span class="kw7">Abs</span><span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SlipVel</span><span class="br0">)</span><span class="br0">)</span>;
<span class="kw1">else</span>
     GripTorque = FTScale * Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">WheelRadius</span> * Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">TireLoad</span> * WheelLongFrictionScale<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> * <span class="kw7">InterpCurveEval</span><span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">LongFrictionFunc</span>, <span class="kw7">Abs</span><span class="br0">(</span>Wheels<span class="br0">[</span>i<span class="br0">]</span>.<span class="me1">SlipVel</span><span class="br0">)</span><span class="br0">)</span>;
</pre></div>
<p>Thus simulating player weight on the car(more or less). That is after you do some stuff to get if the player is on the vehicle or not.</p>
<p>btw I just updated it UpdateVehicle() because it was far behind.</p>
<p><b>Tarquin:</b> I moved this back to its original name, as the class name didn't seem very descriptive.</p>
<p><b>WinterHummer:</b> Can someong give me a good scorpion subclass of this for me and other lazy people?</p>

<!-- 
NewPP limit report
Preprocessor node count: 144/1000000
Post-expand include size: 16/2097152 bytes
Template argument size: 0/2097152 bytes
#ifexist count: 0/100
-->
<div class="printfooter">
</div>
	    <div id="catlinks"><p class='catlinks'><a href="../../../../articles/c/a/t/Special%7ECategories_101d.html" title="Special:Categories">Category</a>: <span dir='ltr'><a href="../../../../articles/l/e/g/Category%7ELegacy_Tutorial_261e.html" title="Category:Legacy Tutorial">Legacy Tutorial</a></span></p></div>	    <!-- end content -->
	    <div class="visualClear"></div>
	  </div>
	</div>
      </div>
      <div id="column-one">
	<div id="p-cactions" class="portlet">
	  <h5>Views</h5>
	  <ul>
	    <li id="ca-nstab-legacy"
	       class="selected"	       ><a href="../../../../articles/m/a/n/Legacy%7EManual_Shift_Car_2781.html">Legacy</a></li><li id="ca-talk"
	       class="new"	       ><a href="../../../../articles/m/a/n/Legacy_talk%7EManual_Shift_Car_c0e5.html">Discussion</a></li><li id="ca-current"
	       	       ><a href="http://wiki.beyondunreal.com/Legacy:Manual_Shift_Car">Current revision</a></li>	  </ul>
	</div>
	<div class="portlet" id="p-logo">
	  <a style="background-image: url(../../../../misc/uewiki.png);"
	    href="../../../../index.html"
	    title="Main Page"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
		<div class='portlet' id='p-navigation'>
	  <h5>Navigation</h5>
	  <div class='pBody'>
	    <ul>
	    	      <li id="n-mainpage"><a href="../../../../index.html">Main Page</a></li>
	     	      <li id="n-portal"><a href="../../../../articles/c/o/m/Unreal_Wiki%7ECommunity_Portal_3311.html">Community portal</a></li>
	     	      <li id="n-help"><a href="../../../../articles/c/o/n/Help%7EContents_22de.html">Help</a></li>
	     	    </ul>
	  </div>
	</div>
		<div id="p-search" class="portlet">
	  <h5><label for="searchInput">Search</label></h5>
	  <div id="searchBody" class="pBody">
	    <form action="javascript:goToStatic(3)" id="searchform"><div>
	      <input id="searchInput" name="search" type="text"
	        accesskey="f" value="" />
	      <input type='submit' name="go" class="searchButton" id="searchGoButton"
	        value="Go" />
	    </div></form>
	  </div>
	</div>
	      </div><!-- end of the left (by default at least) column -->
      <div class="visualClear"></div>
      <div id="footer">
    <div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="../../../../skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" /></a></div>	<div id="f-copyrightico"><a href="../../../../../COPYING.html"><img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" alt='Attribution-Noncommercial-Share Alike 3.0' /></a></div>	<ul id="f-list">
	  	  	  <li id="f-credits">This page was last modified 23:18, 19 May 2006 by Anonymous user(s) of Unreal Wiki. Based on work by <a href="../../../../articles/t/a/r/User%7ETarquin_cdb6.html" title="User:Tarquin">tarquin</a>.</li>	  <li id="f-copyright">Licensed as <a href="../../../../articles/c/o/p/Unreal_Wiki%7ECopyrights_e561.html" title="Unreal Wiki:Copyrights">Attribution-Noncommercial-Share Alike 3.0</a>.</li>	  <li id="f-about"><a href="../../../../articles/a/b/o/Unreal_Wiki%7EAbout_9ce6.html" title="Unreal Wiki:About">About Unreal Wiki</a></li>	  <li id="f-disclaimer"><a href="../../../../articles/g/e/n/Unreal_Wiki%7EGeneral_disclaimer_a0a2.html" title="Unreal Wiki:General disclaimer">Disclaimers</a></li>	  	</ul>
      </div>
    </div>
  </body>
</html>
